

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jakhong League System 4.2 (Modified)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,300;0,400;0,600;0,800;1,800&display=swap" rel="stylesheet">

    <style>
        /* --- DYNAMIC THEME VARIABLES (NEW) --- */
        :root {
            --primary-color: #facc15; /* Default Yellow-400 (Accent) */
            --secondary-color: #1c365b; /* Default Dark Blue (Header/Base Gradient Start) */
            --theme-end: #0c1626;   /* Very Dark Blue (Fixed Background Base) */
        }
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--theme-end);
            color: white;
            background-image: radial-gradient(circle at top right, #34050520 0%, transparent 40%),
                              radial-gradient(circle at bottom left, #1a1a1a 0%, transparent 40%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(12, 22, 38, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .navbar {
            background: rgba(12, 22, 38, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--primary-color);
        }
        .nav-btn {
            color: #ccc;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .nav-btn.active {
            background: var(--primary-color); 
            color: #000;
            font-weight: 700;
            border: 1px solid var(--primary-color);
            transform: scale(1.05);
        }
        .nav-btn:hover:not(.active) {
            background: rgba(var(--primary-color), 0.1); 
            color: var(--primary-color);
        }
        .logo-circle {
            border-radius: 50%;
            object-fit: cover;
            aspect-ratio: 1/1;
        }

        /* Player Card Design (Kept minimal style) */
        .player-card {
            background: linear-gradient(145deg, #1f2937, #0c1626);
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .player-photo-container {
            position: relative;
            overflow: hidden;
            background-color: #0c1626;
            border-bottom: 3px solid var(--primary-color);
            aspect-ratio: 3 / 4; 
        }
        .player-photo-container img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            object-position: top center;
        }
        /* Player Number Style (Circular only) */
        .player-num-tag {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--primary-color); 
            color: black;
            font-size: 0.9rem;
            font-weight: 900;
            width: 32px; /* Slightly larger circle */
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid white;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); } 
        .no-scrollbar::-webkit-scrollbar { display: none; }

        .outline-text {
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
        }
        
        /* Schedule Grouping */
        .schedule-group-header {
            background-color: var(--primary-color); 
            color: black;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            margin-top: 1.5rem;
            box-shadow: 0 4px 10px rgba(var(--primary-color), 0.2); 
        }
        /* Daily Summary Score Style (FIXED: Score Overlap) */
        .daily-score-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem; /* 3xl */
            font-weight: 900; /* black */
            letter-spacing: -0.05em; /* tracking-tighter */
            position: relative;
        }
        /* --- FIX: REMOVED TEXT SHADOW ON SCORE NUMBERS --- */
        .daily-score-number {
            padding: 0 0.5rem;
            border-radius: 6px;
            /* text-shadow: 2px 2px 0 #000;  <--- REMOVED */
            line-height: 1;
            z-index: 10; 
        }
        .daily-vs {
            /* FIX: Make VS smaller and central */
            font-size: 1rem;
            font-weight: 700;
            margin: 0 0.3rem;
            z-index: 5;
            color: #ccc;
        }

        /* FIX: Today Scorer Number Tag (Original tag, now replaced by card design) */
        .today-scorer-num-tag {
            position: absolute;
            top: 5px;
            right: 5px;
            background: black; 
            color: white; 
            font-size: 0.7rem;
            font-weight: 900;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* --- SCHEDULE CARD NEW DESIGN --- */
        .schedule-match-card {
            background: #111827; /* gray-900 */
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 150px 1fr; /* Team A | Center Info | Team B */
            align-items: center;
            cursor: pointer;
            overflow: hidden;
        }
        .schedule-match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }
        
        .schedule-team-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 50%;
            background-color: white;
            padding: 4px;
            border: 3px solid transparent;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* Center Info Style */
        .schedule-center-info {
            position: relative;
            text-align: center;
            padding: 1rem 0;
            z-index: 10;
        }
        /* VS Separator (Cooler effect) */
        .schedule-center-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 100%;
            background: repeating-linear-gradient(to bottom, var(--primary-color), var(--primary-color) 4px, transparent 4px, transparent 8px);
            opacity: 0.2;
            z-index: 5;
        }

        /* Action Buttons Container (Hidden by default) - REMOVED EDIT BUTTON */
        .schedule-actions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .schedule-match-card.show-actions .schedule-actions {
            opacity: 1;
            visibility: visible;
        }
        /* Team Containers */
        .schedule-team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        .schedule-team-container.team-a { text-align: right; }
        .schedule-team-container.team-b { text-align: left; }
        .schedule-team-container .flex { margin-top: 8px; }

        /* Media Query for larger screens */
        @media (min-width: 640px) {
            .schedule-team-container.team-a { 
                flex-direction: row; 
                justify-content: flex-end;
                text-align: right;
                gap: 12px;
            }
            .schedule-team-container.team-b { 
                flex-direction: row; 
                justify-content: flex-start;
                text-align: left;
                gap: 12px;
            }
            /* Adjust padding on larger screens */
            .schedule-team-container { padding: 1.5rem 1rem; }
        }

        /* --- NEW: Daily Top Scorer Grid Design (Desktop) --- */
        .top-scorer-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr); /* Default to 1 column */
            gap: 1rem;
        }
        @media (min-width: 768px) { /* md: */
            .top-scorer-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (min-width: 1024px) { /* lg: */
            .top-scorer-grid {
                grid-template-columns: repeat(5, 1fr); /* 5 columns for top 5 */
            }
        }
        /* UPDATED: Scorer Card Base Styles */
        .scorer-card {
            border-radius: 12px;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 3px solid transparent; /* Border will be set dynamically via JS input */
            position: relative;
            overflow: hidden;
            transition: all 0.2s;
        }
        .scorer-card-img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 3px solid white;
            margin-bottom: 0.5rem;
            aspect-ratio: 3/4;
        }
        /* UPDATED: Rank Tag Base Styles */
        .scorer-rank-tag {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            font-size: 1.25rem;
            font-weight: 900;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 3px solid black; /* Border will be set dynamically via JS */
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            /* Background and color now set via inline styles based on rank in JS */
        }

        /* --- NEW: All Stats Filter Styles --- */
        .all-stats-row {
            transition: all 0.1s;
        }
        .all-stats-row:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
    </style>
</head>
<body class="flex flex-col">

    <nav class="navbar sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg border border-white" 
                         style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color))">
                        <i class="fas fa-trophy text-black"></i>
                    </div>
                    <h1 class="text-xl font-extrabold italic uppercase tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500" 
                        id="nav-title">
                        JAKHONG SYSTEM
                    </h1>
                </div>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white transition"><i class="fas fa-cog text-xl"></i></button>
            </div>
            <div class="flex overflow-x-auto gap-3 pb-3 no-scrollbar">
                <button onclick="nav('home', this)" class="nav-btn active px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-home"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                <button onclick="nav('leaderboard', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-list-ol"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                <button onclick="nav('schedule', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-calendar-alt"></i> ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á</button>
                <button onclick="nav('daily', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-star"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•/‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</button>
                <button onclick="nav('stats', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-chart-bar"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
                <button onclick="nav('teams', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-shield-alt"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</button>
                <button onclick="nav('players', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</button>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-2 py-6 md:px-4">

        <div id="page-home" class="section fade-in">
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-3" style="color: var(--primary-color);">
                    <i class="fas fa-chart-line"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏µ‡∏Å
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4" style="border-color: var(--primary-color);">
                        <div class="text-3xl font-black" id="stat-total-teams">0</div>
                        <div class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°</div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-green-500">
                        <div class="text-3xl font-black" id="stat-total-stats">0</div>
                        <div class="text-gray-400 text-sm">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div> 
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-red-500">
                        <div class="text-3xl font-black" id="stat-total-goals">0</div>
                        <div class="text-gray-400 text-sm">‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ï‡∏π</div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-blue-500">
                        <div class="text-3xl font-black" id="stat-total-players">0</div>
                        <div class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div id="leader-team-card" class="glass p-5 rounded-2xl border-l-4 flex items-center gap-4" style="border-color: var(--primary-color);">
                    <i class="fas fa-trophy text-4xl" style="color: var(--primary-color);"></i>
                    <div>
                        <div class="text-lg font-bold" style="color: var(--primary-color);">‡∏ó‡∏µ‡∏°‡∏ô‡∏≥‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</div>
                        <div class="text-2xl font-black uppercase" id="leader-team-name">N/A</div>
                        <div class="text-sm text-gray-300"><span id="leader-team-pts">0</span> ‡πÅ‡∏ï‡πâ‡∏°</div>
                    </div>
                </div>
                <div id="top-scorer-card" class="glass p-5 rounded-2xl border-l-4 border-red-500 flex items-center gap-4">
                    <i class="fas fa-futbol text-4xl text-red-500"></i>
                    <div>
                        <div class="text-lg font-bold text-red-400">‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</div>
                        <div class="text-2xl font-black uppercase" id="top-scorer-name">N/A</div>
                        <div class="text-sm text-gray-300"><span id="top-scorer-goals">0</span> ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</div>
                    </div>
                </div>
            </div>


            <div class="glass p-6 rounded-2xl">
                <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-3" style="color: var(--primary-color);">
                    <i class="fas fa-user-tie"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°
                </h2>
                <div id="manager-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    </div>
            </div>
        </div>

        <div id="page-leaderboard" class="section hidden fade-in">
            <div class="glass p-3 rounded-xl mb-4 flex flex-wrap gap-4 items-center text-xs">
                <strong class="text-yellow-400">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á:</strong>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label><input type="color" id="lb-bg-body" value="#1e293b" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</label><input type="color" id="lb-body-text-color" value="#ffffff" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á 1</label><input type="color" id="lb-header-grad-1" value="#1c365b" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á 2</label><input type="color" id="lb-header-grad-2" value="#0c1626" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label><input type="color" id="lb-header-text-color" value="#ffffff" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πâ‡∏° 1</label><input type="color" id="lb-pts-grad-1" value="#facc15" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πâ‡∏° 2</label><input type="color" id="lb-pts-grad-2" value="#e3a008" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
            </div>

            <div class="rounded-xl overflow-hidden shadow-2xl">
                <div id="lb-banner" class="p-6 text-center relative" style="background: linear-gradient(135deg, #1c365b, #0c1626);">
                    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
                    <h2 contenteditable="true" id="lb-title" class="relative text-3xl md:text-5xl font-extrabold uppercase italic outline-text tracking-wider z-10 focus:outline-none focus:border-b border-white" style="color: var(--primary-color);">
                        ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô JAKHONG SENIOR CUP
                    </h2>
                </div>
                
                <div class="overflow-x-auto bg-gray-900">
                    <table class="w-full text-left border-collapse min-w-[700px]" id="lb-table">
                        <thead>
                            <tr class="uppercase text-sm tracking-wider border-b border-white/10" id="lb-thead-row">
                                <th class="p-4" style="color: #ffffff;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="p-4" style="color: #ffffff;">‡∏ó‡∏µ‡∏°</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÅ‡∏Ç‡πà‡∏á</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡∏ä‡∏ô‡∏∞</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÄ‡∏™‡∏°‡∏≠</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÅ‡∏û‡πâ</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÑ‡∏î‡πâ/‡πÄ‡∏™‡∏µ‡∏¢</th>
                                <th class="p-4 text-center" style="color: #ffffff;">+/-</th>
                                <th class="p-0 text-center text-xl">
                                    <div style="background: linear-gradient(135deg, var(--primary-color), #e3a008); color: black;" class="font-black">‡πÅ‡∏ï‡πâ‡∏°</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="lb-body" class="text-base font-medium"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-schedule" class="section hidden fade-in">
            <div class="glass p-3 rounded-xl mb-4 flex flex-wrap gap-4 items-center text-xs">
                <button onclick="openAddSchedModal()" class="bg-green-600 text-white px-3 py-1 rounded font-bold hover:bg-green-500 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏°‡∏ó‡∏ä‡πå</button>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (BG)</label><input type="color" id="sc-bg-color-main" value="#1c365b" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()"></div>
                <label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (Overlay):</label>
                <input type="color" id="sc-bg-color" value="#1c365b" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£:</label>
                <input type="color" id="sc-text-color" value="#ffffff" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
                <input type="color" id="sc-pill-color" value="#facc15" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <input type="text" id="sc-header-text" value="‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô" class="bg-gray-700 text-white px-2 rounded w-32" oninput="renderSchedule()">
            </div>

            <div class="flex flex-col min-h-[500px] rounded-xl overflow-hidden shadow-2xl relative" id="schedule-main-container">
                <div class="flex-1 p-4 md:p-8 relative z-10 w-full" id="sc-container">
                    <div class="text-center mb-8">
                        <span id="sc-pill" class="inline-block px-8 py-2 rounded-full text-xl md:text-2xl font-bold uppercase shadow-lg text-black mb-2 transform skew-x-[-10deg]" style="background-color: var(--primary-color);">
                            ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                        </span>
                    </div>

                    <div class="flex gap-3 justify-center mb-6 overflow-x-auto no-scrollbar" id="group-tabs-container">
                        <button onclick="setGroupFilter('All', this)" class="group-tab active text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: var(--primary-color);">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <button onclick="setGroupFilter('A', this)" class="group-tab bg-gray-700 text-white px-4 py-1 rounded-full text-sm font-medium transition hover:bg-gray-600">‡∏Å‡∏•‡∏∏‡πà‡∏° A</button>
                        <button onclick="setGroupFilter('B', this)" class="group-tab bg-gray-700 text-white px-4 py-1 rounded-full text-sm font-medium transition hover:bg-gray-600">‡∏Å‡∏•‡∏∏‡πà‡∏° B</button>
                    </div>
                    
                    <div id="sched-list" class="space-y-4 max-w-4xl mx-auto">
                        </div>
                </div>

                <div id="sc-bg-overlay" class="absolute inset-0 z-0 bg-gradient-to-br from-blue-900 to-black opacity-90"></div>
            </div>
        </div>

        <div id="page-daily" class="section hidden fade-in">
            <div class="glass p-4 rounded-xl mb-6 flex flex-wrap gap-6 items-end">
                <div>
                    <label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Daily/Stats)</label>
                    <select id="daily-view-mode" class="bg-black border border-gray-600 p-2 rounded text-white text-sm w-full" onchange="renderDaily() || renderAllStats()">
                        <option value="daily">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</option>
                        <option value="stats">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏ó‡∏±‡πâ‡∏á‡∏•‡∏µ‡∏Å)</option>
                    </select>
                </div>
                <div id="daily-controls" class="flex flex-wrap gap-6 items-end">
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="daily-date" class="bg-black border border-gray-600 p-2 rounded text-white text-sm w-full" onchange="renderDaily()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</label>
                        <select id="daily-scorer-sort" class="bg-black border border-gray-600 p-2 rounded text-white text-sm" onchange="renderDaily()">
                            <option value="goals">‡∏õ‡∏£‡∏∞‡∏ï‡∏π (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                            <option value="name">‡∏ä‡∏∑‡πà‡∏≠</option>
                            <option value="number">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</option>
                        </select>
                    </div>

                    <div class="flex gap-2">
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏Å‡∏≠‡∏£‡πå</label><input type="color" id="daily-score-text-color" value="#000000" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏™‡∏Å‡∏≠‡∏£‡πå 1</label><input type="color" id="daily-score-grad-1" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏™‡∏Å‡∏≠‡∏£‡πå 2</label><input type="color" id="daily-score-grad-2" value="#e3a008" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label><input type="color" id="daily-team-name-color" value="#ffffff" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div> 
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ñ‡∏ö 1</label><input type="color" id="daily-row-bg-1" value="#1f2937" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ñ‡∏ö 2</label><input type="color" id="daily-row-bg-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>
                    <div class="flex gap-2">
                        <div><label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå 1</label><input type="color" id="daily-banner-grad-1" value="#1c365b" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå 2</label><input type="color" id="daily-banner-grad-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label><input type="color" id="daily-banner-text" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label><input type="color" id="daily-banner-border" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>
                    
                    <div class="flex flex-wrap gap-2 mt-2 border-t border-gray-700 pt-3 w-full">
                        <div class="text-sm font-bold text-yellow-400 w-full pb-1 mb-1">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß:</div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î</label><input type="color" id="daily-sc-bg" value="#1f2937" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ä‡∏∑‡πà‡∏≠</label><input type="color" id="daily-sc-name-color" value="#ffffff" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î</label><input type="color" id="daily-sc-border" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ Rank 4+</label><input type="color" id="daily-sc-rank-4-color" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏≠‡∏±‡∏Å‡∏©‡∏£ Rank 4+</label><input type="color" id="daily-sc-rank-4-text" value="#000000" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label><input type="color" id="daily-today-header-color" value="#10b981" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>
                </div>

                <div id="all-stats-controls" class="hidden">
                    <label class="text-xs text-gray-400 block mb-1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á</label>
                    <select id="stat-filter-type" class="bg-black border border-gray-600 p-2 rounded text-white text-sm" onchange="renderAllStats()">
                        <option value="goal">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="yellow">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="red">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="save">üß§ ‡πÄ‡∏ã‡∏ü (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                    </select>
                </div>
            </div>

            <div id="daily-preview" class="bg-white max-w-[900px] mx-auto shadow-2xl overflow-hidden pb-10 rounded-xl">
                
                <div id="daily-header" class="py-4 px-4 flex flex-wrap items-center justify-between relative border-b-4 border-yellow-500">
                    <div class="flex items-center gap-3 z-10">
                        <img id="daily-logo-img" src="" class="w-12 h-12 object-contain drop-shadow-md bg-white rounded-full p-1 border border-yellow-400">
                        <div contenteditable="true" id="daily-title-edit" class="text-xl md:text-3xl font-extrabold uppercase italic leading-none outline-text text-yellow-400" style="text-shadow: 2px 2px 0 #000;">
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô 25/11/2568 JAKHONG LEAGUE 3
                        </div>
                    </div>
                </div>

                <div id="daily-content">
                    <div class="p-4 md:p-8 bg-gray-900 min-h-[200px] space-y-3" id="daily-matches-container"></div>

                    <div class="grid grid-cols-1 mt-4">
                        
                        <div class="bg-gray-800 p-4 border-b border-gray-700 flex flex-col">
                            <h3 class="text-center font-bold text-yellow-400 uppercase text-lg mb-4 border-b border-gray-700 pb-2">
                                <span id="daily-scorer-header">‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Top 5)</span>
                            </h3>
                            <div id="daily-top-scorers" class="top-scorer-grid">
                                </div>
                        </div>

                        <div class="bg-gray-900 p-4">
                            <h3 class="text-center font-bold text-green-400 uppercase text-lg mb-4 border-b border-gray-700 pb-2" id="daily-today-header"> 
                                ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 
                            </h3> 
                            <div id="daily-today-scorers" class="top-scorer-grid">
                            </div> 
                        </div>
                    </div> 
                </div> 
            </div> 
            <div id="all-stats-content" class="hidden">
                <div class="p-4 md:p-8 bg-gray-900 min-h-[200px]">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="uppercase text-xs tracking-wider border-b border-white/10 text-gray-400">
                                <th class="p-2">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="p-2">‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</th>
                                <th class="p-2 text-center">‡∏ó‡∏µ‡∏°</th>
                                <th class="p-2 text-center" id="all-stats-header">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            </tr>
                        </thead>
                        <tbody id="all-stats-body" class="text-sm font-medium">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-stats" class="section hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-2xl h-fit">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ / ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á</h2>
                    <div class="mb-6 p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-gray-400 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏™‡∏Å‡∏≠‡∏£‡πå</h3>
                        <div class="mb-3">
                            <label class="text-xs text-gray-400">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á (‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πà‡∏á):</label>
                            <select id="m-schedule-id" class="w-full bg-gray-800 p-2 rounded text-xs" onchange="prefillMatchFromSchedule()">
                                <option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---</option>
                            </select>
                        </div>
                        <form onsubmit="handleMatchSubmit(event)" class="flex gap-4 flex-wrap items-end">
                            <input type="hidden" id="match-edit-id">
                            <div class="w-full flex gap-4">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏ó‡∏µ‡∏° A</label>
                                    <select id="m-team-a" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required></select>
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏ó‡∏µ‡∏° B</label>
                                    <select id="m-team-b" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required></select>
                                </div>
                            </div>
                            <div class="w-full flex gap-4">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏™‡∏Å‡∏≠‡∏£‡πå A</label>
                                    <input type="number" id="m-score-a" class="w-full bg-gray-800 p-2 rounded text-center text-lg font-bold border border-gray-600" value="0" min="0" required>
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏™‡∏Å‡∏≠‡∏£‡πå B</label>
                                    <input type="number" id="m-score-b" class="w-full bg-gray-800 p-2 rounded text-center text-lg font-bold border border-gray-600" value="0" min="0" required>
                                </div>
                            </div>
                            <div class="flex-1 min-w-[120px]">
                                <label class="text-xs text-gray-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πà‡∏á</label>
                                <input type="date" id="m-date" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                            </div>
                            <div class="flex-1 min-w-[120px]">
                                <label class="text-xs text-gray-400">‡πÄ‡∏ß‡∏•‡∏≤</label>
                                <input type="time" id="m-time" class="w-full bg-gray-800 p-2 rounded border border-gray-600">
                            </div>
                            <button class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500 transition"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</button>
                            <button type="button" onclick="resetMatchForm()" id="match-reset-btn" class="bg-gray-600 text-white px-4 py-2 rounded font-bold hover:bg-gray-500 transition hidden"><i class="fas fa-undo"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        </form>
                    </div>

                    <div class="mb-6 p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-gray-400 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
                        <form onsubmit="handleStatSubmit(event)" class="flex gap-4 flex-wrap items-end">
                            <input type="hidden" id="edit-stat-id">
                            <div class="flex-1 min-w-[150px]">
                                <label class="text-xs text-gray-400">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</label>
                                <select id="s-type" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                                    <option value="goal">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
                                    <option value="yellow">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
                                    <option value="red">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</option>
                                    <option value="save">üß§ ‡πÄ‡∏ã‡∏ü</option>
                                </select>
                            </div>
                            <div class="flex-1 min-w-[150px]">
                                <label class="text-xs text-gray-400">‡∏ó‡∏µ‡∏°</label>
                                <select id="s-team" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required onchange="updatePlayerDropdown(this.value)"></select>
                            </div>
                            <div class="flex-1 min-w-[150px]">
                                <label class="text-xs text-gray-400">‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</label>
                                <select id="s-player" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required></select>
                            </div>
                            <div class="w-20">
                                <label class="text-xs text-gray-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                                <div class="flex items-center gap-1">
                                    <button type="button" onclick="adjStat(-1)" class="bg-gray-700 text-white px-2 py-1 rounded">-</button>
                                    <input type="number" id="s-count" class="flex-1 bg-gray-800 p-2 rounded text-center font-bold border border-gray-600" value="1" min="1" required>
                                    <button type="button" onclick="adjStat(1)" class="bg-gray-700 text-white px-2 py-1 rounded">+</button>
                                </div>
                            </div>
                            <div class="flex-1 min-w-[150px]">
                                <label class="text-xs text-gray-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="date" id="s-date" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                            </div>
                            <div class="w-full">
                                <label class="text-xs text-gray-400">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                <input type="text" id="s-note" class="w-full bg-gray-800 p-2 rounded border border-gray-600" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà 75">
                            </div>
                            <button class="bg-green-600 text-white px-4 py-2 rounded font-bold hover:bg-green-500 transition"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
                            <button type="button" onclick="resetStatForm()" id="stat-reset-btn" class="bg-gray-600 text-white px-4 py-2 rounded font-bold hover:bg-gray-500 transition hidden"><i class="fas fa-undo"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        </form>
                    </div>
                </div>

                <div class="glass p-6 rounded-2xl flex flex-col h-[600px] max-h-[600px]">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
                    <div class="flex mb-4 border-b border-gray-700">
                        <button onclick="showHistory('match', this)" id="hist-tab-match" class="hist-tab px-4 py-2 text-sm font-bold border-b-2" style="color: var(--primary-color); border-color: var(--primary-color);">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
                        <button onclick="showHistory('stat', this)" id="hist-tab-stat" class="hist-tab px-4 py-2 text-sm font-bold text-gray-400 hover:text-white">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
                    </div>
                    <div class="overflow-y-auto pr-2 space-y-2 flex-1 custom-scrollbar">
                        <div id="history-match-list" class="space-y-2"></div>
                        <div id="history-stat-list" class="space-y-2 hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-teams" class="section hidden fade-in">
            <div class="glass p-6 rounded-2xl mb-8">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h2>
                <form onsubmit="handleTeamSubmit(event)" class="flex flex-wrap gap-4 items-end">
                    <input type="hidden" id="team-edit-id">
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label>
                        <input type="text" id="team-name" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏ó‡∏µ‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ)</label>
                        <input type="color" id="team-color" class="w-10 h-10 rounded cursor-pointer block mt-1">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î)</label>
                        <input type="tel" id="team-tel" class="w-full bg-gray-800 p-2 rounded border border-gray-600" placeholder="0xx-xxx-xxxx">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡∏Å‡∏•‡∏∏‡πà‡∏° (Group)</label>
                        <select id="team-group" class="w-full bg-gray-800 p-2 rounded border border-gray-600">
                            <option value="N/A">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                            <option value="A">‡∏Å‡∏•‡∏∏‡πà‡∏° A</option>
                            <option value="B">‡∏Å‡∏•‡∏∏‡πà‡∏° B</option>
                            <option value="C">‡∏Å‡∏•‡∏∏‡πà‡∏° C</option>
                            <option value="D">‡∏Å‡∏•‡∏∏‡πà‡∏° D</option>
                        </select>
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ (PNG/JPG)</label>
                        <input type="file" id="team-logo" accept="image/*" class="w-full text-xs text-gray-400 p-2 border border-gray-600 rounded bg-gray-800">
                    </div>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500 transition"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡∏°</button>
                    <button type="button" onclick="resetTeamForm()" id="team-reset-btn" class="bg-gray-600 text-white px-4 py-2 rounded font-bold hover:bg-gray-500 transition hidden"><i class="fas fa-undo"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </form>
            </div>

            <div class="glass p-6 rounded-2xl">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div id="team-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
            </div>
        </div>

        <div id="page-players" class="section hidden fade-in">
            <div class="glass p-6 rounded-2xl mb-8">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</h2>
                
                <div id="player-tabs-container" class="flex overflow-x-auto gap-3 pb-3 no-scrollbar mb-4 border-b border-gray-700">
                    <button onclick="renderPlayers('all', this)" class="team-tab active text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: var(--primary-color); color: black;">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>

                <button onclick="openAddPlayerModal()" class="bg-green-600 text-white px-4 py-2 rounded font-bold hover:bg-green-500 transition mb-4">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏´‡∏°‡πà</button>

                <div id="player-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                </div>
            </div>
        </div>

    </main>

    <div id="settings-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-lg">
            <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div class="space-y-4">
                <h4 class="text-lg font-bold text-gray-300">‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å</h4>
                <div class="flex flex-wrap gap-4 items-end">
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏µ‡∏Å/‡∏£‡∏∞‡∏ö‡∏ö</label>
                        <input type="text" id="theme-name-input" class="w-full bg-gray-800 p-2 rounded border border-gray-600">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å (Primary)</label>
                        <input type="color" id="theme-color-input" class="w-10 h-10 rounded cursor-pointer block mt-1">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏£‡∏≠‡∏á (Secondary)</label>
                        <input type="color" id="secondary-color-input" class="w-10 h-10 rounded cursor-pointer block mt-1">
                    </div>
                    <button onclick="updateThemeAndSave()" class="bg-yellow-600 text-black px-4 py-2 rounded font-bold hover:bg-yellow-500 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏µ‡∏°</button>
                </div>

                <h4 class="text-lg font-bold text-gray-300 border-t border-gray-700 pt-4 mt-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="exportData()" class="bg-gray-600 text-white px-4 py-2 rounded font-bold hover:bg-gray-500 transition"><i class="fas fa-file-export"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</button>
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</label>
                        <input type="file" id="import-file" accept=".json" onchange="importData(this)" class="w-full text-xs text-gray-400 p-2 border border-gray-600 rounded bg-gray-800">
                    </div>
                </div>
                
                <h4 class="text-lg font-bold text-gray-300 border-t border-gray-700 pt-4 mt-4">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢!)</h4>
                <button onclick="clearAllData()" class="bg-red-600 text-white px-4 py-2 rounded font-bold hover:bg-red-500 transition"><i class="fas fa-trash-alt"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
            <button onclick="toggleSettings()" class="mt-6 w-full bg-gray-700 py-2 rounded font-bold hover:bg-gray-600 transition">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <div id="sched-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á</h3>
            <form onsubmit="handleSchedSubmit(event)" class="space-y-3">
                <input type="hidden" id="sc-edit-id">
                <div class="flex gap-2">
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πà‡∏á</label>
                        <input type="date" id="sc-date" class="w-full bg-gray-800 p-2 rounded" required>
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input type="time" id="sc-time" class="w-full bg-gray-800 p-2 rounded" required>
                    </div>
                </div>
                <div>
                    <label class="text-xs text-gray-400">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/‡∏£‡∏≠‡∏ö</label>
                    <input type="text" id="sc-week" class="w-full bg-gray-800 p-2 rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 5" required>
                </div>
                <div class="flex gap-2">
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">‡∏ó‡∏µ‡∏° A</label>
                        <select id="sc-team-a" class="w-full bg-gray-800 p-2 rounded" required></select>
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">‡∏ó‡∏µ‡∏° B</label>
                        <select id="sc-team-b" class="w-full bg-gray-800 p-2 rounded" required></select>
                    </div>
                </div>
                <label class="text-xs text-gray-400">‡∏Å‡∏•‡∏∏‡πà‡∏° (Group)</label>
                <select id="sc-group" class="w-full bg-gray-800 p-2 rounded">
                    <option value="N/A">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                    <option value="A">‡∏Å‡∏•‡∏∏‡πà‡∏° A</option>
                    <option value="B">‡∏Å‡∏•‡∏∏‡πà‡∏° B</option>
                    <option value="C">‡∏Å‡∏•‡∏∏‡πà‡∏° C</option>
                    <option value="D">‡∏Å‡∏•‡∏∏‡πà‡∏° D</option>
                </select>
                <button class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" onclick="document.getElementById('sched-modal').classList.add('hidden')" class="w-full bg-gray-600 py-2 rounded mt-2">‡∏õ‡∏¥‡∏î</button>
            </form>
        </div>
    </div>

    <div id="player-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md">
            <h3 id="player-modal-title" class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</h3>
            <form onsubmit="handlePlayerSubmit(event)" class="space-y-3">
                <input type="hidden" id="p-id">
                <input type="text" id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full bg-gray-800 p-2 rounded" required>
                <div class="flex gap-2">
                    <input type="text" id="p-no" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå" class="w-20 bg-gray-800 p-2 rounded">
                    <select id="p-team" class="flex-1 bg-gray-800 p-2 rounded" required></select>
                </div>
                <label class="flex gap-2 text-sm items-center"><input type="checkbox" id="p-manager" class="w-4 h-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"> ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</label>
                <input type="file" id="p-img" accept="image/*" class="w-full text-xs text-gray-400">
                <p class="text-[10px] text-gray-500 mt-1"> *‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô 3:4 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î</p>
                <button class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" onclick="document.getElementById('player-modal').classList.add('hidden'); resetPlayerForm();" class="w-full bg-gray-600 py-2 rounded mt-2">‡∏õ‡∏¥‡∏î</button>
            </form>
        </div>
    </div>

    <div id="storage-warning-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-sm text-center">
            <h3 class="text-2xl font-bold text-red-500 mb-4"><i class="fas fa-exclamation-triangle"></i> ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°!</h3>
            <p class="text-sm text-gray-400 mb-4">Storage Quota Exceeded. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)</p>
            <p class="text-sm text-yellow-300 font-bold mb-6">‚ö†Ô∏è **‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤) ‡∏´‡∏£‡∏∑‡∏≠ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå Local Storage ‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ**</p>
            <button onclick="document.getElementById('storage-warning-modal').classList.add('hidden')" class="bg-red-600 text-white px-6 py-2 rounded font-bold hover:bg-red-500 transition">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        // --- STATE & THEME (UPDATED) ---
        let teams = JSON.parse(localStorage.getItem('jl_teams')) || [];
        let players = JSON.parse(localStorage.getItem('jl_players')) || [];
        let matches = JSON.parse(localStorage.getItem('jl_matches')) || [];
        let stats = JSON.parse(localStorage.getItem('jl_stats')) || [];
        let schedules = JSON.parse(localStorage.getItem('jl_schedules')) || [];
        let globalLogo = localStorage.getItem('jl_logo') || "";
        let themeName = localStorage.getItem('jl_theme_name') || 'JAKHONG SYSTEM';
        let themeColor = localStorage.getItem('jl_theme_color') || '#facc15';
        let secondaryColor = localStorage.getItem('jl_secondary_color') || '#1c365b';
        let currentGroupFilter = 'All';
        let currentTeamView = 'all';

        // ** CRITICAL FIX: Default Data Structure (Kept original mock data) **
        const DEFAULT_TEAMS = [ 
            { id: 't1', name: 'Phoenix FC', color: '#ff4d4d', tel: '081-111-1111', logo: '', group: 'A' }, 
            { id: 't2', name: 'Dragon FC', color: '#00ccff', tel: '082-222-2222', logo: '', group: 'B' },
            { id: 't3', name: 'Thunder FC', color: '#7c3aed', tel: '083-333-3333', logo: '', group: 'A' },
            { id: 't4', name: 'Aqua FC', color: '#34d399', tel: '084-444-4444', logo: '', group: 'B' }
        ];
        const DEFAULT_PLAYERS = [
            { id: 'p1', teamId: 't1', name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏≠‡∏á', no: '9', img: '', manager: true },
            { id: 'p2', teamId: 't1', name: '‡∏ß‡∏µ‡∏£‡∏∞‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏õ‡∏µ‡∏Å‡∏ã‡πâ‡∏≤‡∏¢', no: '7', img: '', manager: false },
            { id: 'p3', teamId: 't2', name: '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏±‡∏ö', no: '10', img: '', manager: true },
            { id: 'p4', teamId: 't2', name: '‡∏™‡∏∏‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤', no: '11', img: '', manager: false },
        ];
        // Add more mock data if storage is empty
        if (teams.length === 0) teams = DEFAULT_TEAMS;
        if (players.length === 0) players = DEFAULT_PLAYERS;
        
        // --- CORE FUNCTIONS (KEEPING ORIGINAL LOGIC) ---
        
        function save() {
            try {
                localStorage.setItem('jl_teams', JSON.stringify(teams));
                localStorage.setItem('jl_players', JSON.stringify(players));
                localStorage.setItem('jl_matches', JSON.stringify(matches));
                localStorage.setItem('jl_stats', JSON.stringify(stats));
                localStorage.setItem('jl_schedules', JSON.stringify(schedules));
                localStorage.setItem('jl_logo', globalLogo);
                localStorage.setItem('jl_theme_name', themeName);
                localStorage.setItem('jl_theme_color', themeColor);
                localStorage.setItem('jl_secondary_color', secondaryColor);
                renderAll();
                // Save daily controls settings
                const dailySettings = {
                    date: document.getElementById('daily-date').value,
                    sort: document.getElementById('daily-scorer-sort').value,
                    scoreTextColor: document.getElementById('daily-score-text-color').value,
                    scoreGrad1: document.getElementById('daily-score-grad-1').value,
                    scoreGrad2: document.getElementById('daily-score-grad-2').value,
                    teamNameColor: document.getElementById('daily-team-name-color').value,
                    rowBg1: document.getElementById('daily-row-bg-1').value,
                    rowBg2: document.getElementById('daily-row-bg-2').value,
                    bannerGrad1: document.getElementById('daily-banner-grad-1').value,
                    bannerGrad2: document.getElementById('daily-banner-grad-2').value,
                    bannerText: document.getElementById('daily-banner-text').value,
                    bannerBorder: document.getElementById('daily-banner-border').value,
                    // NEW SCORER CARD SETTINGS
                    scBg: document.getElementById('daily-sc-bg').value,
                    scNameColor: document.getElementById('daily-sc-name-color').value,
                    scBorder: document.getElementById('daily-sc-border').value,
                    scRank4Color: document.getElementById('daily-sc-rank-4-color').value,
                    scRank4Text: document.getElementById('daily-sc-rank-4-text').value,
                    todayHeaderColor: document.getElementById('daily-today-header-color').value,
                };
                localStorage.setItem('jl_daily_settings', JSON.stringify(dailySettings));

            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    document.getElementById('storage-warning-modal').classList.remove('hidden');
                } else {
                    console.error("Error saving to local storage:", e);
                }
            }
        }
        
        function loadDailySettings() {
            const settings = JSON.parse(localStorage.getItem('jl_daily_settings')) || {};
            if (document.getElementById('daily-date')) {
                document.getElementById('daily-date').value = settings.date || new Date().toISOString().split('T')[0];
                document.getElementById('daily-scorer-sort').value = settings.sort || 'goals';
                document.getElementById('daily-score-text-color').value = settings.scoreTextColor || '#000000';
                document.getElementById('daily-score-grad-1').value = settings.scoreGrad1 || '#facc15';
                document.getElementById('daily-score-grad-2').value = settings.scoreGrad2 || '#e3a008';
                document.getElementById('daily-team-name-color').value = settings.teamNameColor || '#ffffff';
                document.getElementById('daily-row-bg-1').value = settings.rowBg1 || '#1f2937';
                document.getElementById('daily-row-bg-2').value = settings.rowBg2 || '#0c1626';
                document.getElementById('daily-banner-grad-1').value = settings.bannerGrad1 || '#1c365b';
                document.getElementById('daily-banner-grad-2').value = settings.bannerGrad2 || '#0c1626';
                document.getElementById('daily-banner-text').value = settings.bannerText || '#facc15';
                document.getElementById('daily-banner-border').value = settings.bannerBorder || '#facc15';
                // NEW SCORER CARD SETTINGS
                document.getElementById('daily-sc-bg').value = settings.scBg || '#1f2937';
                document.getElementById('daily-sc-name-color').value = settings.scNameColor || '#ffffff';
                document.getElementById('daily-sc-border').value = settings.scBorder || '#facc15';
                document.getElementById('daily-sc-rank-4-color').value = settings.scRank4Color || '#facc15';
                document.getElementById('daily-sc-rank-4-text').value = settings.scRank4Text || '#000000';
                document.getElementById('daily-today-header-color').value = settings.todayHeaderColor || '#10b981';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const [year, month, day] = dateString.split('-');
            // Use Thai year (Buddhist Era)
            return `${parseInt(day)}/${parseInt(month)}/${parseInt(year) + 543}`;
        }

        function nav(id, button) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`page-${id}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (button) button.classList.add('active');
            
            // Re-render only the relevant page to keep it fresh
            if(id === 'home') renderDashboard();
            if(id === 'daily') {
                loadDailySettings(); // Load settings before rendering
                const viewMode = document.getElementById('daily-view-mode').value;
                if (viewMode === 'daily') {
                    renderDaily();
                } else {
                    renderAllStats();
                }
            }
            if(id === 'leaderboard') renderLeaderboard();
            if(id === 'stats') {
                const matchTab = document.getElementById('hist-tab-match');
                if (matchTab) { showHistory('match', matchTab); }
                updateScheduleMatchDropdown();
            }
            if(id === 'teams') renderTeams();
            if(id === 'players') {
                renderTeamsTabs(currentTeamView); 
                renderPlayers(currentTeamView); 
            }
            if(id === 'schedule') renderSchedule();
        }

        function renderAll() {
            updateDropdowns();
            renderLeaderboard();
            renderSchedule();
            renderTeams();
            renderTeamsTabs(currentTeamView);
            renderPlayers(currentTeamView);
            renderMatchHistory();
            renderStatHistory();
            renderDashboard();
            updateScheduleMatchDropdown();

            // Re-render the active view for daily page
            loadDailySettings(); // Load settings before rendering
            const viewMode = document.getElementById('daily-view-mode').value;
            if (document.getElementById('page-daily').classList.contains('hidden')) return;
            if (viewMode === 'daily') {
                renderDaily();
            } else {
                renderAllStats();
            }
        }
        
        function updateDropdowns() {
            // ... (Dropdown update logic - KEPT AS IS)
            const opts = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</option>` + teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            ['sc-team-a','sc-team-b','m-team-a','m-team-b','s-team','p-team'].forEach(id => { 
                const el = document.getElementById(id); 
                if(el) el.innerHTML = opts;
            });
            const playerOpts = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</option>` + players.map(p => `<option value="${p.id}">${p.name} (#${p.no || '-'})</option>`).join('');
            const sPlayerEl = document.getElementById('s-player');
            if (sPlayerEl) sPlayerEl.innerHTML = playerOpts;
            
        }

        function renderTheme() {
            // ... (Theme rendering logic - KEPT AS IS)
            localStorage.setItem('jl_theme_color', themeColor);
            localStorage.setItem('jl_secondary_color', secondaryColor);
            localStorage.setItem('jl_theme_name', themeName);
            document.documentElement.style.setProperty('--primary-color', themeColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.getElementById('nav-title').innerText = themeName;
            const themeInput = document.getElementById('theme-color-input');
            if (themeInput) { 
                themeInput.value = themeColor;
                document.getElementById('secondary-color-input').value = secondaryColor;
                document.getElementById('theme-name-input').value = themeName;
            }
        }
        function updateThemeAndSave() {
            // ... (Update theme logic - KEPT AS IS)
            themeColor = document.getElementById('theme-color-input').value;
            secondaryColor = document.getElementById('secondary-color-input').value;
            themeName = document.getElementById('theme-name-input').value;
            save(); // Save and trigger renderTheme
        }

        // ... (Image Compression - KEPT AS IS)
        const compressImage = (file) => {
             // ... (Image Compression Logic)
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const targetWidth = 300;
                        const targetHeight = 400;
                        const scale = Math.max(targetWidth / img.width, targetHeight / img.height);
                        const x = (targetWidth / 2) - (img.width / 2) * scale;
                        const y = (targetHeight / 2) - (img.height / 2) * scale;
                        canvas.width = targetWidth;
                        canvas.height = targetHeight;
                        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    };
                };
            });
        };

        // --- DASHBOARD (KEPT AS IS) ---
        function calculateDashboardStats() {
            // ... (Dashboard Stats Logic - KEPT AS IS)
            const teamStats = calculateLeaderboardData();
            
            // Total Stats
            document.getElementById('stat-total-teams').innerText = teams.length;
            document.getElementById('stat-total-stats').innerText = stats.length;
            document.getElementById('stat-total-goals').innerText = stats.filter(s => s.type === 'goal').reduce((acc, s) => acc + s.count, 0);
            document.getElementById('stat-total-players').innerText = players.length;

            // Leader Team
            const leader = teamStats.sort((a, b) => b.pts - a.pts)[0];
            if (leader) {
                document.getElementById('leader-team-name').innerText = leader.name;
                document.getElementById('leader-team-pts').innerText = leader.pts;
                document.getElementById('leader-team-card').style.borderColor = leader.color;
            } else {
                 document.getElementById('leader-team-name').innerText = 'N/A';
                 document.getElementById('leader-team-pts').innerText = '0';
                 document.getElementById('leader-team-card').style.borderColor = themeColor;
            }
            
            // Top Scorer
            const playerGoals = stats.filter(s => s.type === 'goal').reduce((acc, s) => {
                acc[s.playerId] = (acc[s.playerId] || 0) + s.count;
                return acc;
            }, {});
            const sortedScorers = players.map(p => ({
                name: p.name,
                goals: playerGoals[p.id] || 0
            })).sort((a, b) => b.goals - a.goals);
            
            const topScorer = sortedScorers.find(s => s.goals > 0);
            if (topScorer) {
                document.getElementById('top-scorer-name').innerText = topScorer.name;
                document.getElementById('top-scorer-goals').innerText = topScorer.goals;
            } else {
                document.getElementById('top-scorer-name').innerText = 'N/A';
                document.getElementById('top-scorer-goals').innerText = '0';
            }

            // Manager List
            const managerList = document.getElementById('manager-list');
            const managers = players.filter(p => p.manager).map(p => {
                const t = teams.find(t => t.id == p.teamId);
                return { name: p.name, teamName: t?.name, teamTel: t?.tel, teamColor: t?.color };
            });
            managerList.innerHTML = managers.map(m => `
                <div class="p-3 rounded-lg flex items-center gap-3 bg-gray-900 border-l-4" style="border-color: ${m.teamColor || themeColor};">
                    <i class="fas fa-user-tie text-xl" style="color: ${m.teamColor || themeColor};"></i>
                    <div>
                        <div class="font-bold">${m.name}</div>
                        <div class="text-sm text-gray-400">${m.teamName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'} | Tel: ${m.teamTel || 'N/A'}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderDashboard() {
            calculateDashboardStats();
        }

        // --- 1. LEADERBOARD (KEPT AS IS) ---
        function calculateLeaderboardData() {
            // ... (Leaderboard calculation logic - KEPT AS IS)
            const data = teams.map(t => ({ id: t.id, name: t.name, color: t.color, p: 0, w: 0, d: 0, l: 0, gf: 0, ga: 0, gd: 0, pts: 0 }));
            matches.forEach(m => {
                const idxA = data.findIndex(d => d.id == m.teamA);
                const idxB = data.findIndex(d => d.id == m.teamB);
                if (idxA === -1 || idxB === -1) return; 

                const scoreA = parseInt(m.scoreA);
                const scoreB = parseInt(m.scoreB);
                
                data[idxA].p++;
                data[idxB].p++;
                data[idxA].gf += scoreA;
                data[idxA].ga += scoreB;
                data[idxB].gf += scoreB;
                data[idxB].ga += scoreA;

                if (scoreA > scoreB) {
                    data[idxA].w++;
                    data[idxA].pts += 3;
                    data[idxB].l++;
                } else if (scoreA < scoreB) {
                    data[idxB].w++;
                    data[idxB].pts += 3;
                    data[idxA].l++;
                } else {
                    data[idxA].d++;
                    data[idxB].d++;
                    data[idxA].pts += 1;
                    data[idxB].pts += 1;
                }
            });

            data.forEach(d => d.gd = d.gf - d.ga);

            // Sort by Points (desc), Goal Difference (desc), Goals For (desc), then Name (asc)
            data.sort((a, b) => {
                if (b.pts !== a.pts) return b.pts - a.pts;
                if (b.gd !== a.gd) return b.gd - a.gd;
                if (b.gf !== a.gf) return b.gf - a.gf;
                return a.name.localeCompare(b.name);
            });
            return data;
        }

        function renderLeaderboard() {
            // ... (Leaderboard rendering logic - KEPT AS IS)
            const data = calculateLeaderboardData();
            const body = document.getElementById('lb-body');
            
            // Get custom colors
            const cBgBody = document.getElementById('lb-bg-body').value;
            const cBodyText = document.getElementById('lb-body-text-color').value;
            const cHeaderGrad1 = document.getElementById('lb-header-grad-1').value;
            const cHeaderGrad2 = document.getElementById('lb-header-grad-2').value;
            const cHeaderText = document.getElementById('lb-header-text-color').value;
            const cPtsGrad1 = document.getElementById('lb-pts-grad-1').value;
            const cPtsGrad2 = document.getElementById('lb-pts-grad-2').value;

            // Apply custom styles
            const banner = document.getElementById('lb-banner');
            banner.style.background = `linear-gradient(135deg, ${cHeaderGrad1}, ${cHeaderGrad2})`;
            document.getElementById('lb-title').style.color = cHeaderText;
            document.getElementById('lb-thead-row').querySelectorAll('th').forEach(th => th.style.color = cHeaderText);
            document.getElementById('lb-thead-row').querySelector('.p-0 div').style.background = `linear-gradient(135deg, ${cPtsGrad1}, ${cPtsGrad2})`;
            document.getElementById('lb-table').querySelector('div.overflow-x-auto').style.backgroundColor = cBgBody;

            body.style.color = cBodyText;
            
            body.innerHTML = data.map((t, i) => `
                <tr style="background-color: ${i % 2 === 0 ? cBgBody : 'rgba(255, 255, 255, 0.03)'};" class="hover:bg-gray-700 transition">
                    <td class="p-4 text-center font-black" style="color: ${t.color};">${i + 1}</td>
                    <td class="p-4 font-bold uppercase">${t.name}</td>
                    <td class="p-4 text-center">${t.p}</td>
                    <td class="p-4 text-center">${t.w}</td>
                    <td class="p-4 text-center">${t.d}</td>
                    <td class="p-4 text-center">${t.l}</td>
                    <td class="p-4 text-center">${t.gf}/${t.ga}</td>
                    <td class="p-4 text-center">${t.gd > 0 ? '+' : ''}${t.gd}</td>
                    <td class="p-0 text-center">
                        <div class="h-full py-4 px-2 font-black text-xl" style="background: linear-gradient(135deg, ${cPtsGrad1}, ${cPtsGrad2}); color: black;">${t.pts}</div>
                    </td>
                </tr>
            `).join('');
        }

        // --- 2. SCHEDULE (KEPT AS IS) ---
        function openAddSchedModal() {
            // ... (Schedule modal logic - KEPT AS IS)
            updateDropdowns();
            document.getElementById('sched-modal').classList.remove('hidden');
        }
        function handleSchedSubmit(e) {
            // ... (Schedule submit logic - KEPT AS IS)
            e.preventDefault();
            const id = document.getElementById('sc-edit-id').value;
            const obj = { 
                id: id || Date.now(), 
                date: document.getElementById('sc-date').value, 
                time: document.getElementById('sc-time').value, 
                week: document.getElementById('sc-week').value, 
                teamA: document.getElementById('sc-team-a').value, 
                teamB: document.getElementById('sc-team-b').value, 
                group: document.getElementById('sc-group').value, 
                result: null // Status: Pending 
            };
            if (id) {
                const idx = schedules.findIndex(s => s.id == id);
                if (idx !== -1) schedules[idx] = obj;
            } else {
                schedules.push(obj);
            }
            save();
            document.getElementById('sched-modal').classList.add('hidden');
            document.getElementById('sc-edit-id').value = '';
            e.target.reset();
        }

        function editSched(id) {
            // ... (Schedule edit logic - KEPT AS IS)
            const sched = schedules.find(s => s.id == id);
            if (!sched) return;
            document.getElementById('sc-edit-id').value = sched.id;
            document.getElementById('sc-date').value = sched.date;
            document.getElementById('sc-time').value = sched.time;
            document.getElementById('sc-week').value = sched.week;
            document.getElementById('sc-team-a').value = sched.teamA;
            document.getElementById('sc-team-b').value = sched.teamB;
            document.getElementById('sc-group').value = sched.group;
            openAddSchedModal();
        }

        function delSched(id) {
            // ... (Schedule delete logic - KEPT AS IS)
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            schedules = schedules.filter(s => s.id != id);
            save();
        }

        function setGroupFilter(group, button) {
            // ... (Group filter logic - KEPT AS IS)
            currentGroupFilter = group;
            document.querySelectorAll('.group-tab').forEach(btn => btn.classList.remove('active'));
            if (button) {
                button.classList.add('active');
                document.querySelectorAll('.group-tab').forEach(btn => {
                    btn.style.backgroundColor = btn === button ? themeColor : '#4b5563';
                    btn.style.color = btn === button ? 'black' : 'white';
                });
            }
            renderSchedule();
        }

        function renderSchedule() {
            // ... (Schedule rendering logic - KEPT AS IS)
            const container = document.getElementById('sched-list');
            const cBgColor = document.getElementById('sc-bg-color').value;
            const cTextColor = document.getElementById('sc-text-color').value;
            const cPillColor = document.getElementById('sc-pill-color').value;
            const cHeaderText = document.getElementById('sc-header-text').value;
            const cBgColorMain = document.getElementById('sc-bg-color-main').value;

            document.getElementById('schedule-main-container').style.backgroundColor = cBgColorMain;
            document.getElementById('sc-bg-overlay').style.background = `linear-gradient(to br, ${cBgColor}, ${cBgColorMain})`
            document.getElementById('sc-pill').style.backgroundColor = cPillColor;
            document.getElementById('sc-pill').innerText = cHeaderText;

            const matchesByWeek = schedules
                .filter(s => currentGroupFilter === 'All' || s.group === currentGroupFilter)
                .sort((a, b) => new Date(a.date) - new Date(b.date) || a.time.localeCompare(b.time))
                .reduce((acc, s) => {
                    (acc[s.week] = acc[s.week] || []).push(s);
                    return acc;
                }, {});

            container.innerHTML = Object.entries(matchesByWeek).map(([week, matches]) => {
                const header = `<div class="schedule-group-header" style="background-color: ${cPillColor};">${week}</div>`;
                const list = matches.map(s => {
                    const tA = teams.find(t => t.id == s.teamA);
                    const tB = teams.find(t => t.id == s.teamB);
                    const match = matches.find(m => m.scheduleId == s.id);
                    const isPlayed = match !== undefined;
                    const status = isPlayed ? `<div class="font-black text-2xl" style="color: ${tA.color}"> ${match.scoreA} </div> <div class="text-xl italic font-bold" style="color: ${cTextColor}"> - </div> <div class="font-black text-2xl" style="color: ${tB.color}"> ${match.scoreB} </div>` : '<span class="text-red-400 font-bold">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πà‡∏á</span>';
                    const groupDisplay = s.group !== 'N/A' ? `(${s.group})` : '';
                    
                    // Conditionally show score button (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•) only for unplayed matches in the schedule view
                    const actions = isPlayed 
                        ? `<button onclick="delSched(${s.id})" class="text-red-400 hover:text-red-300 px-2 py-1"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>` 
                        : `<button onclick="openScoreModal(${s.id})" class="text-green-400 hover:text-green-300 px-2 py-1"><i class="fas fa-plus"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</button><button onclick="delSched(${s.id})" class="text-red-400 hover:text-red-300 px-2 py-1"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>`;

                    return `
                        <div class="schedule-match-card transition ${isPlayed ? 'opacity-70' : ''}" 
                            data-sched-id="${s.id}" 
                            data-is-played="${isPlayed}" 
                            onclick="this.classList.toggle('show-actions')"
                            style="background: ${cBgColorMain};">
                            <div class="schedule-team-container team-a" style="color: ${cTextColor};">
                                <div class="text-right">
                                    <div class="font-bold text-lg uppercase">${tA?.name || 'N/A'}</div>
                                    <div class="text-xs text-gray-400 hidden sm:block">${groupDisplay}</div>
                                </div>
                                <img src="${tA?.logo || ''}" class="schedule-team-logo" style="border-color: ${tA?.color || themeColor};" alt="${tA?.name || 'Team A'} Logo">
                                <div class="block sm:hidden text-center mt-2">
                                    <div class="font-bold text-sm uppercase">${tA?.name || 'N/A'}</div>
                                </div>
                            </div>
                            <div class="schedule-center-info" style="color: ${cTextColor};">
                                <div class="font-extrabold text-lg italic tracking-wider outline-text" style="color: ${cTextColor};">VS</div>
                                <div class="text-xl font-black mt-1" style="color: ${cPillColor}">${s.time}</div>
                                <div class="text-base font-bold mt-1" style="color: ${cPillColor}">${formatDate(s.date)}</div>
                                <div class="mt-2 flex items-center justify-center gap-2">${status}</div>
                            </div>
                            <div class="schedule-team-container team-b" style="color: ${cTextColor};">
                                <img src="${tB?.logo || ''}" class="schedule-team-logo" style="border-color: ${tB?.color || themeColor};" alt="${tB?.name || 'Team B'} Logo">
                                <div class="text-left">
                                    <div class="font-bold text-lg uppercase">${tB?.name || 'N/A'}</div>
                                    <div class="text-xs text-gray-400 hidden sm:block">${groupDisplay}</div>
                                </div>
                                <div class="block sm:hidden text-center mt-2">
                                    <div class="font-bold text-sm uppercase">${tB?.name || 'N/A'}</div>
                                </div>
                            </div>
                            <div class="schedule-actions">
                                ${actions}
                            </div>
                        </div>`;
                }).join('');
                return header + list;
            }).join('') || '<p class="text-center text-gray-500 py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>';
        }

        // --- 3. DAILY/ALL STATS (MODIFIED) ---

        // Function to determine rank tag styles
        const getRankStyles = (rank, cScRank4Color, cScRank4Text) => {
            if (rank === 1) return { bg: '#FFD700', text: '#000000', border: '#FFF' }; // Gold
            if (rank === 2) return { bg: '#C0C0C0', text: '#000000', border: '#FFF' }; // Silver
            if (rank === 3) return { bg: '#CD7F32', text: '#FFFFFF', border: '#FFF' }; // Bronze
            // Custom 4+
            return { bg: cScRank4Color, text: cScRank4Text, border: '#000000' };
        };

        // New function to render a scorer card
        const renderScorerCard = (data, isTopScorer, rank, cScBg, cScNameColor, cScBorder, cScoreGrad1, cScoreGrad2, cScoreText, cScRank4Color, cScRank4Text) => {
            const cardStyle = `background: ${cScBg}; border-color: ${cScBorder}; border-width: 3px;`;
            const scoreStyle = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;
            const goalsDisplay = isTopScorer ? data.goals : data.goalsToday;
            const goalsLabel = isTopScorer ? '‡∏õ‡∏£‡∏∞‡∏ï‡∏π' : '‡∏•‡∏π‡∏Å';
            const rankTagHtml = isTopScorer && rank <= 5 ? 
                (() => {
                    const rankStyles = getRankStyles(rank, cScRank4Color, cScRank4Text);
                    const rankTagStyle = `background: ${rankStyles.bg}; color: ${rankStyles.text}; border-color: ${rankStyles.border};`;
                    return `<div class="scorer-rank-tag" style="${rankTagStyle}">${rank}</div>`;
                })() : '';

            return `
                <div class="scorer-card" style="${cardStyle}">
                    ${rankTagHtml}
                    <img src="${data.img || ''}" class="scorer-card-img" style="border-color: ${data.teamColor || 'white'};" alt="${data.name}">
                    <div class="mt-2 w-full">
                        <div class="font-bold text-sm truncate" style="color: ${cScNameColor}">${data.name} (#${data.number||'-'})</div>
                        <div class="text-gray-400 text-xs truncate mb-2">${data.teamName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                        <div class="font-black text-2xl leading-tight inline-block px-3 py-1 rounded shadow-md" style="${scoreStyle}">
                            ${goalsDisplay} <span class="text-xs font-normal">${goalsLabel}</span>
                        </div>
                    </div>
                </div>`;
        };

        function calculateDailyStats(date) {
            // ... (Daily Stats calculation logic - KEPT AS IS)
            // 1. Filter and group goal stats for the selected date
            const dailyGoals = stats.filter(s => s.type === 'goal' && s.date === date);
            const todayCounts = {};
            dailyGoals.forEach(s => todayCounts[s.playerId] = (todayCounts[s.playerId] || 0) + s.count);

            // 2. Calculate Top Scorers (All time)
            const allTimeGoals = stats.filter(s => s.type === 'goal').reduce((acc, s) => {
                acc[s.playerId] = (acc[s.playerId] || 0) + s.count;
                return acc;
            }, {});
            let allTimeScorerData = players.map(p => ({
                id: p.id,
                name: p.name,
                number: p.no,
                img: p.img,
                goals: allTimeGoals[p.id] || 0,
                teamId: p.teamId
            })).filter(d => d.goals > 0);

            // 3. Sort Top Scorers (using name as tie-breaker)
            allTimeScorerData.sort((a, b) => {
                if (b.goals !== a.goals) return b.goals - a.goals;
                return a.name.localeCompare(b.name);
            });

            // 4. Add Rank and Team Info
            let currentRank = 1;
            let currentGoals = -1;
            allTimeScorerData.forEach((d, i) => {
                if (d.goals < currentGoals) {
                    currentRank = i + 1;
                } else if (currentGoals === -1) {
                    currentGoals = d.goals;
                }
                d.rank = currentRank;
                currentGoals = d.goals;
                const t = teams.find(x => x.id == d.teamId);
                d.teamName = t?.name;
                d.teamColor = t?.color;
            });

            // 5. Get Today's Scorer Data
            const todayScorerData = Object.entries(todayCounts).map(([pid, c]) => {
                const p = players.find(x => x.id == pid);
                const t = teams.find(x => x.id == p?.teamId);
                return { 
                    name: p?.name, 
                    number: p?.no, 
                    img: p?.img, 
                    teamName: t?.name, 
                    teamColor: t?.color, 
                    goalsToday: c 
                };
            }).sort((a, b) => b.goalsToday - a.goalsToday); // Sort by goals today

            return { 
                topScorers: allTimeScorerData, 
                todayScorers: todayScorerData 
            };
        }

        function renderDaily() {
            const date = document.getElementById('daily-date').value;
            const sortKey = document.getElementById('daily-scorer-sort').value;
            // Get Match and Banner Colors
            const cTeamName = document.getElementById('daily-team-name-color').value;
            const cBg1 = document.getElementById('daily-row-bg-1').value;
            const cBg2 = document.getElementById('daily-row-bg-2').value;
            const cScoreGrad1 = document.getElementById('daily-score-grad-1').value;
            const cScoreGrad2 = document.getElementById('daily-score-grad-2').value;
            const cScoreText = document.getElementById('daily-score-text-color')?.value || '#000000';
            const cGrad1 = document.getElementById('daily-banner-grad-1').value;
            const cGrad2 = document.getElementById('daily-banner-grad-2').value;
            const cText = document.getElementById('daily-banner-text').value;
            const cBorder = document.getElementById('daily-banner-border').value;
            
            // NEW SCORER CARD COLORS
            const cScBg = document.getElementById('daily-sc-bg').value;
            const cScNameColor = document.getElementById('daily-sc-name-color').value;
            const cScBorder = document.getElementById('daily-sc-border').value;
            const cScRank4Color = document.getElementById('daily-sc-rank-4-color').value;
            const cScRank4Text = document.getElementById('daily-sc-rank-4-text').value;
            const cTodayHeaderColor = document.getElementById('daily-today-header-color').value;

            // Save settings immediately
            save();

            // 1. Banner Styles
            const headerEl = document.getElementById('daily-header');
            headerEl.style.background = `linear-gradient(to right, ${cGrad1}, ${cGrad2})`;
            headerEl.style.borderColor = cBorder;
            document.getElementById('daily-title-edit').style.color = cText;
            document.getElementById('daily-logo-img').style.borderColor = cBorder;
            document.getElementById('daily-title-edit').innerText = `‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ${formatDate(date)} ${themeName}`;

            // Set Today Scorer Header Color
            document.getElementById('daily-today-header').style.color = cTodayHeaderColor;

            // 2. Matches List
            const list = matches.filter(m => m.date === date);
            const cont = document.getElementById('daily-matches-container');
            
            cont.innerHTML = list.map((m, i) => {
                const tA = teams.find(t => t.id == m.teamA);
                const tB = teams.find(t => t.id == m.teamB);
                const bg = i % 2 === 0 ? cBg1 : cBg2;
                const scoreStyleA = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;
                const scoreStyleB = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;

                return `
                    <div class="glass p-3 rounded-xl flex items-center shadow-lg" style="background: ${bg};">
                        <div class="flex-1 text-right pr-4">
                            <div class="text-lg font-black uppercase" style="color: ${cTeamName};">${tA?.name || 'N/A'}</div>
                        </div>
                        <div class="daily-score-box">
                            <div class="daily-score-number font-black" style="${scoreStyleA}">${m.scoreA}</div>
                            <span class="daily-vs" style="color: ${cTeamName}">VS</span>
                            <div class="daily-score-number font-black" style="${scoreStyleB}">${m.scoreB}</div>
                        </div>
                        <div class="flex-1 text-left pl-4">
                            <div class="text-lg font-black uppercase" style="color: ${cTeamName};">${tB?.name || 'N/A'}</div>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-500 py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';

            // 3. Top Scorers (Vertical Grid)
            let { topScorers, todayScorers } = calculateDailyStats(date);

            // Apply custom sorting (only for all-time scorers)
            if (sortKey === 'name') {
                topScorers.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortKey === 'number') {
                topScorers.sort((a, b) => (parseInt(a.number) || 999) - (parseInt(b.number) || 999));
            } else { // default to goals
                // Already sorted by goals in calculateDailyStats
            }

            const topScorersCont = document.getElementById('daily-top-scorers');
            topScorersCont.innerHTML = topScorers.slice(0, 5).map(data => 
                renderScorerCard(data, true, data.rank, cScBg, cScNameColor, cScBorder, cScoreGrad1, cScoreGrad2, cScoreText, cScRank4Color, cScRank4Text)
            ).join('') || '<p class="text-center text-gray-500 py-4 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</p>';

            // 4. Scorers Today (Use same card design, no rank)
            const todayScorersCont = document.getElementById('daily-today-scorers');
            todayScorersCont.innerHTML = todayScorers.map(data => 
                renderScorerCard(data, false, null, cScBg, cScNameColor, cScBorder, cScoreGrad1, cScoreGrad2, cScoreText, cScRank4Color, cScRank4Text)
            ).join('') || '<p class="text-center text-gray-500 py-4 col-span-full">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
        }

        function renderAllStats() {
            // ... (All Stats rendering logic - KEPT AS IS)
            const mode = document.getElementById('stat-filter-type').value;
            const body = document.getElementById('all-stats-body');
            const header = document.getElementById('all-stats-header');
            const statMap = {
                goal: { label: '‡∏õ‡∏£‡∏∞‡∏ï‡∏π', type: 'goal', color: 'text-red-400' },
                yellow: { label: '‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', type: 'yellow', color: 'text-yellow-400' },
                red: { label: '‡πÉ‡∏ö‡πÅ‡∏î‡∏á', type: 'red', color: 'text-red-600' },
                save: { label: '‡πÄ‡∏ã‡∏ü', type: 'save', color: 'text-blue-400' },
            };
            const currentStat = statMap[mode];
            header.innerText = currentStat.label;

            const statCounts = stats.filter(s => s.type === currentStat.type).reduce((acc, s) => {
                acc[s.playerId] = (acc[s.playerId] || 0) + s.count;
                return acc;
            }, {});

            let filteredAndSorted = players.map(p => {
                const t = teams.find(x => x.id == p.teamId);
                return {
                    name: p.name,
                    count: statCounts[p.id] || 0,
                    teamName: t?.name,
                    teamColor: t?.color
                };
            }).filter(p => p.count > 0)
            .sort((a, b) => {
                // Sort by count (desc) then name (asc)
                if (b.count !== a.count) return b.count - a.count;
                return a.name.localeCompare(b.name);
            });

            body.innerHTML = filteredAndSorted.map((p, i) => `
                <tr class="all-stats-row border-b border-gray-800">
                    <td class="p-2 text-center text-gray-400">${i + 1}</td>
                    <td class="p-2 font-bold text-white">${p.name}</td>
                    <td class="p-2 text-center text-xs" style="color: ${p.teamColor};">${p.teamName}</td>
                    <td class="p-2 text-center font-black text-lg ${currentStat.color}">${p.count}</td>
                </tr>
            `).join('') || `<tr><td colspan="4" class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ${currentStat.label} ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td></tr>`;
        }

        // --- 4. STATS & HISTORY (KEPT AS IS) ---
        function updateScheduleMatchDropdown() {
            // ... (Dropdown update logic - KEPT AS IS)
             const dropdown = document.getElementById('m-schedule-id');
            const unplayedSchedules = schedules.filter(s => !matches.some(m => m.scheduleId == s.id));
            
            const options = unplayedSchedules.map(s => {
                const tA = teams.find(t => t.id == s.teamA)?.name || 'N/A';
                const tB = teams.find(t => t.id == s.teamB)?.name || 'N/A';
                return `<option value="${s.id}">${formatDate(s.date)} ${s.time}: ${tA} vs ${tB}</option>`;
            }).join('');

            dropdown.innerHTML = `<option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---</option>` + options;
        }

        function prefillMatchFromSchedule() {
            // ... (Prefill logic - KEPT AS IS)
            const schedId = document.getElementById('m-schedule-id').value;
            const sched = schedules.find(s => s.id == schedId);
            if (sched) {
                document.getElementById('m-team-a').value = sched.teamA;
                document.getElementById('m-team-b').value = sched.teamB;
                document.getElementById('m-date').value = sched.date;
                document.getElementById('m-time').value = sched.time;
            }
        }
        
        function handleMatchSubmit(e) {
            // ... (Match submit logic - KEPT AS IS)
            e.preventDefault();
            const id = document.getElementById('match-edit-id').value;
            const schedId = document.getElementById('m-schedule-id').value;
            
            const obj = {
                id: id || Date.now(),
                date: document.getElementById('m-date').value,
                time: document.getElementById('m-time').value,
                teamA: document.getElementById('m-team-a').value,
                teamB: document.getElementById('m-team-b').value,
                scoreA: parseInt(document.getElementById('m-score-a').value),
                scoreB: parseInt(document.getElementById('m-score-b').value),
                scheduleId: schedId || null // Link to schedule if selected
            };

            if (id) {
                const idx = matches.findIndex(m => m.id == id);
                if (idx !== -1) matches[idx] = obj;
            } else {
                matches.push(obj);
            }
            save();
            resetMatchForm();
        }

        function resetMatchForm() {
            // ... (Match form reset logic - KEPT AS IS)
            document.getElementById('match-edit-id').value = '';
            document.getElementById('m-schedule-id').value = '';
            document.getElementById('m-score-a').value = '0';
            document.getElementById('m-score-b').value = '0';
            document.getElementById('m-team-a').value = '';
            document.getElementById('m-team-b').value = '';
            document.getElementById('m-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('m-time').value = '';
            document.getElementById('match-reset-btn').classList.add('hidden');
        }

        function editMatch(id) {
            // ... (Match edit logic - KEPT AS IS)
            const match = matches.find(m => m.id == id);
            if (!match) return;
            document.getElementById('match-edit-id').value = match.id;
            document.getElementById('m-team-a').value = match.teamA;
            document.getElementById('m-team-b').value = match.teamB;
            document.getElementById('m-score-a').value = match.scoreA;
            document.getElementById('m-score-b').value = match.scoreB;
            document.getElementById('m-date').value = match.date;
            document.getElementById('m-time').value = match.time;
            document.getElementById('m-schedule-id').value = match.scheduleId || '';
            document.getElementById('match-reset-btn').classList.remove('hidden');
            document.getElementById('m-team-a').focus();
        }

        function delMatch(id) {
            // ... (Match delete logic - KEPT AS IS)
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            matches = matches.filter(m => m.id != id);
            save();
        }

        function handleStatSubmit(e) {
            // ... (Stat submit logic - KEPT AS IS)
            e.preventDefault();
            const type = document.getElementById('s-type').value;
            const id = document.getElementById('edit-stat-id').value;
            const scorerId = document.getElementById('s-player').value;
            const obj = { 
                id: id || Date.now(), 
                date: document.getElementById('s-date').value, 
                type: type, 
                teamId: document.getElementById('s-team').value, 
                playerId: scorerId, 
                count: parseInt(document.getElementById('s-count').value), 
                note: document.getElementById('s-note').value 
            };
            if(id) {
                const idx = stats.findIndex(s => s.id == id);
                if(idx !== -1) stats[idx] = obj;
            } else {
                stats.push(obj);
            }
            save();
            resetStatForm();
        }

        function resetStatForm() {
            // ... (Stat form reset logic - KEPT AS IS)
            document.getElementById('edit-stat-id').value = '';
            document.getElementById('s-type').value = 'goal';
            document.getElementById('s-team').value = '';
            document.getElementById('s-player').value = '';
            document.getElementById('s-count').value = '1';
            document.getElementById('s-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('s-note').value = '';
            document.getElementById('stat-reset-btn').classList.add('hidden');
            updatePlayerDropdown('');
        }

        function editStat(id) {
            // ... (Stat edit logic - KEPT AS IS)
            const stat = stats.find(s => s.id == id);
            if (!stat) return;
            document.getElementById('edit-stat-id').value = stat.id;
            document.getElementById('s-type').value = stat.type;
            document.getElementById('s-team').value = stat.teamId;
            updatePlayerDropdown(stat.teamId); // Update dropdown before setting player
            document.getElementById('s-player').value = stat.playerId;
            document.getElementById('s-count').value = stat.count;
            document.getElementById('s-date').value = stat.date;
            document.getElementById('s-note').value = stat.note || '';
            document.getElementById('stat-reset-btn').classList.remove('hidden');
            document.getElementById('s-type').focus();
        }

        function delStat(id) {
            // ... (Stat delete logic - KEPT AS IS)
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            stats = stats.filter(s => s.id != id);
            save();
        }

        function showHistory(type, button) {
            // ... (History tab logic - KEPT AS IS)
            document.getElementById('history-match-list').classList.add('hidden');
            document.getElementById('history-stat-list').classList.add('hidden');
            document.querySelectorAll('.hist-tab').forEach(btn => {
                btn.style.color = '#9ca3af'; // gray-400
                btn.style.borderColor = 'transparent';
            });

            document.getElementById(`history-${type}-list`).classList.remove('hidden');
            if (button) {
                button.style.color = themeColor;
                button.style.borderColor = themeColor;
            }

            if (type === 'match') renderMatchHistory();
            if (type === 'stat') renderStatHistory();
        }

        function renderMatchHistory() {
            // ... (Match history rendering logic - KEPT AS IS)
            const list = document.getElementById('history-match-list');
            list.innerHTML = matches.sort((a,b) => b.id - a.id).map(m => {
                const tA = teams.find(t => t.id == m.teamA);
                const tB = teams.find(t => t.id == m.teamB);
                const resultText = m.scoreA > m.scoreB ? `<span class="text-green-400 font-bold">‡∏ä‡∏ô‡∏∞</span>` : m.scoreA < m.scoreB ? `<span class="text-red-400 font-bold">‡πÅ‡∏û‡πâ</span>` : `<span class="text-yellow-400 font-bold">‡πÄ‡∏™‡∏°‡∏≠</span>`;

                return `
                    <div class="p-3 bg-gray-900 rounded-lg border-l-4 border-r-4 border-gray-700 hover:border-blue-500 transition">
                        <div class="text-xs text-gray-400 mb-1">${formatDate(m.date)} ${m.time}</div>
                        <div class="flex items-center justify-between text-lg font-bold">
                            <div class="text-right flex-1" style="color: ${tA?.color || 'white'}">${tA?.name || 'N/A'}</div>
                            <div class="text-center w-24">
                                <span class="text-xl font-black">${m.scoreA}</span> - <span class="text-xl font-black">${m.scoreB}</span>
                            </div>
                            <div class="text-left flex-1" style="color: ${tB?.color || 'white'}">${tB?.name || 'N/A'}</div>
                        </div>
                        <div class="text-center text-sm mt-1">‡∏ó‡∏µ‡∏° ${tA?.name || 'N/A'} ${resultText}</div>
                        <div class="flex gap-3 justify-center mt-2">
                            <button onclick="editMatch(${m.id})" class="text-blue-400 hover:text-blue-300 text-sm"><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="delMatch(${m.id})" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>';
        }
        
        function renderStatHistory() {
            // ... (Stat history rendering logic - KEPT AS IS)
            const list = document.getElementById('history-stat-list');
            const iconMap = { goal:'‚öΩ', yellow:'üü®', red:'üü•', save:'üß§' }; 
            list.innerHTML = stats.sort((a,b) => b.id - a.id).map(s => {
                const p = players.find(x => x.id == s.playerId);
                const t = teams.find(x => x.id == s.teamId);
                const typeColor = s.type === 'goal' ? 'text-red-400' : s.type === 'yellow' ? 'text-yellow-400' : s.type === 'red' ? 'text-red-600' : 'text-blue-400';

                return `
                    <div class="p-3 bg-gray-900 rounded-lg border-l-4 border-r-4 border-gray-700 hover:border-green-500 transition">
                        <div class="text-xs text-gray-400 mb-1">${formatDate(s.date)} (${t?.name || 'N/A'})</div>
                        <div class="flex items-center justify-between font-bold">
                            <div class="text-white">${iconMap[s.type]} ${p?.name || 'N/A'} (#${p?.no || '-'})</div>
                            <div class="text-xl font-black ${typeColor}">+${s.count}</div>
                        </div>
                        ${s.note ? `<div class="text-xs text-gray-500 italic mt-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${s.note}</div>` : ''}
                        <div class="flex gap-3 justify-end mt-2">
                            <button onclick="editStat(${s.id})" class="text-blue-400 hover:text-blue-300 text-sm"><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="delStat(${s.id})" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</p>';
        }

        // --- 5. TEAMS (KEPT AS IS) ---
        async function handleTeamSubmit(e) {
             // ... (Team submit logic - KEPT AS IS)
            e.preventDefault();
            const id = document.getElementById('team-edit-id').value;
            const logoFile = document.getElementById('team-logo').files[0];
            let logoBase64 = '';

            if (logoFile) {
                logoBase64 = await compressImage(logoFile);
            }

            const existingTeam = id ? teams.find(t => t.id === id) : null;
            if (logoBase64 && existingTeam) {
                // Keep old logo if no new file is selected and not editing
            } else if (!logoBase64 && existingTeam) {
                logoBase64 = existingTeam.logo;
            }


            const obj = {
                id: id || 't' + Date.now(),
                name: document.getElementById('team-name').value,
                color: document.getElementById('team-color').value,
                tel: document.getElementById('team-tel').value,
                group: document.getElementById('team-group').value,
                logo: logoBase64
            };

            if (id) {
                const idx = teams.findIndex(t => t.id == id);
                if (idx !== -1) teams[idx] = obj;
            } else {
                teams.push(obj);
            }
            save();
            resetTeamForm();
        }

        function resetTeamForm() {
            // ... (Team form reset logic - KEPT AS IS)
            document.getElementById('team-edit-id').value = '';
            document.getElementById('team-name').value = '';
            document.getElementById('team-color').value = '#ffffff';
            document.getElementById('team-tel').value = '';
            document.getElementById('team-group').value = 'N/A';
            document.getElementById('team-logo').value = null;
            document.getElementById('team-reset-btn').classList.add('hidden');
        }

        function editTeam(id) {
            // ... (Team edit logic - KEPT AS IS)
            const team = teams.find(t => t.id == id);
            if (!team) return;
            document.getElementById('team-edit-id').value = team.id;
            document.getElementById('team-name').value = team.name;
            document.getElementById('team-color').value = team.color;
            document.getElementById('team-tel').value = team.tel || '';
            document.getElementById('team-group').value = team.group || 'N/A';
            // Note: Cannot prefill file input for security reasons
            document.getElementById('team-reset-btn').classList.remove('hidden');
        }

        function delTeam(id) {
            // ... (Team delete logic - KEPT AS IS)
            if (!confirm('‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡∏ó‡∏ä‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            teams = teams.filter(t => t.id != id);
            players = players.filter(p => p.teamId != id);
            stats = stats.filter(s => s.teamId != id);
            matches = matches.filter(m => m.teamA != id && m.teamB != id);
            schedules = schedules.filter(s => s.teamA != id && s.teamB != id);
            save();
        }
        
        function renderTeams() {
            // ... (Team rendering logic - KEPT AS IS)
            const list = document.getElementById('team-list');
            list.innerHTML = teams.map(t => `
                <div class="glass p-4 rounded-xl flex flex-col items-center text-center border-b-4" style="border-color: ${t.color};">
                    ${t.logo ? `<img src="${t.logo}" class="logo-circle w-16 h-16 mb-2 border-2 border-white bg-white" alt="${t.name} Logo">` : `<div class="w-16 h-16 rounded-full bg-gray-700 mb-2 flex items-center justify-center text-xl text-white font-bold">${t.name.slice(0, 1)}</div>`}
                    <div class="font-bold text-lg" style="color: ${t.color};">${t.name}</div>
                    <div class="text-sm text-gray-400">${t.group && t.group !== 'N/A' ? `‡∏Å‡∏•‡∏∏‡πà‡∏° ${t.group}` : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏•‡∏∏‡πà‡∏°'}</div>
                    <div class="flex gap-2 mt-3">
                        <button onclick="editTeam('${t.id}')" class="text-blue-400 hover:text-blue-300 text-sm"><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="delTeam('${t.id}')" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                    </div>
                </div>`).join('') || '<p class="text-center text-gray-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</p>';
        }

        // --- 6. PLAYERS (KEPT AS IS) ---
        function openAddPlayerModal(id) {
            // ... (Player modal logic - KEPT AS IS)
            updateDropdowns(); // Update team list
            document.getElementById('p-id').value = id || '';
            if(id) {
                document.getElementById('player-modal-title').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞';
                const player = players.find(p => p.id == id);
                if (player) {
                    document.getElementById('p-name').value = player.name;
                    document.getElementById('p-no').value = player.no;
                    document.getElementById('p-team').value = player.teamId;
                    document.getElementById('p-manager').checked = player.manager;
                }
            } else {
                document.getElementById('player-modal-title').innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏´‡∏°‡πà';
            }
            document.getElementById('player-modal').classList.remove('hidden');
        }

        async function handlePlayerSubmit(e) {
            // ... (Player submit logic - KEPT AS IS)
            e.preventDefault();
            const id = document.getElementById('p-id').value;
            const imgFile = document.getElementById('p-img').files[0];
            let imgBase64 = '';

            if (imgFile) {
                imgBase64 = await compressImage(imgFile);
            }

            const existingPlayer = id ? players.find(p => p.id === id) : null;
            if (imgBase64 && existingPlayer) {
                // Keep old image if no new file is selected and not editing
            } else if (!imgBase64 && existingPlayer) {
                imgBase64 = existingPlayer.img;
            }

            const obj = {
                id: id || 'p' + Date.now(),
                name: document.getElementById('p-name').value,
                no: document.getElementById('p-no').value,
                teamId: document.getElementById('p-team').value,
                manager: document.getElementById('p-manager').checked,
                img: imgBase64
            };

            if (id) {
                const idx = players.findIndex(p => p.id == id);
                if (idx !== -1) players[idx] = obj;
            } else {
                players.push(obj);
            }
            save();
            document.getElementById('player-modal').classList.add('hidden');
            resetPlayerForm();
        }

        function resetPlayerForm() {
            // ... (Player form reset logic - KEPT AS IS)
            document.getElementById('p-id').value = '';
            document.getElementById('p-name').value = '';
            document.getElementById('p-no').value = '';
            document.getElementById('p-team').value = '';
            document.getElementById('p-manager').checked = false;
            document.getElementById('p-img').value = null;
        }

        function delPlayer(id) {
            // ... (Player delete logic - KEPT AS IS)
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ')) return;
            players = players.filter(p => p.id != id);
            stats = stats.filter(s => s.playerId != id);
            save();
        }

        function renderTeamsTabs(selectedId) {
            // ... (Team tabs rendering logic - KEPT AS IS)
            const tabsContainer = document.getElementById('player-tabs-container');
            let html = `<button onclick="renderPlayers('all', this)" class="team-tab ${selectedId === 'all' ? 'active' : ''} text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: ${selectedId === 'all' ? themeColor : '#4b5563'}; color: ${selectedId === 'all' ? 'black' : 'white'};">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`;
            html += teams.map(t => `
                <button onclick="renderPlayers('${t.id}', this)" class="team-tab ${selectedId == t.id ? 'active' : ''} text-black px-4 py-1 rounded-full text-sm font-bold transition hover:opacity-80" style="background-color: ${selectedId == t.id ? themeColor : '#4b5563'}; color: ${selectedId == t.id ? 'black' : 'white'};">
                    ${t.name}
                </button>
            `).join('');
            tabsContainer.innerHTML = html;
        }
        
        function renderPlayers(teamId = 'all', button) {
            // ... (Player rendering logic - KEPT AS IS)
            currentTeamView = teamId;
            const list = document.getElementById('player-list');
            const teamFilter = teamId === 'all' ? players : players.filter(p => p.teamId == teamId);
            
            // Update tabs state visually
            if (button) {
                document.querySelectorAll('.team-tab').forEach(btn => {
                    btn.style.backgroundColor = '#4b5563';
                    btn.style.color = 'white';
                });
                button.style.backgroundColor = themeColor;
                button.style.color = 'black';
            }

            list.innerHTML = teamFilter.map(p => {
                const t = teams.find(x => x.id == p.teamId);
                const managerTag = p.manager ? `<div class="absolute top-1 right-1 bg-blue-600 text-white text-[10px] px-2 rounded-full font-bold">Manager</div>` : '';
                return `
                    <div class="player-card rounded-xl overflow-hidden relative" onclick="openAddPlayerModal('${p.id}')">
                        <div class="player-photo-container" style="border-bottom-color: ${t?.color || themeColor};">
                            <div class="player-num-tag" style="background: ${t?.color || themeColor};">${p.no || '-'}</div>
                            ${p.img ? `<img src="${p.img}" alt="${p.name}">` : `<div class="flex items-center justify-center w-full h-full text-4xl font-black text-gray-500 bg-gray-900">${p.name.slice(0, 1)}</div>`}
                            ${managerTag}
                        </div>
                        <div class="p-3 text-center">
                            <div class="font-bold text-sm truncate">${p.name}</div>
                            <div class="text-xs text-gray-400 truncate">${t?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                            <div class="flex gap-2 justify-center mt-2">
                                <button onclick="event.stopPropagation(); delPlayer('${p.id}')" class="text-red-400 hover:text-red-300 text-xs"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                            </div>
                        </div>
                    </div>`;
            }).join('') || `<p class="text-center text-gray-400 py-10 col-span-full">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ</p>`;
        }
        
        // --- UTILITIES (KEPT AS IS) ---
        function updatePlayerDropdown(teamId) {
            // ... (Player dropdown update logic - KEPT AS IS)
            const dropdown = document.getElementById('s-player');
            const filteredPlayers = teamId ? players.filter(p => p.teamId == teamId) : players;
            
            const options = filteredPlayers.map(p => `<option value="${p.id}">${p.name} (#${p.no || '-'})</option>`).join('');
            dropdown.innerHTML = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</option>` + options;
        }

        function adjStat(val) {
            // ... (Adjust stat count logic - KEPT AS IS)
            const input = document.getElementById('s-count');
            let current = parseInt(input.value);
            current = Math.max(1, current + val);
            input.value = current;
        }

        function toggleSettings() {
            // ... (Toggle settings logic - KEPT AS IS)
            const modal = document.getElementById('settings-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                // Ensure inputs are updated when modal opens
                const themeInput = document.getElementById('theme-color-input');
                themeInput.value = themeColor;
                document.getElementById('secondary-color-input').value = secondaryColor;
                document.getElementById('theme-name-input').value = themeName;
            }
        }
        
        function clearAllData() {
            // ... (Clear data logic - KEPT AS IS)
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ó‡∏µ‡∏°, ‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞, ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥, ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ')) return;
            localStorage.clear();
            teams = DEFAULT_TEAMS;
            players = DEFAULT_PLAYERS;
            matches = [];
            stats = [];
            schedules = [];
            globalLogo = '';
            themeName = 'JAKHONG SYSTEM';
            themeColor = '#facc15';
            secondaryColor = '#1c365b';
            alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î');
            window.location.reload();
        }

        function exportData() {
            // ... (Export data logic - KEPT AS IS)
            const data = {
                teams,
                players,
                matches,
                stats,
                schedules,
                globalLogo,
                themeName,
                themeColor,
                secondaryData: secondaryColor
            };
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `jakhong_league_backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            // ... (Import data logic - KEPT AS IS)
            if (!input.files[0]) return;
            if (!confirm("‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?")) {
                input.value = null;
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    teams = importedData.teams || [];
                    players = importedData.players || [];
                    matches = importedData.matches || [];
                    stats = importedData.stats || [];
                    schedules = importedData.schedules || [];
                    globalLogo = importedData.globalLogo || "";
                    themeName = importedData.themeName || 'JAKHONG SYSTEM';
                    themeColor = importedData.themeColor || '#facc15';
                    secondaryColor = importedData.secondaryData || importedData.secondaryColor || '#1c365b'; // Handle old key

                    save(); 
                    alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
                    document.getElementById('settings-modal').classList.add('hidden');
                    input.value = null;

                } catch (error) {
                    alert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå: ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢");
                    console.error("Import Error:", error);
                    input.value = null;
                }
            };
            reader.readAsText(file);
        }

        // --- INIT ---
        window.onload = function() {
            renderTheme();
            loadDailySettings(); // Load daily settings on init
            // Set default date if empty
            const dailyDate = document.getElementById('daily-date');
            if (dailyDate && !dailyDate.value) {
                dailyDate.value = new Date().toISOString().split('T')[0];
            }
            // Set default date in stats form
            const matchDate = document.getElementById('m-date');
            if (matchDate && !matchDate.value) {
                 matchDate.value = new Date().toISOString().split('T')[0];
            }
            const statDate = document.getElementById('s-date');
            if (statDate && !statDate.value) {
                 statDate.value = new Date().toISOString().split('T')[0];
            }
            renderAll();
            // Start on the home page if no fragment is present
            const currentViewId = window.location.hash.substring(1) || 'home';
            const initialButton = document.querySelector(`.nav-btn[onclick*="'${currentViewId}'"]`);
            if (initialButton) {
                nav(currentViewId, initialButton);
            } else {
                 nav('home', document.querySelector(`.nav-btn[onclick*="'home'"]`));
            }
        };

    </script>
</body>
</html>
