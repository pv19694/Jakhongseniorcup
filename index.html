

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jakhong League System 4.2 (Modified)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,300;0,400;0,600;0,800;1,800&display=swap" rel="stylesheet">

    <style>
        /* --- DYNAMIC THEME VARIABLES (NEW) --- */
        :root {
            --primary-color: #facc15; /* Default Yellow-400 (Accent) */
            --secondary-color: #1c365b; /* Default Dark Blue (Header/Base Gradient Start) */
            --theme-end: #0c1626;   /* Very Dark Blue (Fixed Background Base) */
        }
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--theme-end);
            color: white;
            background-image: radial-gradient(circle at top right, #34050520 0%, transparent 40%),
                              radial-gradient(circle at bottom left, #1a1a1a 0%, transparent 40%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(12, 22, 38, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .navbar {
            background: rgba(12, 22, 38, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--primary-color);
        }
        .nav-btn {
            color: #ccc;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .nav-btn.active {
            background: var(--primary-color); 
            color: #000;
            font-weight: 700;
            border: 1px solid var(--primary-color);
            transform: scale(1.05);
        }
        .nav-btn:hover:not(.active) {
            background: rgba(var(--primary-color), 0.1); 
            color: var(--primary-color);
        }
        .logo-circle {
            border-radius: 50%;
            object-fit: cover;
            aspect-ratio: 1/1;
        }

        /* Player Card Design (Kept minimal style) */
        .player-card {
            background: linear-gradient(145deg, #1f2937, #0c1626);
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .player-photo-container {
            position: relative;
            overflow: hidden;
            background-color: #0c1626;
            border-bottom: 3px solid var(--primary-color);
            aspect-ratio: 3 / 4; 
        }
        .player-photo-container img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            object-position: top center;
        }
        /* Player Number Style (Circular only) */
        .player-num-tag {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--primary-color); 
            color: black;
            font-size: 0.9rem;
            font-weight: 900;
            width: 32px; /* Slightly larger circle */
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid white;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); } 
        .no-scrollbar::-webkit-scrollbar { display: none; }

        .outline-text {
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
        }
        
        /* Schedule Grouping */
        .schedule-group-header {
            background-color: var(--primary-color); 
            color: black;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            margin-top: 1.5rem;
            box-shadow: 0 4px 10px rgba(var(--primary-color), 0.2); 
        }
        /* Daily Summary Score Style (FIXED: Score Overlap) */
        .daily-score-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem; /* 3xl */
            font-weight: 900; /* black */
            letter-spacing: -0.05em; /* tracking-tighter */
            position: relative;
        }
        /* --- FIX: REMOVED TEXT SHADOW ON SCORE NUMBERS --- */
        .daily-score-number {
            padding: 0 0.5rem;
            border-radius: 6px;
            /* text-shadow: 2px 2px 0 #000;  <--- REMOVED */
            line-height: 1;
            z-index: 10; 
        }
        .daily-vs {
            /* FIX: Make VS smaller and central */
            font-size: 1rem;
            font-weight: 700;
            margin: 0 0.3rem;
            z-index: 5;
            color: #ccc;
        }

        /* FIX: Today Scorer Number Tag */
        .today-scorer-num-tag {
            position: absolute;
            top: 5px;
            right: 5px;
            background: black; 
            color: white; 
            font-size: 0.7rem;
            font-weight: 900;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* --- SCHEDULE CARD NEW DESIGN --- */
        .schedule-match-card {
            background: #111827; /* gray-900 */
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 150px 1fr; /* Team A | Center Info | Team B */
            align-items: center;
            cursor: pointer;
            overflow: hidden;
        }
        .schedule-match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }
        
        .schedule-team-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 50%;
            background-color: white;
            padding: 4px;
            border: 3px solid transparent;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* Center Info Style */
        .schedule-center-info {
            position: relative;
            text-align: center;
            padding: 1rem 0;
            z-index: 10;
        }
        /* VS Separator (Cooler effect) */
        .schedule-center-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 100%;
            background: repeating-linear-gradient(to bottom, var(--primary-color), var(--primary-color) 4px, transparent 4px, transparent 8px);
            opacity: 0.2;
            z-index: 5;
        }

        /* Action Buttons Container (Hidden by default) - REMOVED EDIT BUTTON */
        .schedule-actions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .schedule-match-card.show-actions .schedule-actions {
            opacity: 1;
            visibility: visible;
        }
        /* Team Containers */
        .schedule-team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        .schedule-team-container.team-a { text-align: right; }
        .schedule-team-container.team-b { text-align: left; }
        .schedule-team-container .flex { margin-top: 8px; }

        /* Media Query for larger screens */
        @media (min-width: 640px) {
            .schedule-team-container.team-a { 
                flex-direction: row; 
                justify-content: flex-end;
                text-align: right;
                gap: 12px;
            }
            .schedule-team-container.team-b { 
                flex-direction: row; 
                justify-content: flex-start;
                text-align: left;
                gap: 12px;
            }
            /* Adjust padding on larger screens */
            .schedule-team-container { padding: 1.5rem 1rem; }
        }

        /* --- NEW: Daily Top Scorer Grid Design (Desktop) --- */
        .top-scorer-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr); /* Default to 1 column */
            gap: 1rem;
        }
        @media (min-width: 768px) { /* md: */
            .top-scorer-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (min-width: 1024px) { /* lg: */
            .top-scorer-grid {
                grid-template-columns: repeat(5, 1fr); /* 5 columns for top 5 */
            }
        }
        .scorer-card {
            background: #1f2937;
            border-radius: 12px;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            transition: all 0.2s;
        }
        .scorer-card.is-top {
            border-color: var(--primary-color);
        }
        .scorer-card-img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 3px solid white;
            margin-bottom: 0.5rem;
            aspect-ratio: 3/4;
        }
        .scorer-rank-tag {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            background: var(--primary-color);
            color: black;
            font-size: 1.25rem;
            font-weight: 900;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 3px solid black;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* --- NEW: All Stats Filter Styles --- */
        .all-stats-row {
            transition: all 0.1s;
        }
        .all-stats-row:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
    </style>
</head>
<body class="flex flex-col">

    <nav class="navbar sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg border border-white" 
                         style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color))">
                        <i class="fas fa-trophy text-black"></i>
                    </div>
                    <h1 class="text-xl font-extrabold italic uppercase tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500" 
                        id="nav-title">
                        JAKHONG SYSTEM
                    </h1>
                </div>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white transition"><i class="fas fa-cog text-xl"></i></button>
            </div>
            <div class="flex overflow-x-auto gap-3 pb-3 no-scrollbar">
                <button onclick="nav('home', this)" class="nav-btn active px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-home"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                <button onclick="nav('leaderboard', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-list-ol"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                <button onclick="nav('schedule', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-calendar-alt"></i> ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á</button>
                <button onclick="nav('daily', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-star"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•/‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</button>
                <button onclick="nav('stats', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-chart-bar"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
                <button onclick="nav('teams', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-shield-alt"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</button>
                <button onclick="nav('players', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</button>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-2 py-6 md:px-4">

        <div id="page-home" class="section fade-in">
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-3" style="color: var(--primary-color);">
                    <i class="fas fa-chart-line"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏µ‡∏Å
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4" style="border-color: var(--primary-color);">
                        <div class="text-3xl font-black" id="stat-total-teams">0</div>
                        <div class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°</div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-green-500">
                        <div class="text-3xl font-black" id="stat-total-stats">0</div>
                        <div class="text-gray-400 text-sm">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div> 
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-red-500">
                        <div class="text-3xl font-black" id="stat-total-goals">0</div>
                        <div class="text-gray-400 text-sm">‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ï‡∏π</div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-blue-500">
                        <div class="text-3xl font-black" id="stat-total-players">0</div>
                        <div class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div id="leader-team-card" class="glass p-5 rounded-2xl border-l-4 flex items-center gap-4" style="border-color: var(--primary-color);">
                    <i class="fas fa-trophy text-4xl" style="color: var(--primary-color);"></i>
                    <div>
                        <div class="text-lg font-bold" style="color: var(--primary-color);">‡∏ó‡∏µ‡∏°‡∏ô‡∏≥‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</div>
                        <div class="text-2xl font-black uppercase" id="leader-team-name">N/A</div>
                        <div class="text-sm text-gray-300"><span id="leader-team-pts">0</span> ‡πÅ‡∏ï‡πâ‡∏°</div>
                    </div>
                </div>
                <div id="top-scorer-card" class="glass p-5 rounded-2xl border-l-4 border-red-500 flex items-center gap-4">
                    <i class="fas fa-futbol text-4xl text-red-500"></i>
                    <div>
                        <div class="text-lg font-bold text-red-400">‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</div>
                        <div class="text-2xl font-black uppercase" id="top-scorer-name">N/A</div>
                        <div class="text-sm text-gray-300"><span id="top-scorer-goals">0</span> ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</div>
                    </div>
                </div>
            </div>


            <div class="glass p-6 rounded-2xl">
                <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-3" style="color: var(--primary-color);">
                    <i class="fas fa-user-tie"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°
                </h2>
                <div id="manager-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    </div>
            </div>
        </div>

        <div id="page-leaderboard" class="section hidden fade-in">
            <div class="glass p-3 rounded-xl mb-4 flex flex-wrap gap-4 items-center text-xs">
                <strong class="text-yellow-400">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á:</strong>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label><input type="color" id="lb-bg-body" value="#1e293b" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</label><input type="color" id="lb-body-text-color" value="#ffffff" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á 1</label><input type="color" id="lb-header-grad-1" value="#1c365b" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á 2</label><input type="color" id="lb-header-grad-2" value="#0c1626" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label><input type="color" id="lb-header-text-color" value="#ffffff" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πâ‡∏° 1</label><input type="color" id="lb-pts-grad-1" value="#facc15" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πâ‡∏° 2</label><input type="color" id="lb-pts-grad-2" value="#e3a008" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
            </div>

            <div class="rounded-xl overflow-hidden shadow-2xl">
                <div id="lb-banner" class="p-6 text-center relative" style="background: linear-gradient(135deg, #1c365b, #0c1626);">
                    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
                    <h2 contenteditable="true" id="lb-title" class="relative text-3xl md:text-5xl font-extrabold uppercase italic outline-text tracking-wider z-10 focus:outline-none focus:border-b border-white" style="color: var(--primary-color);">
                        ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô JAKHONG SENIOR CUP
                    </h2>
                </div>
                
                <div class="overflow-x-auto bg-gray-900">
                    <table class="w-full text-left border-collapse min-w-[700px]" id="lb-table">
                        <thead>
                            <tr class="uppercase text-sm tracking-wider border-b border-white/10" id="lb-thead-row">
                                <th class="p-4" style="color: #ffffff;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="p-4" style="color: #ffffff;">‡∏ó‡∏µ‡∏°</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÅ‡∏Ç‡πà‡∏á</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡∏ä‡∏ô‡∏∞</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÄ‡∏™‡∏°‡∏≠</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÅ‡∏û‡πâ</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÑ‡∏î‡πâ/‡πÄ‡∏™‡∏µ‡∏¢</th>
                                <th class="p-4 text-center" style="color: #ffffff;">+/-</th>
                                <th class="p-0 text-center text-xl">
                                    <div style="background: linear-gradient(135deg, var(--primary-color), #e3a008); color: black;" class="font-black">‡πÅ‡∏ï‡πâ‡∏°</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="lb-body" class="text-base font-medium"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-schedule" class="section hidden fade-in">
            <div class="glass p-3 rounded-xl mb-4 flex flex-wrap gap-4 items-center text-xs">
                <button onclick="openAddSchedModal()" class="bg-green-600 text-white px-3 py-1 rounded font-bold hover:bg-green-500 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏°‡∏ó‡∏ä‡πå</button>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (BG)</label><input type="color" id="sc-bg-color-main" value="#1c365b" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()"></div>
                <label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (Overlay):</label>
                <input type="color" id="sc-bg-color" value="#1c365b" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£:</label>
                <input type="color" id="sc-text-color" value="#ffffff" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
                <input type="color" id="sc-pill-color" value="#facc15" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <input type="text" id="sc-header-text" value="‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô" class="bg-gray-700 text-white px-2 rounded w-32" oninput="renderSchedule()">
            </div>

            <div class="flex flex-col min-h-[500px] rounded-xl overflow-hidden shadow-2xl relative" id="schedule-main-container">
                <div class="flex-1 p-4 md:p-8 relative z-10 w-full" id="sc-container">
                    <div class="text-center mb-8">
                        <span id="sc-pill" class="inline-block px-8 py-2 rounded-full text-xl md:text-2xl font-bold uppercase shadow-lg text-black mb-2 transform skew-x-[-10deg]" style="background-color: var(--primary-color);">
                            ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                        </span>
                    </div>

                    <div class="flex gap-3 justify-center mb-6 overflow-x-auto no-scrollbar" id="group-tabs-container">
                        <button onclick="setGroupFilter('All', this)" class="group-tab active text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: var(--primary-color);">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <button onclick="setGroupFilter('A', this)" class="group-tab bg-gray-700 text-white px-4 py-1 rounded-full text-sm font-medium transition hover:bg-gray-600">‡∏Å‡∏•‡∏∏‡πà‡∏° A</button>
                        <button onclick="setGroupFilter('B', this)" class="group-tab bg-gray-700 text-white px-4 py-1 rounded-full text-sm font-medium transition hover:bg-gray-600">‡∏Å‡∏•‡∏∏‡πà‡∏° B</button>
                    </div>
                    
                    <div id="sched-list" class="space-y-4 max-w-4xl mx-auto">
                        </div>
                </div>

                <div id="sc-bg-overlay" class="absolute inset-0 z-0 bg-gradient-to-br from-blue-900 to-black opacity-90"></div>
            </div>
        </div>

        <div id="page-daily" class="section hidden fade-in">
            <div class="glass p-4 rounded-xl mb-6 flex flex-wrap gap-6 items-end">
                <div>
                    <label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Daily/Stats)</label>
                    <select id="daily-view-mode" class="bg-black border border-gray-600 p-2 rounded text-white text-sm w-full" onchange="renderDaily() || renderAllStats()">
                        <option value="daily">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</option>
                        <option value="stats">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏ó‡∏±‡πâ‡∏á‡∏•‡∏µ‡∏Å)</option>
                    </select>
                </div>
                <div id="daily-controls" class="flex flex-wrap gap-6 items-end">
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="daily-date" class="bg-black border border-gray-600 p-2 rounded text-white text-sm w-full" onchange="renderDaily()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</label>
                        <select id="daily-scorer-sort" class="bg-black border border-gray-600 p-2 rounded text-white text-sm" onchange="renderDaily()">
                            <option value="goals">‡∏õ‡∏£‡∏∞‡∏ï‡∏π (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                            <option value="name">‡∏ä‡∏∑‡πà‡∏≠</option>
                            <option value="number">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</option>
                        </select>
                    </div>

                    <div class="flex gap-2">
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏Å‡∏≠‡∏£‡πå</label><input type="color" id="daily-score-text-color" value="#000000" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏™‡∏Å‡∏≠‡∏£‡πå 1</label><input type="color" id="daily-score-grad-1" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏™‡∏Å‡∏≠‡∏£‡πå 2</label><input type="color" id="daily-score-grad-2" value="#e3a008" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label><input type="color" id="daily-team-name-color" value="#ffffff" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div> 
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ñ‡∏ö 1</label><input type="color" id="daily-row-bg-1" value="#1f2937" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ñ‡∏ö 2</label><input type="color" id="daily-row-bg-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>
                    <div class="flex gap-2">
                        <div><label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå 1</label><input type="color" id="daily-banner-grad-1" value="#1c365b" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå 2</label><input type="color" id="daily-banner-grad-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label><input type="color" id="daily-banner-text" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label><input type="color" id="daily-banner-border" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>
                </div>

                <div id="all-stats-controls" class="hidden">
                    <label class="text-xs text-gray-400 block mb-1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á</label>
                    <select id="stat-filter-type" class="bg-black border border-gray-600 p-2 rounded text-white text-sm" onchange="renderAllStats()">
                        <option value="goal">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="yellow">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="red">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="save">üß§ ‡πÄ‡∏ã‡∏ü (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                    </select>
                </div>
            </div>

            <div id="daily-preview" class="bg-white max-w-[900px] mx-auto shadow-2xl overflow-hidden pb-10 rounded-xl">
                
                <div id="daily-header" class="py-4 px-4 flex flex-wrap items-center justify-between relative border-b-4 border-yellow-500">
                    <div class="flex items-center gap-3 z-10">
                        <img id="daily-logo-img" src="" class="w-12 h-12 object-contain drop-shadow-md bg-white rounded-full p-1 border border-yellow-400">
                        <div contenteditable="true" id="daily-title-edit" class="text-xl md:text-3xl font-extrabold uppercase italic leading-none outline-text text-yellow-400" style="text-shadow: 2px 2px 0 #000;">
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô 25/11/2568 JAKHONG LEAGUE 3
                        </div>
                    </div>
                </div>

                <div id="daily-content">
                    <div class="p-4 md:p-8 bg-gray-900 min-h-[200px] space-y-3" id="daily-matches-container"></div>

                    <div class="grid grid-cols-1 mt-4">
                        
                        <div class="bg-gray-800 p-4 border-b border-gray-700 flex flex-col">
                            <h3 class="text-center font-bold text-yellow-400 uppercase text-lg mb-4 border-b border-gray-700 pb-2">
                                <span id="daily-scorer-header">‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Top 5)</span>
                            </h3>
                            <div id="daily-top-scorers" class="top-scorer-grid">
                                </div>
                        </div>

                        <div class="bg-gradient-to-br from-gray-900 to-black p-4">
                            <h3 class="text-center font-bold text-green-400 uppercase text-lg mb-4 border-b border-gray-700 pb-2">
                                ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                            </h3>
                            <div id="daily-today-scorers" class="top-scorer-grid">
                                </div>
                        </div>
                    </div>
                </div>

                <div id="all-stats-content" class="hidden">
                    <div class="p-4 md:p-8 bg-gray-900 min-h-[200px]">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="uppercase text-xs tracking-wider border-b border-white/10 text-gray-400">
                                    <th class="p-2">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                    <th class="p-2">‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</th>
                                    <th class="p-2 text-center">‡∏ó‡∏µ‡∏°</th>
                                    <th class="p-2 text-center" id="all-stats-header">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                </tr>
                            </thead>
                            <tbody id="all-stats-body" class="text-sm font-medium">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-stats" class="section hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-2xl h-fit">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ / ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á</h2>
                    <div class="mb-6 p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-gray-400 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏™‡∏Å‡∏≠‡∏£‡πå</h3>
                        <div class="mb-3">
                            <label class="text-xs text-gray-400">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á (‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πà‡∏á):</label>
                            <select id="m-schedule-id" class="w-full bg-gray-800 p-2 rounded text-xs" onchange="prefillMatchFromSchedule()">
                                <option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---</option>
                            </select>
                        </div>
                        <form onsubmit="handleMatchSubmit(event)" class="space-y-3">
                            <input type="hidden" id="match-edit-id">
                            <div class="flex gap-4 items-end">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πà‡∏á</label>
                                    <input type="date" id="m-date" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏Å‡∏•‡∏∏‡πà‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                                    <select id="m-group" class="w-full bg-gray-800 p-2 rounded border border-gray-600">
                                        <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                                        <option value="A">‡∏Å‡∏•‡∏∏‡πà‡∏° A</option>
                                        <option value="B">‡∏Å‡∏•‡∏∏‡πà‡∏° B</option>
                                        <option value="C">‡∏Å‡∏•‡∏∏‡πà‡∏° C</option>
                                        <option value="D">‡∏Å‡∏•‡∏∏‡πà‡∏° D</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <select id="m-team-a" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required></select>
                                <input type="number" id="m-score-a" class="w-16 bg-gray-800 p-2 rounded border border-gray-600 text-center text-xl font-black" value="0" min="0" required>
                            </div>
                            <div class="text-center text-sm font-bold text-gray-400">VS</div>
                            <div class="flex items-center gap-4">
                                <select id="m-team-b" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required></select>
                                <input type="number" id="m-score-b" class="w-16 bg-gray-800 p-2 rounded border border-gray-600 text-center text-xl font-black" value="0" min="0" required>
                            </div>
                            <button id="btn-match-save" class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition mt-4" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á</button>
                            <button type="button" id="btn-match-cancel" onclick="resetMatchForm()" class="w-full bg-gray-600 py-2 rounded mt-2 hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                        </form>
                    </div>

                    <div class="p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-gray-400 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏õ‡∏£‡∏∞‡∏ï‡∏π / ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á / ‡∏Ø‡∏•‡∏Ø)</h3>
                        <form onsubmit="handleStatSubmit(event)" class="space-y-3">
                            <input type="hidden" id="edit-stat-id">
                            <div class="flex gap-4 items-end">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                    <input type="date" id="s-date" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</label>
                                    <select id="s-team" class="w-full bg-gray-800 p-2 rounded border border-gray-600" onchange="updatePlayerDropdown('s-team', 's-player')" required></select>
                                </div>
                            </div>
                            <div class="flex gap-4 items-end">
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</label>
                                    <select id="s-player" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required></select>
                                </div>
                                <div class="flex-1">
                                    <label class="text-xs text-gray-400">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</label>
                                    <select id="s-type" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                                        <option value="goal">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
                                        <option value="yellow">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
                                        <option value="red">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</option>
                                        <option value="save">üß§ ‡πÄ‡∏ã‡∏ü</option>
                                    </select>
                                </div>
                                <div class="w-20">
                                    <label class="text-xs text-gray-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                                    <input type="number" id="s-count" class="w-full bg-gray-800 p-2 rounded border border-gray-600 text-center font-bold" value="1" min="1" required>
                                </div>
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà, ‡∏à‡∏∏‡∏î‡πÇ‡∏ó‡∏©)</label>
                                <input type="text" id="s-note" class="w-full bg-gray-800 p-2 rounded border border-gray-600">
                            </div>
                            <button id="btn-stat-save" class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition mt-4" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
                            <button type="button" id="btn-stat-cancel" onclick="resetStatForm()" class="w-full bg-gray-600 py-2 rounded mt-2 hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                        </form>
                    </div>
                </div>

                <div class="glass p-6 rounded-2xl flex flex-col max-h-[800px]">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
                    <div class="flex mb-4 border-b border-gray-700">
                        <button onclick="showHistory('match', this)" id="hist-tab-match" class="hist-tab px-4 py-2 text-sm font-bold border-b-2" style="color: var(--primary-color); border-color: var(--primary-color);">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
                        <button onclick="showHistory('stat', this)" id="hist-tab-stat" class="hist-tab px-4 py-2 text-sm font-bold text-gray-400 hover:text-white">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
                    </div>
                    <div class="overflow-y-auto pr-2 space-y-2 flex-1 custom-scrollbar">
                        <div id="history-match-list" class="space-y-2"></div>
                        <div id="history-stat-list" class="space-y-2 hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-teams" class="section hidden fade-in">
            <div class="glass p-6 rounded-2xl mb-8">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h2>
                <form onsubmit="handleTeamSubmit(event)" class="flex flex-wrap gap-4 items-end">
                    <input type="hidden" id="team-edit-id">
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label>
                        <input type="text" id="team-name" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏ó‡∏µ‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ)</label>
                        <input type="color" id="team-color" class="w-10 h-10 rounded cursor-pointer block mt-1">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î)</label>
                        <input type="tel" id="team-tel" class="w-full bg-gray-800 p-2 rounded border border-gray-600">
                    </div>
                    <div>
                        <button id="btn-team-save" class="text-black py-2 px-6 rounded font-bold hover:opacity-90 transition whitespace-nowrap" style="background-color: var(--primary-color);">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</button>
                        <button type="button" id="btn-team-cancel" onclick="resetTeamForm()" class="bg-gray-600 py-2 px-6 rounded ml-2 hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </form>
            </div>

            <div class="glass p-6 rounded-2xl">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
                <div id="teams-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
            </div>
        </div>

        <div id="page-players" class="section hidden fade-in">
            <div class="glass p-6 rounded-2xl mb-8">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</h2>
                <div id="team-tabs-container" class="flex overflow-x-auto gap-3 pb-3 mb-6 border-b border-gray-700 no-scrollbar">
                    </div>
                <div id="players-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                    </div>
            </div>
        </div>

    </main>

    <div id="settings-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-lg">
            <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div class="space-y-4">
                <div class="p-3 bg-gray-800 rounded-lg">
                    <h4 class="font-bold text-gray-300 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏µ‡∏Å (‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô Navbar / Banner)</h4>
                    <input type="text" id="theme-name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏µ‡∏Å" class="w-full bg-gray-700 p-2 rounded mb-2" oninput="updateThemeAndSave()">
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å (Primary/Accent)</label>
                            <input type="color" id="theme-color-input" class="w-full h-10 rounded cursor-pointer block mt-1" oninput="updateThemeAndSave()">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏£‡∏≠‡∏á (Secondary/Header BG)</label>
                            <input type="color" id="secondary-color-input" class="w-full h-10 rounded cursor-pointer block mt-1" oninput="updateThemeAndSave()">
                        </div>
                    </div>
                </div>

                <div class="p-3 bg-gray-800 rounded-lg">
                    <h4 class="font-bold text-gray-300 mb-2">‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏•‡∏µ‡∏Å</h4>
                    <input type="file" id="global-logo-input" accept="image/*" class="w-full text-xs text-gray-400 mb-2">
                    <div class="flex items-center gap-4">
                        <button onclick="uploadGlobalLogo()" class="bg-blue-600 text-white px-4 py-1.5 rounded text-sm font-bold hover:bg-blue-500 transition">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ</button>
                        <img id="global-logo-preview" src="" alt="League Logo" class="w-12 h-12 logo-circle object-contain bg-white p-1 border border-white">
                        <button onclick="clearGlobalLogo()" class="text-red-400 text-sm hover:text-red-300 transition">‡∏•‡∏ö‡πÇ‡∏•‡πÇ‡∏Å‡πâ</button>
                    </div>
                </div>

                <div class="p-3 bg-gray-800 rounded-lg">
                    <h4 class="font-bold text-red-400 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö (‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢!)</h4>
                    <div class="flex gap-4">
                        <button onclick="exportData()" class="bg-green-600 text-white px-4 py-1.5 rounded text-sm font-bold hover:bg-green-500 transition flex-1">Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</button>
                        <input type="file" id="import-data-file" accept=".json" class="hidden" onchange="importData(this)">
                        <button onclick="document.getElementById('import-data-file').click()" class="bg-yellow-600 text-white px-4 py-1.5 rounded text-sm font-bold hover:bg-yellow-500 transition flex-1">Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</button>
                    </div>
                    <button onclick="confirmClearAll()" class="w-full bg-red-600 text-white px-4 py-1.5 rounded text-sm font-bold hover:bg-red-500 transition mt-3">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </div>

            <button onclick="toggleSettings()" class="w-full bg-gray-600 py-2 rounded mt-6">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <div id="sched-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á</h3>
            <form onsubmit="handleSchedSubmit(event)" class="space-y-3">
                <input type="hidden" id="sc-id">
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πà‡∏á</label>
                        <input type="date" id="sc-date" class="w-full bg-gray-800 p-2 rounded" required>
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Ç‡πà‡∏á</label>
                        <input type="time" id="sc-time" class="w-full bg-gray-800 p-2 rounded" required>
                    </div>
                </div>
                <div>
                    <label class="text-xs text-gray-400">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà / ‡∏£‡∏≠‡∏ö</label>
                    <input type="text" id="sc-week" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 5 / ‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®" class="w-full bg-gray-800 p-2 rounded">
                </div>
                <div class="flex items-center gap-4">
                    <select id="sc-team-a" class="w-full bg-gray-800 p-2 rounded" required></select>
                    <span class="text-lg font-bold text-gray-400">VS</span>
                    <select id="sc-team-b" class="w-full bg-gray-800 p-2 rounded" required></select>
                </div>
                <label class="text-xs text-gray-400">‡∏Å‡∏•‡∏∏‡πà‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <select id="sc-group" class="w-full bg-gray-800 p-2 rounded">
                    <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                    <option value="A">‡∏Å‡∏•‡∏∏‡πà‡∏° A</option>
                    <option value="B">‡∏Å‡∏•‡∏∏‡πà‡∏° B</option>
                    <option value="C">‡∏Å‡∏•‡∏∏‡πà‡∏° C</option>
                    <option value="D">‡∏Å‡∏•‡∏∏‡πà‡∏° D</option>
                </select>
                <button class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" onclick="document.getElementById('sched-modal').classList.add('hidden')" class="w-full bg-gray-600 py-2 rounded mt-2">‡∏õ‡∏¥‡∏î</button>
            </form>
        </div>
    </div>

    <div id="player-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md">
            <h3 id="player-modal-title" class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</h3>
            <form onsubmit="handlePlayerSubmit(event)" class="space-y-3">
                <input type="hidden" id="p-id">
                <input type="text" id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full bg-gray-800 p-2 rounded" required>
                <div class="flex gap-2">
                    <input type="text" id="p-no" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå" class="w-20 bg-gray-800 p-2 rounded">
                    <select id="p-team" class="flex-1 bg-gray-800 p-2 rounded" required></select>
                </div>
                <label class="flex gap-2 text-sm items-center"><input type="checkbox" id="p-manager" class="w-4 h-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"> ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</label>
                <input type="file" id="p-img" accept="image/*" class="w-full text-xs text-gray-400">
                <p class="text-xs text-gray-400 mt-1">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÜ (‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 3:4)</p>
                <img id="p-img-preview" src="" alt="Player Photo Preview" class="max-h-40 object-cover w-full rounded my-2 hidden">
                <button id="btn-player-save" class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition mt-4" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" onclick="document.getElementById('player-modal').classList.add('hidden')" class="w-full bg-gray-600 py-2 rounded mt-2">‡∏õ‡∏¥‡∏î</button>
            </form>
        </div>
    </div>

    <div id="storage-warning-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md text-center">
            <h3 class="text-2xl font-bold text-red-500 mb-4">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°! (Quota Exceeded)</h3>
            <p class="text-sm text-yellow-300 font-bold mb-6">‚ö†Ô∏è **‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤) ‡∏´‡∏£‡∏∑‡∏≠ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå Local Storage ‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ**</p>
            <button onclick="document.getElementById('storage-warning-modal').classList.add('hidden')" class="bg-red-600 text-white px-6 py-2 rounded font-bold hover:bg-red-500 transition">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        // --- STATE & THEME (UPDATED) ---
        let teams = JSON.parse(localStorage.getItem('jl_teams')) || [];
        let players = JSON.parse(localStorage.getItem('jl_players')) || [];
        let matches = JSON.parse(localStorage.getItem('jl_matches')) || [];
        let stats = JSON.parse(localStorage.getItem('jl_stats')) || [];
        let schedules = JSON.parse(localStorage.getItem('jl_schedules')) || [];
        let globalLogo = localStorage.getItem('jl_logo') || "";
        let themeName = localStorage.getItem('jl_theme_name') || 'JAKHONG SYSTEM';
        let themeColor = localStorage.getItem('jl_theme_color') || '#facc15';
        let secondaryColor = localStorage.getItem('jl_secondary_color') || '#1c365b';
        let currentGroupFilter = 'All';
        let currentTeamView = 'all';

        // ** CRITICAL FIX: Default Data Structure **
        const DEFAULT_TEAMS = [
            { id: 't1', name: 'Phoenix FC', color: '#ff4d4d', tel: '081-111-1111', logo: '' },
            { id: 't2', name: 'Dragons United', color: '#4d79ff', tel: '081-222-2222', logo: '' },
            { id: 't3', name: 'Thunder Bolts', color: '#ffff4d', tel: '081-333-3333', logo: '' },
            { id: 't4', name: 'Forest Warriors', color: '#4dff4d', tel: '081-444-4444', logo: '' },
        ];
        const DEFAULT_PLAYERS = [
            { id: 1, name: '‡∏à‡∏≠‡∏°‡∏¢‡∏∏‡∏ó‡∏ò ‡∏ä‡∏≤‡∏ç‡∏ä‡∏±‡∏¢', no: '10', teamId: 't1', img: '', manager: true },
            { id: 2, name: '‡∏°‡∏±‡∏á‡∏Å‡∏£ ‡∏ó‡∏∞‡∏¢‡∏≤‡∏ô‡∏ü‡πâ‡∏≤', no: '9', teamId: 't2', img: '', manager: true },
            { id: 3, name: '‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤ ‡∏ü‡∏≤‡∏î‡πÄ‡∏£‡πá‡∏ß', no: '7', teamId: 't3', img: '', manager: false },
            { id: 4, name: '‡∏û‡∏§‡∏Å‡∏©‡∏≤ ‡∏•‡∏°‡∏û‡∏±‡∏î', no: '1', teamId: 't4', img: '', manager: true },
        ];
        
        // --- UTILITY FUNCTIONS ---
        function save() {
            try {
                localStorage.setItem('jl_teams', JSON.stringify(teams));
                localStorage.setItem('jl_players', JSON.stringify(players));
                localStorage.setItem('jl_matches', JSON.stringify(matches));
                localStorage.setItem('jl_stats', JSON.stringify(stats));
                localStorage.setItem('jl_schedules', JSON.stringify(schedules));
                localStorage.setItem('jl_logo', globalLogo);
                localStorage.setItem('jl_theme_name', themeName);
                localStorage.setItem('jl_theme_color', themeColor);
                localStorage.setItem('jl_secondary_color', secondaryColor);
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    document.getElementById('storage-warning-modal').classList.remove('hidden');
                }
            }
            renderTheme();
            renderAll();
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString + 'T00:00:00'); // Treat as UTC date to avoid timezone issues
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear() + 543; // Thai year
            return `${day}/${month}/${year}`;
        }
        
        function getPlayerStats(playerId) {
            const playerStats = stats.filter(s => s.playerId == playerId);
            return {
                goals: playerStats.filter(s => s.type === 'goal').reduce((sum, s) => sum + s.count, 0),
                yellows: playerStats.filter(s => s.type === 'yellow').reduce((sum, s) => sum + s.count, 0),
                reds: playerStats.filter(s => s.type === 'red').reduce((sum, s) => sum + s.count, 0),
                saves: playerStats.filter(s => s.type === 'save').reduce((sum, s) => sum + s.count, 0),
                // Removed assists
            };
        }

        // --- THEME & NAVIGATION ---
        function nav(id, btn) {
            document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById(`page-${id}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            // --- RENDER FUNCTIONS FOR NAVIGATION ---
            if(id === 'home') renderDashboard();
            if(id === 'daily') {
                const viewMode = document.getElementById('daily-view-mode').value;
                if (viewMode === 'daily') {
                    renderDaily();
                } else {
                    renderAllStats();
                }
            }
            if(id === 'leaderboard') renderLeaderboard();
            if(id === 'stats') {
                // FIX: Ensure the correct tab is shown
                const matchTab = document.getElementById('hist-tab-match');
                if (matchTab) { showHistory('match', matchTab); }
                updateScheduleMatchDropdown();
            }
            if(id === 'teams') renderTeams();
            if(id === 'players') {
                renderTeamsTabs(currentTeamView); // Render tabs
                renderPlayers(currentTeamView); // Render players
            }
            if(id === 'schedule') renderSchedule();
        }

        function renderAll() {
            // FIX: Ensure all major rendering functions are called to refresh the UI
            updateDropdowns();
            renderLeaderboard();
            renderSchedule();
            renderTeams();
            renderTeamsTabs(currentTeamView);
            renderPlayers(currentTeamView);
            renderMatchHistory();
            renderStatHistory();
            renderDashboard();
            updateScheduleMatchDropdown();

            // Re-render the active view for daily page
            const viewMode = document.getElementById('daily-view-mode').value;
            if (viewMode === 'daily') {
                renderDaily();
            } else {
                renderAllStats();
            }
        }

        function updateDropdowns() {
            const opts = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</option>` + teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            ['sc-team-a','sc-team-b','m-team-a','m-team-b','s-team','p-team'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = opts;
            });
        }
        
        function renderTheme() {
            localStorage.setItem('jl_theme_color', themeColor);
            localStorage.setItem('jl_secondary_color', secondaryColor);
            localStorage.setItem('jl_theme_name', themeName);
            document.documentElement.style.setProperty('--primary-color', themeColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.getElementById('nav-title').innerText = themeName;

            // Update inputs in settings modal when opened
            const themeInput = document.getElementById('theme-color-input');
            if (themeInput) {
                themeInput.value = themeColor;
                document.getElementById('secondary-color-input').value = secondaryColor;
                document.getElementById('theme-name-input').value = themeName;
            }
        }

        function updateThemeAndSave() {
            themeColor = document.getElementById('theme-color-input').value;
            secondaryColor = document.getElementById('secondary-color-input').value;
            themeName = document.getElementById('theme-name-input').value;
            save(); // Save and trigger renderTheme
        }

        // *** Image Compression (Enhanced for saving storage) ***
        const compressImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const targetWidth = 300;
                        const targetHeight = 400;
                        const scale = Math.max(targetWidth / img.width, targetHeight / img.height);
                        const x = (targetWidth / 2) - (img.width / 2) * scale;
                        const y = (targetHeight / 2) - (img.height / 2) * scale;

                        canvas.width = targetWidth;
                        canvas.height = targetHeight;
                        
                        ctx.fillStyle = '#0c1626'; // Fill background
                        ctx.fillRect(0, 0, targetWidth, targetHeight);

                        // Draw image centered and covering the area
                        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);

                        resolve(canvas.toDataURL('image/jpeg', 0.7)); // 70% quality
                    };
                };
            });
        };
        
        // --- DASHBOARD ---
        function calculateDashboardStats() {
            document.getElementById('stat-total-teams').innerText = teams.length;
            document.getElementById('stat-total-stats').innerText = stats.length;
            document.getElementById('stat-total-players').innerText = players.length;
            
            const totalGoals = stats.filter(s => s.type === 'goal').reduce((sum, s) => sum + s.count, 0);
            document.getElementById('stat-total-goals').innerText = totalGoals;

            // Leaderboard & Top Scorer
            const lbData = calculateLeaderboardData();
            const topTeam = lbData.sort((a, b) => b.pts - a.pts || (b.gd) - (a.gd) || a.name.localeCompare(b.name))[0];
            
            if (topTeam) {
                document.getElementById('leader-team-name').innerText = topTeam.name;
                document.getElementById('leader-team-pts').innerText = topTeam.pts;
                document.getElementById('leader-team-card').style.borderColor = topTeam.color;
            } else {
                document.getElementById('leader-team-name').innerText = 'N/A';
                document.getElementById('leader-team-pts').innerText = '0';
                document.getElementById('leader-team-card').style.borderColor = themeColor;
            }

            const topScorer = getTopScorers(1)[0];
            if (topScorer) {
                document.getElementById('top-scorer-name').innerText = topScorer.name;
                document.getElementById('top-scorer-goals').innerText = topScorer.goals;
            } else {
                document.getElementById('top-scorer-name').innerText = 'N/A';
                document.getElementById('top-scorer-goals').innerText = '0';
            }

            // Manager List
            const managerList = document.getElementById('manager-list');
            const managers = players.filter(p => p.manager).map(p => {
                const t = teams.find(t => t.id == p.teamId);
                return { name: p.name, teamName: t?.name, teamTel: t?.tel, teamColor: t?.color };
            });
            managerList.innerHTML = managers.map(m => `
                <div class="p-3 rounded-lg flex items-center gap-3 bg-gray-900 border-l-4" style="border-color: ${m.teamColor || themeColor};">
                    <i class="fas fa-user-tie text-xl" style="color: ${m.teamColor || themeColor};"></i>
                    <div>
                        <div class="font-bold">${m.name}</div>
                        <div class="text-sm text-gray-400">${m.teamName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'} | Tel: ${m.teamTel || 'N/A'}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderDashboard() {
            calculateDashboardStats();
        }

        // --- 1. LEADERBOARD ---
        function calculateLeaderboardData() {
            const data = teams.map(t => ({
                id: t.id,
                name: t.name,
                color: t.color,
                p: 0, w: 0, d: 0, l: 0, gf: 0, ga: 0, gd: 0, pts: 0
            }));

            matches.forEach(m => {
                const idxA = data.findIndex(d => d.id == m.teamA);
                const idxB = data.findIndex(d => d.id == m.teamB);

                if (idxA === -1 || idxB === -1) return;

                const scoreA = parseInt(m.scoreA);
                const scoreB = parseInt(m.scoreB);

                data[idxA].p++;
                data[idxB].p++;
                data[idxA].gf += scoreA;
                data[idxA].ga += scoreB;
                data[idxB].gf += scoreB;
                data[idxB].ga += scoreA;

                if (scoreA > scoreB) { // Team A wins
                    data[idxA].w++;
                    data[idxB].l++;
                    data[idxA].pts += 3;
                } else if (scoreA < scoreB) { // Team B wins
                    data[idxB].w++;
                    data[idxA].l++;
                    data[idxB].pts += 3;
                } else { // Draw
                    data[idxA].d++;
                    data[idxB].d++;
                    data[idxA].pts += 1;
                    data[idxB].pts += 1;
                }
            });

            data.forEach(d => d.gd = d.gf - d.ga);

            // Sort by points (desc), goal difference (desc), goals for (desc), then name (asc)
            return data.sort((a, b) => 
                b.pts - a.pts || 
                b.gd - a.gd || 
                b.gf - a.gf ||
                a.name.localeCompare(b.name)
            );
        }

        function renderLeaderboard() {
            const sortedData = calculateLeaderboardData();
            const body = document.getElementById('lb-body');
            const cBgBody = document.getElementById('lb-bg-body').value;
            const cBodyText = document.getElementById('lb-body-text-color').value;
            const cPtsGrad1 = document.getElementById('lb-pts-grad-1').value;
            const cPtsGrad2 = document.getElementById('lb-pts-grad-2').value;
            const cHeaderGrad1 = document.getElementById('lb-header-grad-1').value;
            const cHeaderGrad2 = document.getElementById('lb-header-grad-2').value;
            const cHeaderText = document.getElementById('lb-header-text-color').value;

            document.getElementById('lb-table').style.backgroundColor = cBgBody;
            document.getElementById('lb-body').style.color = cBodyText;
            document.getElementById('lb-thead-row').style.background = `linear-gradient(135deg, ${cHeaderGrad1}, ${cHeaderGrad2})`;
            document.querySelectorAll('#lb-thead-row th').forEach(th => th.style.color = cHeaderText);
            
            body.innerHTML = sortedData.map((t, i) => `
                <tr class="border-b border-white/5 hover:bg-white/5" style="background-color: ${i % 2 === 0 ? 'rgba(0,0,0,0.05)' : 'rgba(0,0,0,0)'};">
                    <td class="p-4 text-center" style="color: ${t.color};">${i + 1}</td>
                    <td class="p-4 font-bold uppercase">${t.name}</td>
                    <td class="p-4 text-center">${t.p}</td>
                    <td class="p-4 text-center">${t.w}</td>
                    <td class="p-4 text-center">${t.d}</td>
                    <td class="p-4 text-center">${t.l}</td>
                    <td class="p-4 text-center">${t.gf}/${t.ga}</td>
                    <td class="p-4 text-center">${t.gd > 0 ? '+' : ''}${t.gd}</td>
                    <td class="p-0 text-center">
                        <div class="h-full py-4 px-2 font-black text-xl" style="background: linear-gradient(135deg, ${cPtsGrad1}, ${cPtsGrad2}); color: black;">${t.pts}</div>
                    </td>
                </tr>
            `).join('');
        }

        // --- 2. SCHEDULE ---
        function openAddSchedModal() {
            // FIX: Ensure team dropdown is updated
            updateDropdowns();
            document.getElementById('sched-modal').classList.remove('hidden');
        }

        function handleSchedSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('sc-id').value;
            const obj = {
                id: id ? parseInt(id) : Date.now(),
                date: document.getElementById('sc-date').value,
                time: document.getElementById('sc-time').value,
                week: document.getElementById('sc-week').value,
                teamA: document.getElementById('sc-team-a').value,
                teamB: document.getElementById('sc-team-b').value,
                group: document.getElementById('sc-group').value,
                result: null // Status: Pending
            };

            if (id) {
                schedules = schedules.map(s => s.id == id ? obj : s);
            } else {
                schedules.push(obj);
            }
            
            save();
            document.getElementById('sched-modal').classList.add('hidden');
            e.target.reset();
            document.getElementById('sc-id').value = '';
        }

        function setGroupFilter(group, btn) {
            currentGroupFilter = group;
            document.querySelectorAll('.group-tab').forEach(b => {
                b.classList.remove('active');
                b.style.backgroundColor = '#4b5563';
                b.style.color = 'white';
            });
            btn.classList.add('active');
            btn.style.backgroundColor = themeColor;
            btn.style.color = 'black';
            renderSchedule();
        }

        function editSched(id) {
            const s = schedules.find(x => x.id == id);
            if (s) {
                updateDropdowns();
                document.getElementById('sc-id').value = s.id;
                document.getElementById('sc-date').value = s.date;
                document.getElementById('sc-time').value = s.time;
                document.getElementById('sc-week').value = s.week;
                document.getElementById('sc-team-a').value = s.teamA;
                document.getElementById('sc-team-b').value = s.teamB;
                document.getElementById('sc-group').value = s.group || '';
                document.getElementById('sched-modal').classList.remove('hidden');
            }
        }

        function delSched(id) {
            if (confirm('‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏ô‡∏µ‡πâ?')) {
                schedules = schedules.filter(s => s.id != id);
                save();
            }
        }

        function renderSchedule() {
            const list = document.getElementById('sched-list');
            const cBgColorMain = document.getElementById('sc-bg-color-main').value;
            const cBgColor = document.getElementById('sc-bg-color').value;
            const cTextColor = document.getElementById('sc-text-color').value;
            const cPillColor = document.getElementById('sc-pill-color').value;
            const cHeaderText = document.getElementById('sc-header-text').value;

            document.getElementById('schedule-main-container').style.backgroundColor = cBgColorMain;
            document.getElementById('sc-bg-overlay').style.background = `linear-gradient(135deg, ${cBgColor}, #0c1626)`;
            document.getElementById('sc-container').style.color = cTextColor;
            document.getElementById('sc-pill').style.backgroundColor = cPillColor;
            document.getElementById('sc-pill').innerText = cHeaderText;

            const filteredSchedules = schedules
                .filter(s => currentGroupFilter === 'All' || s.group === currentGroupFilter)
                .sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort by date

            const groupedSchedules = filteredSchedules.reduce((acc, s) => {
                const groupKey = s.week || formatDate(s.date);
                if (!acc[groupKey]) acc[groupKey] = [];
                acc[groupKey].push(s);
                return acc;
            }, {});

            let html = '';

            for (const key in groupedSchedules) {
                html += `<h3 class="schedule-group-header" style="background-color: ${cPillColor};">${key}</h3>`;
                
                groupedSchedules[key].forEach(s => {
                    const tA = teams.find(t => t.id == s.teamA);
                    const tB = teams.find(t => t.id == s.teamB);
                    const groupDisplay = s.group ? `‡∏Å‡∏•‡∏∏‡πà‡∏° ${s.group}` : '';
                    
                    let status = '<span class="text-yellow-400 font-medium">‡∏£‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ú‡∏•</span>';
                    let cardClasses = '';

                    const recordedMatch = matches.find(m => m.scheduleId == s.id);
                    if (recordedMatch) {
                        const scoreA = parseInt(recordedMatch.scoreA);
                        const scoreB = parseInt(recordedMatch.scoreB);
                        const scoreText = `${scoreA} - ${scoreB}`;
                        status = `<span class="text-white font-black text-xl">${scoreText}</span>`;
                        cardClasses = 'show-actions'; // Keep actions visible for easy editing
                    }

                    html += `
                        <div class="schedule-match-card ${cardClasses}" onmouseenter="this.classList.add('show-actions')" onmouseleave="this.classList.remove('show-actions')">
                            <div class="schedule-team-container team-a" style="color: ${cTextColor};">
                                <div class="text-right">
                                    <div class="font-bold text-lg uppercase">${tA?.name || 'N/A'}</div>
                                    <div class="text-xs text-gray-400 hidden sm:block">${groupDisplay}</div>
                                </div>
                                <img src="${tA?.logo || ''}" class="schedule-team-logo" style="border-color: ${tA?.color || themeColor};" alt="${tA?.name || 'Team A'} Logo">
                                <div class="block sm:hidden text-center mt-2">
                                    <div class="font-bold text-sm uppercase">${tA?.name || 'N/A'}</div>
                                </div>
                            </div>
                            <div class="schedule-center-info" style="color: ${cTextColor};">
                                <div class="font-extrabold text-3xl italic tracking-wider text-red-500 outline-text" style="color: ${cTextColor};">VS</div>
                                <div class="text-xl font-black mt-1">${s.time}</div>
                                <div class="text-sm font-medium text-gray-400">${formatDate(s.date)}</div>
                                <div class="mt-1">${status}</div>
                            </div>
                            <div class="schedule-team-container team-b" style="color: ${cTextColor};">
                                <img src="${tB?.logo || ''}" class="schedule-team-logo" style="border-color: ${tB?.color || themeColor};" alt="${tB?.name || 'Team B'} Logo">
                                <div class="text-left">
                                    <div class="font-bold text-lg uppercase">${tB?.name || 'N/A'}</div>
                                    <div class="text-xs text-gray-400 hidden sm:block">${groupDisplay}</div>
                                </div>
                                <div class="block sm:hidden text-center mt-2">
                                    <div class="font-bold text-sm uppercase">${tB?.name || 'N/A'}</div>
                                </div>
                            </div>
                            <div class="schedule-actions">
                                <button onclick="delSched(${s.id})" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                                <button onclick="editSched(${s.id})" class="text-blue-400 hover:text-blue-300 text-sm ml-4"><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            </div>
                        </div>
                    `;
                });
            }

            list.innerHTML = html || '<p class="text-center text-gray-500 py-10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>';
        }


        // --- 3. DAILY SUMMARY / TOP SCORER / ALL STATS (UPDATED) ---

        function getTopScorers(limit = 5, dateFilter = null) {
            const allGoalStats = stats.filter(s => s.type === 'goal');
            
            // Apply date filter if provided
            const filteredStats = dateFilter 
                ? allGoalStats.filter(s => s.date === dateFilter)
                : allGoalStats;

            // Group by player and sum goals
            const goalCounts = filteredStats.reduce((acc, s) => {
                acc[s.playerId] = (acc[s.playerId] || 0) + s.count;
                return acc;
            }, {});

            // Prepare final data structure
            const scorerData = Object.entries(goalCounts).map(([playerId, goals]) => {
                const p = players.find(x => x.id == playerId);
                return {
                    playerId: playerId,
                    name: p?.name || 'N/A',
                    number: p?.no || '',
                    img: p?.img || '',
                    teamId: p?.teamId,
                    goals: goals,
                    // Note: full stats (yellow, red, save) are not used for sorting here
                };
            }).filter(data => data.goals > 0);

            // Sort logic: goals (desc), name (asc), number (asc)
            const sortedData = scorerData.sort((a, b) => {
                if (b.goals !== a.goals) return b.goals - a.goals;
                if (a.name.localeCompare(b.name) !== 0) return a.name.localeCompare(b.name);
                return (parseInt(a.number) || 999) - (parseInt(b.number) || 999);
            });

            return { sortedData: sortedData.slice(0, limit) };
        }

        function renderDaily() {
            const date = document.getElementById('daily-date').value;
            const sortKey = document.getElementById('daily-scorer-sort').value;
            const cTeamName = document.getElementById('daily-team-name-color').value;
            const cBg1 = document.getElementById('daily-row-bg-1').value;
            const cBg2 = document.getElementById('daily-row-bg-2').value;

            // 4. UPDATED: Score text color
            const cScoreGrad1 = document.getElementById('daily-score-grad-1').value;
            const cScoreGrad2 = document.getElementById('daily-score-grad-2').value;
            const cScoreText = document.getElementById('daily-score-text-color')?.value || '#000000'; // NEW: Score number color

            const cGrad1 = document.getElementById('daily-banner-grad-1').value;
            const cGrad2 = document.getElementById('daily-banner-grad-2').value;
            const cText = document.getElementById('daily-banner-text').value;
            const cBorder = document.getElementById('daily-banner-border').value;
            
            const dailyContent = document.getElementById('daily-content');
            const allStatsContent = document.getElementById('all-stats-content');
            const dailyControls = document.getElementById('daily-controls');
            const allStatsControls = document.getElementById('all-stats-controls');

            // Show/Hide relevant sections
            dailyContent.classList.remove('hidden');
            allStatsContent.classList.add('hidden');
            dailyControls.classList.remove('hidden');
            allStatsControls.classList.add('hidden');

            // 1. Banner Styles
            const headerEl = document.getElementById('daily-header');
            headerEl.style.background = `linear-gradient(to right, ${cGrad1}, ${cGrad2})`;
            headerEl.style.borderColor = cBorder;
            document.getElementById('daily-title-edit').style.color = cText;
            document.getElementById('daily-logo-img').style.borderColor = cBorder;
            
            // Set default date if none selected (to today's date)
            const currentDate = date || new Date().toISOString().slice(0, 10);
            if (!date) document.getElementById('daily-date').value = currentDate;
            document.getElementById('daily-title-edit').innerText = `‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ${formatDate(currentDate)} ${themeName}`;
            document.getElementById('daily-logo-img').src = globalLogo;
            
            // 2. Matches Today
            const todayMatches = matches.filter(m => m.date === currentDate)
                                        .sort((a, b) => b.id - a.id); // Sort by most recent ID

            const container = document.getElementById('daily-matches-container');

            if (todayMatches.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 py-10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>`;
            } else {
                container.innerHTML = todayMatches.map((m, i) => {
                    const tA = teams.find(t => t.id == m.teamA);
                    const tB = teams.find(t => t.id == m.teamB);
                    const scoreA = parseInt(m.scoreA);
                    const scoreB = parseInt(m.scoreB);
                    
                    const rowBg = i % 2 === 0 ? cBg1 : cBg2;
                    const winningTeam = scoreA > scoreB ? tA : (scoreB > scoreA ? tB : null);
                    const winningColor = winningTeam?.color || cTeamName;
                    
                    const scoreStyle = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;
                    const teamAStyle = `color: ${tA?.color || cTeamName};`;
                    const teamBStyle = `color: ${tB?.color || cTeamName};`;

                    return `
                        <div class="flex items-center p-3 rounded-lg shadow-lg border-l-4" style="background-color: ${rowBg}; border-color: ${winningTeam ? winningColor : cTeamName};">
                            <div class="flex-1 text-right pr-4">
                                <div class="font-bold text-lg uppercase truncate" style="${teamAStyle}">${tA?.name || 'N/A'}</div>
                                <div class="text-xs text-gray-400">${tA?.group ? `‡∏Å‡∏•‡∏∏‡πà‡∏° ${tA.group}` : ''}</div>
                            </div>
                            <div class="daily-score-box">
                                <span class="daily-score-number shadow-lg" style="${scoreStyle}">${scoreA}</span>
                                <span class="daily-vs">VS</span>
                                <span class="daily-score-number shadow-lg" style="${scoreStyle}">${scoreB}</span>
                            </div>
                            <div class="flex-1 text-left pl-4">
                                <div class="font-bold text-lg uppercase truncate" style="${teamBStyle}">${tB?.name || 'N/A'}</div>
                                <div class="text-xs text-gray-400">${tB?.group ? `‡∏Å‡∏•‡∏∏‡πà‡∏° ${tB.group}` : ''}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // 3. Top Scorers (Top 5 Overall)
            const topScorersData = getTopScorers(5).sortedData;
            const topScorersCont = document.getElementById('daily-top-scorers');
            const topScorerHeader = document.getElementById('daily-scorer-header');
            
            const overallScorer = getTopScorers(1).sortedData[0];
            const overallScorerName = overallScorer ? overallScorer.name : '‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Top 5)';
            topScorerHeader.innerText = overallScorerName === 'N/A' ? '‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Top 5)' : `üëë ${overallScorerName} (${overallScorer.goals} ‡∏õ‡∏£‡∏∞‡∏ï‡∏π)`;


            topScorersCont.innerHTML = topScorersData.map((data, i) => {
                const t = teams.find(x => x.id == data.teamId);
                const isTop = i === 0;
                const scoreStyle = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;

                return `
                    <div class="scorer-card ${isTop ? 'is-top' : ''}">
                        <div class="scorer-rank-tag">${i + 1}</div>
                        <img src="${data.img || ''}" class="scorer-card-img" style="border-color: ${t?.color || 'white'};" alt="${data.name}">
                        <div class="mt-2 w-full">
                            <div class="text-white font-bold text-sm truncate">${data.name} (#${data.number||'-'})</div>
                            <div class="text-gray-400 text-xs truncate mb-2">${t?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                            <div class="font-black text-2xl leading-tight inline-block px-3 py-1 rounded shadow-md" style="${scoreStyle}">
                                ${data.goals} <span class="text-xs font-normal">‡∏õ‡∏£‡∏∞‡∏ï‡∏π</span>
                            </div>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-500 py-4 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</p>';

            // 4. Scorers Today (Horizontal Grid)
            const todays = stats.filter(s => s.type === 'goal' && s.date === currentDate);
            const todayCounts = {};
            todays.forEach(s => todayCounts[s.playerId] = (todayCounts[s.playerId]||0)+s.count);

            const todayScorersCont = document.getElementById('daily-today-scorers');

            // Get player details for today's scorers
            let todayScorerData = Object.entries(todayCounts).map(([pid, c]) => {
                const p = players.find(x => x.id == pid);
                const t = teams.find(x => x.id == p?.teamId);
                return {
                    name: p?.name, 
                    number: p?.no, 
                    img: p?.img, 
                    teamName: t?.name, 
                    teamColor: t?.color, 
                    goals: c 
                };
            }).filter(data => data.goals > 0);

            // Sort logic for today's scorers
            if (sortKey === 'name') {
                todayScorerData.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortKey === 'number') {
                todayScorerData.sort((a, b) => (parseInt(a.number) || 999) - (parseInt(b.number) || 999));
            } else { // default to 'goals'
                todayScorerData.sort((a, b) => b.goals - a.goals);
            }

            todayScorersCont.innerHTML = todayScorerData.map((data, i) => {
                const scoreStyle = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;
                return `
                    <div class="scorer-card">
                        <img src="${data.img || ''}" class="scorer-card-img" style="border-color: ${data.teamColor || 'white'};" alt="${data.name}">
                        <div class="today-scorer-num-tag">${data.goals}</div>
                        <div class="mt-2 w-full">
                            <div class="text-white font-bold text-sm truncate">${data.name} (#${data.number||'-'})</div>
                            <div class="text-gray-400 text-xs truncate mb-2">${data.teamName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                            <div class="font-black text-xl leading-tight inline-block px-2 py-0.5 rounded shadow-md" style="${scoreStyle}">
                                ${data.goals} <span class="text-xs font-normal">‡∏õ‡∏£‡∏∞‡∏ï‡∏π</span>
                            </div>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-500 py-4 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
        }

        function renderAllStats() {
            const currentStatType = document.getElementById('stat-filter-type').value;
            const dailyContent = document.getElementById('daily-content');
            const allStatsContent = document.getElementById('all-stats-content');
            const dailyControls = document.getElementById('daily-controls');
            const allStatsControls = document.getElementById('all-stats-controls');

            // Show/Hide relevant sections
            dailyContent.classList.add('hidden');
            allStatsContent.classList.remove('hidden');
            dailyControls.classList.add('hidden');
            allStatsControls.classList.remove('hidden');

            const statTypes = {
                goal: { label: '‡∏õ‡∏£‡∏∞‡∏ï‡∏π', icon: '‚öΩ', color: 'text-red-400', header: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ï‡∏π' },
                yellow: { label: '‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', icon: 'üü®', color: 'text-yellow-400', header: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á' },
                red: { label: '‡πÉ‡∏ö‡πÅ‡∏î‡∏á', icon: 'üü•', color: 'text-red-600', header: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö‡πÅ‡∏î‡∏á' },
                save: { label: '‡πÄ‡∏ã‡∏ü', icon: 'üß§', color: 'text-blue-400', header: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ã‡∏ü' }
            };

            const currentStat = statTypes[currentStatType] || statTypes.goal;
            document.getElementById('all-stats-header').innerText = currentStat.header;

            const body = document.getElementById('all-stats-body');
            
            // 1. Calculate combined player stats
            const combinedStats = players.map(p => {
                const t = teams.find(x => x.id == p.teamId);
                const count = stats.filter(s => s.playerId == p.id && s.type === currentStatType)
                                   .reduce((sum, s) => sum + s.count, 0);
                return {
                    name: p.name,
                    teamName: t?.name || 'N/A',
                    teamColor: t?.color || '#ffffff',
                    count: count
                };
            }).filter(p => p.count > 0);

            // 2. Sort data
            const filteredAndSorted = combinedStats
                .sort((a, b) => { 
                    // Sort by count (desc) then name (asc)
                    if (b.count !== a.count) return b.count - a.count;
                    return a.name.localeCompare(b.name);
                });

            // 3. Render table rows
            body.innerHTML = filteredAndSorted.map((p, i) => `
                <tr class="all-stats-row border-b border-gray-800">
                    <td class="p-2 text-center text-gray-400">${i + 1}</td>
                    <td class="p-2 font-bold text-white">${p.name}</td>
                    <td class="p-2 text-center text-xs" style="color: ${p.teamColor};">${p.teamName}</td>
                    <td class="p-2 text-center font-black text-lg ${currentStat.color}">${p.count}</td>
                </tr>
            `).join('') || `<tr><td colspan="4" class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ${currentStat.label} ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td></tr>`;
        }


        // --- 4. STATS & HISTORY ---
        // 1. UPDATED: handleStatSubmit - Removed assist logic/validation
        function handleStatSubmit(e) {
            e.preventDefault();
            const type = document.getElementById('s-type').value;
            const id = document.getElementById('edit-stat-id').value;
            const scorerId = document.getElementById('s-player').value;
            const teamId = document.getElementById('s-team').value;

            // Simple validation: ensure player belongs to the selected team (optional but good practice)
            const player = players.find(p => p.id == scorerId);
            if (player && player.teamId !== teamId) {
                alert('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏');
                return;
            }

            const obj = {
                id: id ? parseInt(id) : Date.now(),
                date: document.getElementById('s-date').value,
                type: type,
                teamId: teamId,
                playerId: scorerId,
                count: parseInt(document.getElementById('s-count').value),
                note: document.getElementById('s-note').value
            };

            if (id) {
                stats = stats.map(s => s.id == id ? obj : s);
            } else {
                stats.push(obj);
            }

            save();
            resetStatForm();
        }

        function resetStatForm() {
            document.getElementById('edit-stat-id').value = '';
            document.getElementById('s-player').value = '';
            document.getElementById('s-team').value = '';
            document.getElementById('s-date').value = '';
            document.getElementById('s-type').value = 'goal';
            document.getElementById('s-count').value = '1';
            document.getElementById('s-note').value = '';
            document.getElementById('btn-stat-save').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥';
            document.getElementById('btn-stat-cancel').classList.add('hidden');
        }
        
        function editStat(id) {
            const s = stats.find(x => x.id == id);
            if (s) {
                document.getElementById('edit-stat-id').value = s.id;
                document.getElementById('s-date').value = s.date;
                document.getElementById('s-type').value = s.type;
                document.getElementById('s-team').value = s.teamId;
                updatePlayerDropdown('s-team', 's-player'); // Must update dropdown first
                document.getElementById('s-player').value = s.playerId;
                document.getElementById('s-count').value = s.count;
                document.getElementById('s-note').value = s.note;
                document.getElementById('btn-stat-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥';
                document.getElementById('btn-stat-cancel').classList.remove('hidden');
            }
        }

        function delStat(id) {
            if (confirm('‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ô‡∏µ‡πâ?')) {
                stats = stats.filter(s => s.id != id);
                save();
            }
        }

        function updatePlayerDropdown(teamDropdownId, playerDropdownId) {
            const teamId = document.getElementById(teamDropdownId).value;
            const playerDropdown = document.getElementById(playerDropdownId);
            const filteredPlayers = teamId 
                ? players.filter(p => p.teamId == teamId) 
                : players;

            playerDropdown.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</option>' + 
                filteredPlayers.map(p => `<option value="${p.id}">${p.no ? `(#${p.no}) ` : ''}${p.name}</option>`).join('');
        }
        
        // 2. Match Score Submission
        function handleMatchSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('match-edit-id').value;
            const obj = {
                id: id ? parseInt(id) : Date.now(),
                scheduleId: document.getElementById('m-schedule-id').value || null, // Link to schedule if prefilled
                date: document.getElementById('m-date').value,
                teamA: document.getElementById('m-team-a').value,
                scoreA: document.getElementById('m-score-a').value,
                teamB: document.getElementById('m-team-b').value,
                scoreB: document.getElementById('m-score-b').value,
                group: document.getElementById('m-group').value || null
            };

            if (obj.teamA === obj.teamB) {
                alert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡∏ó‡∏µ‡∏° A ‡πÅ‡∏•‡∏∞ ‡∏ó‡∏µ‡∏° B ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô");
                return;
            }

            if (id) {
                matches = matches.map(m => m.id == id ? obj : m);
            } else {
                matches.push(obj);
            }

            save();
            resetMatchForm();
            updateScheduleMatchDropdown(); // Update dropdown to remove recorded match
        }

        function resetMatchForm() {
            document.getElementById('match-edit-id').value = '';
            document.getElementById('m-date').value = '';
            document.getElementById('m-team-a').value = '';
            document.getElementById('m-score-a').value = '0';
            document.getElementById('m-team-b').value = '';
            document.getElementById('m-score-b').value = '0';
            document.getElementById('m-group').value = '';
            document.getElementById('m-schedule-id').value = '';
            document.getElementById('btn-match-save').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á';
            document.getElementById('btn-match-cancel').classList.add('hidden');
        }

        function prefillMatchFromSchedule() {
            const dropdown = document.getElementById('m-schedule-id');
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            
            if (selectedOption.value) {
                const teamA = selectedOption.getAttribute('data-team-a');
                const teamB = selectedOption.getAttribute('data-team-b');
                const date = selectedOption.getAttribute('data-date');
                
                document.getElementById('m-date').value = date;
                document.getElementById('m-team-a').value = teamA;
                document.getElementById('m-team-b').value = teamB;
                // Leave scores at 0 for initial entry
            } else {
                resetMatchForm();
            }
        }
        
        function editMatch(id) {
            const m = matches.find(x => x.id == id);
            if (m) {
                updateDropdowns();
                document.getElementById('match-edit-id').value = m.id;
                document.getElementById('m-date').value = m.date;
                document.getElementById('m-team-a').value = m.teamA;
                document.getElementById('m-score-a').value = m.scoreA;
                document.getElementById('m-team-b').value = m.teamB;
                document.getElementById('m-score-b').value = m.scoreB;
                document.getElementById('m-group').value = m.group || '';
                document.getElementById('btn-match-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á';
                document.getElementById('btn-match-cancel').classList.remove('hidden');
            }
        }

        function delMatch(id) {
            if (confirm('‡∏•‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ô‡∏µ‡πâ?')) {
                matches = matches.filter(m => m.id != id);
                save();
            }
        }
        
        // 3. History Display
        function showHistory(type, tab) {
            document.getElementById('history-match-list').classList.add('hidden');
            document.getElementById('history-stat-list').classList.add('hidden');
            
            document.querySelectorAll('.hist-tab').forEach(t => {
                t.style.borderColor = 'transparent';
                t.style.color = '#9ca3af'; // gray-400
            });
            
            tab.style.borderColor = themeColor;
            tab.style.color = themeColor;
            
            if (type === 'match') {
                document.getElementById('history-match-list').classList.remove('hidden');
            } else if (type === 'stat') {
                document.getElementById('history-stat-list').classList.remove('hidden');
            }
        }

        function renderMatchHistory() {
            const list = document.getElementById('history-match-list');
            list.innerHTML = matches.sort((a,b) => b.id - a.id).map(m => {
                const tA = teams.find(x => x.id == m.teamA);
                const tB = teams.find(x => x.id == m.teamB);
                const winningColor = parseInt(m.scoreA) > parseInt(m.scoreB) ? tA?.color : (parseInt(m.scoreB) > parseInt(m.scoreA) ? tB?.color : '#ffffff');

                return `
                    <div class="bg-gray-800 p-2 rounded flex justify-between items-center text-sm border-l-4 border-yellow-400/20 group" style="border-color: ${winningColor};">
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500 text-xs">${formatDate(m.date)}</span>
                            <div>
                                <div class="font-bold">${tA?.name} ${m.scoreA} - ${m.scoreB} ${tB?.name}</div>
                                <div class="text-xs text-gray-400">${m.group ? `‡∏Å‡∏•‡∏∏‡πà‡∏° ${m.group}` : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏•‡∏∏‡πà‡∏°'}</div>
                            </div>
                        </div>
                        <div class="opacity-0 group-hover:opacity-100 transition flex gap-2">
                            <button onclick="editMatch(${m.id})" class="text-blue-400 hover:text-blue-300"><i class="fas fa-edit"></i></button>
                            <button onclick="delMatch(${m.id})" class="text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            }).join('') || '<p class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>';
        }

        // 1. UPDATED: renderStatHistory - Removed assist display
        function renderStatHistory() {
            const list = document.getElementById('history-stat-list');
            const iconMap = { goal:'‚öΩ', yellow:'üü®', red:'üü•', save:'üß§' }; // Removed assist
            
            list.innerHTML = stats.sort((a,b) => b.id - a.id).map(s => {
                const p = players.find(x => x.id == s.playerId);
                const t = teams.find(x => x.id == s.teamId);
                const titleText = `${p?.name}`; // Only player name

                return `
                    <div class="bg-gray-800 p-2 rounded flex justify-between items-center text-sm border border-yellow-400/20 group">
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500 text-xs">${formatDate(s.date)}</span>
                            <span>${iconMap[s.type]}</span>
                            <div>
                                <div class="font-bold">${titleText}</div>
                                <div class="text-xs text-gray-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${s.count} | ‡∏ó‡∏µ‡∏°: ${t?.name || 'N/A'} | ${s.note}</div>
                            </div>
                        </div>
                        <div class="opacity-0 group-hover:opacity-100 transition flex gap-2">
                            <button onclick="editStat(${s.id})" class="text-blue-400 hover:text-blue-300"><i class="fas fa-edit"></i></button>
                            <button onclick="delStat(${s.id})" class="text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            }).join('') || '<p class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>';
        }


        // --- 5. TEAMS ---
        function handleTeamSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('team-edit-id').value;
            const newTeam = {
                id: id || 't' + Date.now(),
                name: document.getElementById('team-name').value,
                color: document.getElementById('team-color').value || themeColor,
                tel: document.getElementById('team-tel').value,
                logo: teams.find(t => t.id == id)?.logo || '' // Keep existing logo if editing
            };

            if (id) {
                teams = teams.map(t => t.id == id ? newTeam : t);
            } else {
                teams.push(newTeam);
            }
            save();
            resetTeamForm();
        }

        function renderTeams() {
            const list = document.getElementById('teams-list');
            list.innerHTML = teams.map(t => {
                return `
                    <div class="glass p-4 rounded-xl shadow-lg border-l-4 relative" style="border-color: ${t.color};">
                        <div class="flex items-center gap-3">
                            <img src="${t.logo}" class="w-10 h-10 logo-circle bg-white p-1 border" style="border-color: ${t.color};" alt="Team Logo">
                            <div>
                                <div class="font-bold text-lg uppercase">${t.name}</div>
                                <div class="text-sm text-gray-400">Tel: ${t.tel || 'N/A'}</div>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-3">
                            <button onclick="editTeam('${t.id}')" class="text-blue-400 hover:text-blue-300 text-sm"><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="delTeam('${t.id}')" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</p>';
        }

        function delTeam(id) {
            if(confirm('‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ? ‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á!')) {
                teams = teams.filter(t => t.id != id);
                players = players.filter(p => p.teamId != id);
                matches = matches.filter(m => m.teamA != id && m.teamB != id);
                stats = stats.filter(s => s.teamId != id);
                schedules = schedules.filter(s => s.teamA != id && s.teamB != id);
                save();
            }
        }

        function editTeam(id) {
            const t = teams.find(x => x.id == id);
            if (t) {
                document.getElementById('team-edit-id').value = t.id;
                document.getElementById('team-name').value = t.name;
                document.getElementById('team-color').value = t.color;
                document.getElementById('team-tel').value = t.tel;
                document.getElementById('btn-team-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
                document.getElementById('btn-team-cancel').classList.remove('hidden');
            }
        }

        function resetTeamForm() {
            document.getElementById('team-edit-id').value = '';
            document.getElementById('team-name').value = '';
            document.getElementById('team-color').value = themeColor;
            document.getElementById('team-tel').value = '';
            document.getElementById('btn-team-save').innerText = '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°';
            document.getElementById('btn-team-cancel').classList.add('hidden');
        }

        // --- 6. PLAYERS ---
        function handlePlayerSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('p-id').value;
            const file = document.getElementById('p-img').files[0];
            const pManager = document.getElementById('p-manager').checked;
            
            const savePlayer = (imageUrl = '') => {
                const newPlayer = {
                    id: id ? parseInt(id) : Date.now(),
                    name: document.getElementById('p-name').value,
                    no: document.getElementById('p-no').value,
                    teamId: document.getElementById('p-team').value,
                    img: imageUrl || players.find(p => p.id == id)?.img || '', // Keep old image if no new file
                    manager: pManager
                };
            
                if (id) {
                    players = players.map(p => p.id == id ? newPlayer : p);
                } else {
                    players.push(newPlayer);
                }
                save();
                document.getElementById('player-modal').classList.add('hidden');
                e.target.reset();
                renderPlayers(currentTeamView);
            };

            if (file) {
                // Upload/Compress and then save
                compressImage(file).then(savePlayer);
            } else {
                savePlayer();
            }
        }
        
        function renderTeamsTabs(selectedId) {
            const tabsContainer = document.getElementById('team-tabs-container');
            let html = `<button onclick="renderPlayers('all', this)" class="team-tab ${selectedId === 'all' ? 'active' : ''} text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: ${selectedId === 'all' ? themeColor : '#4b5563'}; color: ${selectedId === 'all' ? 'black' : 'white'};">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`;
            
            html += teams.map(t => `
                <button onclick="renderPlayers('${t.id}', this)" class="team-tab ${selectedId == t.id ? 'active' : ''} text-black px-4 py-1 rounded-full text-sm font-bold transition hover:opacity-80" style="background-color: ${selectedId == t.id ? themeColor : '#4b5563'}; color: ${selectedId == t.id ? 'black' : 'white'};">
                    ${t.name}
                </button>
            `).join('');

            tabsContainer.innerHTML = html;
        }

        function renderPlayers(teamId = 'all') {
            currentTeamView = teamId;
            const list = document.getElementById('players-list');
            const filteredPlayers = teamId === 'all' 
                ? players.sort((a,b) => a.name.localeCompare(b.name))
                : players.filter(p => p.teamId === teamId).sort((a,b) => a.no - b.no || a.name.localeCompare(b.name));

            document.getElementById('team-tabs-container').querySelectorAll('.team-tab').forEach(btn => {
                const btnTeamId = btn.getAttribute('onclick').match(/'(.*?)'/)[1];
                if (btnTeamId === teamId) {
                    btn.classList.add('active');
                    btn.style.backgroundColor = themeColor;
                    btn.style.color = 'black';
                } else {
                    btn.classList.remove('active');
                    btn.style.backgroundColor = '#4b5563';
                    btn.style.color = 'white';
                }
            });

            list.innerHTML = `
                <div class="player-card rounded-xl p-3 flex flex-col items-center justify-center cursor-pointer hover:shadow-xl transition" onclick="openPlayerModal()">
                    <i class="fas fa-plus-circle text-4xl mb-2" style="color: var(--primary-color);"></i>
                    <div class="font-bold text-sm" style="color: var(--primary-color);">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏´‡∏°‡πà</div>
                </div>
            ` + filteredPlayers.map(p => {
                const t = teams.find(x => x.id == p.teamId);
                const pStats = getPlayerStats(p.id);

                return `
                    <div class="player-card rounded-xl shadow-lg relative">
                        <button onclick="openPlayerModal(${p.id})" class="player-photo-container block w-full relative">
                            <img src="${p.img || ''}" alt="${p.name}" class="player-photo">
                            <div class="player-num-tag" style="background-color: ${t?.color || themeColor};">${p.no || '-'}</div>
                        </button>
                        <div class="p-3">
                            <div class="font-bold text-sm truncate" style="color: ${t?.color || 'white'}">${p.name}</div>
                            <div class="text-xs text-gray-400 truncate">${t?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                            <div class="mt-2 flex justify-between text-xs font-semibold">
                                <span class="text-red-400"><i class="fas fa-futbol"></i> ${pStats.goals}</span>
                                <span class="text-yellow-400"><i class="fas fa-grip-lines"></i> ${pStats.yellows}</span>
                                <span class="text-red-600"><i class="fas fa-stop"></i> ${pStats.reds}</span>
                                <span class="text-blue-400"><i class="fas fa-shield-alt"></i> ${pStats.saves}</span>
                            </div>
                            <div class="absolute top-2 right-2 opacity-100 transition flex gap-1">
                                <button onclick="openPlayerModal(${p.id})" class="text-blue-400 bg-black/50 rounded-full w-6 h-6 text-sm hover:text-blue-300"><i class="fas fa-edit"></i></button>
                                <button onclick="delPlayer(${p.id})" class="text-red-400 bg-black/50 rounded-full w-6 h-6 text-sm hover:text-red-300"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>`;
            }).join('') || '<p class="text-center text-gray-400 py-10 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</p>';
        }

        function openPlayerModal(id = null) {
            document.getElementById('player-modal').classList.remove('hidden');
            document.getElementById('p-img-preview').classList.add('hidden');
            document.getElementById('p-id').value = '';
            document.getElementById('p-name').value = '';
            document.getElementById('p-no').value = '';
            document.getElementById('p-team').value = '';
            document.getElementById('p-manager').checked = false;
            document.getElementById('p-img').value = '';
            document.getElementById('player-modal-title').innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('btn-player-save').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

            updateDropdowns(); // Ensure team dropdown is up to date

            if (id) {
                const p = players.find(x => x.id == id);
                if (p) {
                    document.getElementById('p-id').value = p.id;
                    document.getElementById('p-name').value = p.name;
                    document.getElementById('p-no').value = p.no;
                    document.getElementById('p-team').value = p.teamId;
                    document.getElementById('p-manager').checked = p.manager;
                    document.getElementById('player-modal-title').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞';
                    document.getElementById('btn-player-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
                    if (p.img) {
                        document.getElementById('p-img-preview').src = p.img;
                        document.getElementById('p-img-preview').classList.remove('hidden');
                    }
                }
            }
        }
        
        function delPlayer(id) {
            if(confirm('‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡∏ô‡∏µ‡πâ? ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢!')) {
                players = players.filter(p => p.id != id);
                stats = stats.filter(s => s.playerId != id);
                save();
            }
        }
        
        // --- 7. GLOBAL SETTINGS ---
        function toggleSettings() {
            document.getElementById('settings-modal').classList.toggle('hidden');
            if (!document.getElementById('settings-modal').classList.contains('hidden')) {
                document.getElementById('global-logo-preview').src = globalLogo;
            }
        }

        async function uploadGlobalLogo() {
            const input = document.getElementById('global-logo-input');
            const file = input.files[0];
            if (!file) return;

            // Compress the image before saving to storage
            const compressedBase64 = await compressImage(file);
            globalLogo = compressedBase64;
            save();
            document.getElementById('global-logo-preview').src = globalLogo;
            input.value = null; // Clear file input
        }

        function clearGlobalLogo() {
            globalLogo = "";
            save();
            document.getElementById('global-logo-preview').src = '';
        }
        
        function exportData() {
            const data = {
                teams,
                players,
                matches,
                stats,
                schedules,
                globalLogo,
                themeName,
                themeColor,
                secondaryColor
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `jakhong_league_data_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            if (!input.files.length) return;
            
            if (!confirm("‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?")) {
                input.value = null;
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    teams = importedData.teams || [];
                    players = importedData.players || [];
                    matches = importedData.matches || [];
                    stats = importedData.stats || [];
                    schedules = importedData.schedules || [];
                    globalLogo = importedData.globalLogo || "";
                    themeName = importedData.themeName || 'JAKHONG SYSTEM';
                    themeColor = importedData.themeColor || '#facc15';
                    secondaryColor = importedData.secondaryData || '#1c365b';

                    save(); 
                    alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
                    document.getElementById('settings-modal').classList.add('hidden');
                    input.value = null;

                } catch (error) {
                    alert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå: ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢");
                    console.error("Import Error:", error);
                    input.value = null;
                }
            };
            reader.readAsText(file);
        }
        
        function confirmClearAll() {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Local Storage? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!")) {
                localStorage.clear();
                teams = DEFAULT_TEAMS;
                players = DEFAULT_PLAYERS;
                matches = [];
                stats = [];
                schedules = [];
                globalLogo = "";
                themeName = 'JAKHONG SYSTEM';
                themeColor = '#facc15';
                secondaryColor = '#1c365b';

                save(); // Re-save defaults
                alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô");
                document.getElementById('settings-modal').classList.add('hidden');
            }
        }
        
        function updateScheduleMatchDropdown() {
            const dropdown = document.getElementById('m-schedule-id');
            const recordedMatchIds = matches.map(m => m.scheduleId).filter(id => id !== null);
            const pendingSchedules = schedules.filter(s => !recordedMatchIds.includes(s.id.toString()));

            dropdown.innerHTML = '<option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---</option>' + 
                pendingSchedules.map(s => {
                    const teamA = teams.find(t => t.id == s.teamA);
                    const teamB = teams.find(t => t.id == s.teamB);
                    return `<option value="${s.id}" data-team-a="${s.teamA}" data-team-b="${s.teamB}" data-date="${s.date}">[${formatDate(s.date)}] ${teamA?.name || '‡∏ó‡∏µ‡∏° A'} vs ${teamB?.name || '‡∏ó‡∏µ‡∏° B'}</option>`;
                }).join('');
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if (teams.length === 0) teams = DEFAULT_TEAMS;
            if (players.length === 0) players = DEFAULT_PLAYERS;
            
            // Set default date for daily page
            const dailyDateInput = document.getElementById('daily-date');
            if (dailyDateInput && !dailyDateInput.value) {
                dailyDateInput.value = new Date().toISOString().slice(0, 10);
            }

            renderTheme();
            renderAll();
            nav('home', document.querySelector('.nav-btn.active')); // Ensure dashboard is rendered
        });
        
    </script>
</body>
</html>
