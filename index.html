

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jakhong League System 4.2 (Modified)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,300;0,400;0,600;0,800;1,800&display=swap" rel="stylesheet">

    <style>
        /* --- DYNAMIC THEME VARIABLES (NEW) --- */
        :root {
            --primary-color: #facc15; /* Default Yellow-400 (Accent) */
            --secondary-color: #1c365b; /* Default Dark Blue (Header/Base Gradient Start) */
            --theme-end: #0c1626;   /* Very Dark Blue (Fixed Background Base) */
        }
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--theme-end);
            color: white;
            background-image: radial-gradient(circle at top right, #34050520 0%, transparent 40%),
                              radial-gradient(circle at bottom left, #1a1a1a 0%, transparent 40%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(12, 22, 38, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .navbar {
            background: rgba(12, 22, 38, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--primary-color);
        }
        .nav-btn {
            color: #ccc;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .nav-btn.active {
            background: var(--primary-color); 
            color: #000;
            font-weight: 700;
            border: 1px solid var(--primary-color);
            transform: scale(1.05);
        }
        .nav-btn:hover:not(.active) {
            background: rgba(var(--primary-color), 0.1); 
            color: var(--primary-color);
        }
        .logo-circle {
            border-radius: 50%;
            object-fit: cover;
            aspect-ratio: 1/1;
        }

        /* Player Card Design (Kept minimal style) */
        .player-card {
            background: linear-gradient(145deg, #1f2937, #0c1626);
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .player-photo-container {
            position: relative;
            overflow: hidden;
            background-color: #0c1626;
            border-bottom: 3px solid var(--primary-color);
            aspect-ratio: 3 / 4; 
        }
        .player-photo-container img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            object-position: top center;
        }
        /* Player Number Style (Circular only) */
        .player-num-tag {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--primary-color); 
            color: black;
            font-size: 0.9rem;
            font-weight: 900;
            width: 32px; /* Slightly larger circle */
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid white;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); } 
        .no-scrollbar::-webkit-scrollbar { display: none; }

        .outline-text {
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
        }
        
        /* Schedule Grouping */
        .schedule-group-header {
            background-color: var(--primary-color); 
            color: black;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            margin-top: 1.5rem;
            box-shadow: 0 4px 10px rgba(var(--primary-color), 0.2); 
        }
        /* Daily Summary Score Style (FIXED: Score Overlap) */
        .daily-score-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem; /* 3xl */
            font-weight: 900; /* black */
            letter-spacing: -0.05em; /* tracking-tighter */
            position: relative;
        }
        /* --- FIX: REMOVED TEXT SHADOW ON SCORE NUMBERS --- */
        .daily-score-number {
            width: 50px;            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
            height: 50px;           /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á */
            display: flex;          /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Flexbox */
            justify-content: center; /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
            align-items: center;    /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
            border-radius: 6px;     /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏ö */
            line-height: 1;
            z-index: 10; 
        }
        
        .daily-vs {
            /* FIX: Make VS smaller and central */
            font-size: 1rem;
            font-weight: 700;
            margin: 0 0.3rem;
            z-index: 5;
            color: #ccc;
        }

        /* FIX: Today Scorer Number Tag */
        .today-scorer-num-tag {
            position: absolute;
            top: 5px;
            right: 5px;
            background: black; 
            color: white; 
            font-size: 0.7rem;
            font-weight: 900;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* --- SCHEDULE CARD NEW DESIGN --- */
        .schedule-match-card {
            background: #111827; /* gray-900 */
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 150px 1fr; /* Team A | Center Info | Team B */
            align-items: center;
            cursor: pointer;
            overflow: hidden;
        }
        .schedule-match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }
        
        .schedule-team-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 50%;
            background-color: white;
            padding: 4px;
            border: 3px solid transparent;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* Center Info Style */
        .schedule-center-info {
            position: relative;
            text-align: center;
            padding: 1rem 0;
            z-index: 10;
        }
        /* VS Separator (Cooler effect) */
        .schedule-center-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 100%;
            background: repeating-linear-gradient(to bottom, var(--primary-color), var(--primary-color) 4px, transparent 4px, transparent 8px);
            opacity: 0.2;
            z-index: 5;
        }

        /* Action Buttons Container (Hidden by default) - REMOVED EDIT BUTTON */
        .schedule-actions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .schedule-match-card.show-actions .schedule-actions {
            opacity: 1;
            visibility: visible;
        }
        /* Team Containers */
        .schedule-team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        .schedule-team-container.team-a { text-align: right; }
        .schedule-team-container.team-b { text-align: left; }
        .schedule-team-container .flex { margin-top: 8px; }

        /* Media Query for larger screens */
        @media (min-width: 640px) {
            .schedule-team-container.team-a { 
                flex-direction: row; 
                justify-content: flex-end;
                text-align: right;
                gap: 12px;
            }
            .schedule-team-container.team-b { 
                flex-direction: row; 
                justify-content: flex-start;
                text-align: left;
                gap: 12px;
            }
            /* Adjust padding on larger screens */
            .schedule-team-container { padding: 1.5rem 1rem; }
        }

        /* --- NEW: Daily Top Scorer Grid Design (Desktop) --- */
        .top-scorer-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr); /* Default to 1 column */
            gap: 1rem;
        }
        @media (min-width: 768px) { /* md: */
            .top-scorer-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (min-width: 1024px) { /* lg: */
            .top-scorer-grid {
                grid-template-columns: repeat(5, 1fr); /* 5 columns for top 5 */
            }
        }
        .scorer-card {
            background: #1f2937;
            border-radius: 12px;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            transition: all 0.2s;
        }
        .scorer-card.is-top {
            border-color: var(--primary-color);
        }
        .scorer-card-img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 3px solid white;
            margin-bottom: 0.5rem;
            aspect-ratio: 3/4;
        }
        
        .scorer-rank-tag {
            position: absolute;
            top: 15px; 
            left: 10px; 
            transform: translateY(-50%); 
            
            background: var(--primary-color);
            color: black; 
            
            font-size: 0.9rem; /* *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (‡∏à‡∏≤‡∏Å 1rem) *** */
            font-weight: 900;
            width: 32px; /* *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (‡∏à‡∏≤‡∏Å 35px) *** */
            height: 32px; /* *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (‡∏à‡∏≤‡∏Å 35px) *** */
            
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid white; 
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* --- NEW: All Stats Filter Styles --- */
        .all-stats-row {
            transition: all 0.1s;
        }
        .all-stats-row:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
    </style>
</head>
<body class="flex flex-col">

    <nav class="navbar sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg border border-white" 
                         style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color))">
                        <i class="fas fa-trophy text-black"></i>
                    </div>
                    <h1 class="text-xl font-extrabold italic uppercase tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500" 
                        id="nav-title">
                        JAKHONG SYSTEM
                    </h1>
                </div>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white transition"><i class="fas fa-cog text-xl"></i></button>
            </div>
            <div class="flex overflow-x-auto gap-3 pb-3 no-scrollbar">
                <button onclick="nav('home', this)" class="nav-btn active px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-home"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                <button onclick="nav('leaderboard', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-list-ol"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                <button onclick="nav('schedule', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-calendar-alt"></i> ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á</button>
                <button onclick="nav('daily', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-star"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•/‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</button>
                <button onclick="nav('stats', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-chart-bar"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
                <button onclick="nav('teams', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-shield-alt"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</button>
                <button onclick="nav('players', this)" class="nav-btn px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition"><i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</button>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-2 py-6 md:px-4">

        <div id="page-home" class="section fade-in">
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-3" style="color: var(--primary-color);">
                    <i class="fas fa-chart-line"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏µ‡∏Å
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4" style="border-color: var(--primary-color);">
                        <div class="text-3xl font-black" id="stat-total-teams">0</div>
                        <div class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°</div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-green-500">
                        <div class="text-3xl font-black" id="stat-total-stats">0</div>
                        <div class="text-gray-400 text-sm">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div> 
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-red-500">
                        <div class="text-3xl font-black" id="stat-total-goals">0</div>
                        <div class="text-gray-400 text-sm">‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ï‡∏π</div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-b-4 border-blue-500">
                        <div class="text-3xl font-black" id="stat-total-players">0</div>
                        <div class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div id="leader-team-card" class="glass p-5 rounded-2xl border-l-4 flex items-center gap-4" style="border-color: var(--primary-color);">
                    <i class="fas fa-trophy text-4xl" style="color: var(--primary-color);"></i>
                    <div>
                        <div class="text-lg font-bold" style="color: var(--primary-color);">‡∏ó‡∏µ‡∏°‡∏ô‡∏≥‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</div>
                        <div class="text-2xl font-black uppercase" id="leader-team-name">N/A</div>
                        <div class="text-sm text-gray-300"><span id="leader-team-pts">0</span> ‡πÅ‡∏ï‡πâ‡∏°</div>
                    </div>
                </div>
                <div id="top-scorer-card" class="glass p-5 rounded-2xl border-l-4 border-red-500 flex items-center gap-4">
                    <i class="fas fa-futbol text-4xl text-red-500"></i>
                    <div>
                        <div class="text-lg font-bold text-red-400">‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</div>
                        <div class="text-2xl font-black uppercase" id="top-scorer-name">N/A</div>
                        <div class="text-sm text-gray-300"><span id="top-scorer-goals">0</span> ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</div>
                    </div>
                </div>
            </div>


            <div class="glass p-6 rounded-2xl">
                <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-3" style="color: var(--primary-color);">
                    <i class="fas fa-user-tie"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°
                </h2>
                <div id="manager-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    </div>
            </div>
        </div>

        <div id="page-leaderboard" class="section hidden fade-in">
            <div class="glass p-3 rounded-xl mb-4 flex flex-wrap gap-4 items-center text-xs">
                <strong class="text-yellow-400">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á:</strong>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label><input type="color" id="lb-bg-body" value="#1e293b" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</label><input type="color" id="lb-body-text-color" value="#ffffff" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á 1</label><input type="color" id="lb-header-grad-1" value="#1c365b" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á 2</label><input type="color" id="lb-header-grad-2" value="#0c1626" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label><input type="color" id="lb-header-text-color" value="#ffffff" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πâ‡∏° 1</label><input type="color" id="lb-pts-grad-1" value="#facc15" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πâ‡∏° 2</label><input type="color" id="lb-pts-grad-2" value="#e3a008" class="w-5 h-5 rounded align-middle ml-1 cursor-pointer" oninput="renderLeaderboard()"></div>
            </div>

            <div class="rounded-xl overflow-hidden shadow-2xl">
                <div id="lb-banner" class="p-6 text-center relative" style="background: linear-gradient(135deg, #1c365b, #0c1626);">
                    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
                    <h2 contenteditable="true" id="lb-title" class="relative text-3xl md:text-5xl font-extrabold uppercase italic outline-text tracking-wider z-10 focus:outline-none focus:border-b border-white" style="color: var(--primary-color);">
                        ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô JAKHONG SENIOR CUP
                    </h2>
                </div>
                
                <div class="overflow-x-auto bg-gray-900">
                    <table class="w-full text-left border-collapse min-w-[700px]" id="lb-table">
                        <thead>
                            <tr class="uppercase text-sm tracking-wider border-b border-white/10" id="lb-thead-row">
                                <th class="p-4" style="color: #ffffff;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="p-4" style="color: #ffffff;">‡∏ó‡∏µ‡∏°</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÅ‡∏Ç‡πà‡∏á</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡∏ä‡∏ô‡∏∞</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÄ‡∏™‡∏°‡∏≠</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÅ‡∏û‡πâ</th>
                                <th class="p-4 text-center" style="color: #ffffff;">‡πÑ‡∏î‡πâ/‡πÄ‡∏™‡∏µ‡∏¢</th>
                                <th class="p-4 text-center" style="color: #ffffff;">+/-</th>
                                <th class="p-0 text-center text-xl">
                                    <div style="background: linear-gradient(135deg, var(--primary-color), #e3a008); color: black;" class="font-black">‡πÅ‡∏ï‡πâ‡∏°</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="lb-body" class="text-base font-medium"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-schedule" class="section hidden fade-in">
            <div class="glass p-3 rounded-xl mb-4 flex flex-wrap gap-4 items-center text-xs">
                <button onclick="openAddSchedModal()" class="bg-green-600 text-white px-3 py-1 rounded font-bold hover:bg-green-500 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏°‡∏ó‡∏ä‡πå</button>
                <div class="h-4 w-px bg-gray-600"></div>
                <div><label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (BG)</label><input type="color" id="sc-bg-color-main" value="#1c365b" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()"></div>
                <label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (Overlay):</label>
                <input type="color" id="sc-bg-color" value="#1c365b" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <label>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£:</label>
                <input type="color" id="sc-text-color" value="#ffffff" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
                <input type="color" id="sc-pill-color" value="#facc15" class="w-5 h-5 rounded cursor-pointer" oninput="renderSchedule()">
                <input type="text" id="sc-header-text" value="‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô" class="bg-gray-700 text-white px-2 rounded w-32" oninput="renderSchedule()">
            </div>

            <div class="flex flex-col min-h-[500px] rounded-xl overflow-hidden shadow-2xl relative" id="schedule-main-container">
                <div class="flex-1 p-4 md:p-8 relative z-10 w-full" id="sc-container">
                    <div class="text-center mb-8">
                        <span id="sc-pill" class="inline-block px-8 py-2 rounded-full text-xl md:text-2xl font-bold uppercase shadow-lg text-black mb-2 transform skew-x-[-10deg]" style="background-color: var(--primary-color);">
                            ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                        </span>
                    </div>

                    <div class="flex gap-3 justify-center mb-6 overflow-x-auto no-scrollbar" id="group-tabs-container">
                        <button onclick="setGroupFilter('All', this)" class="group-tab active text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: var(--primary-color);">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <button onclick="setGroupFilter('A', this)" class="group-tab bg-gray-700 text-white px-4 py-1 rounded-full text-sm font-medium transition hover:bg-gray-600">‡∏Å‡∏•‡∏∏‡πà‡∏° A</button>
                        <button onclick="setGroupFilter('B', this)" class="group-tab bg-gray-700 text-white px-4 py-1 rounded-full text-sm font-medium transition hover:bg-gray-600">‡∏Å‡∏•‡∏∏‡πà‡∏° B</button>
                    </div>
                    
                    <div id="sched-list" class="space-y-4 max-w-4xl mx-auto">
                        </div>
                </div>

                <div id="sc-bg-overlay" class="absolute inset-0 z-0 bg-gradient-to-br from-blue-900 to-black opacity-90"></div>
            </div>
        </div>

        <div id="page-daily" class="section hidden fade-in">
            <div class="glass p-4 rounded-xl mb-6 flex flex-wrap gap-6 items-end">
                <div>
                    <label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Daily/Stats)</label>
                    <select id="daily-view-mode" class="bg-black border border-gray-600 p-2 rounded text-white text-sm w-full" onchange="renderDaily() || renderAllStats()">
                        <option value="daily">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</option>
                        <option value="stats">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏ó‡∏±‡πâ‡∏á‡∏•‡∏µ‡∏Å)</option>
                    </select>
                </div>
                <div id="daily-controls" class="flex flex-wrap gap-6 items-end">
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="daily-date" class="bg-black border border-gray-600 p-2 rounded text-white text-sm w-full" onchange="renderDaily()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-1">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</label>
                        <select id="daily-scorer-sort" class="bg-black border border-gray-600 p-2 rounded text-white text-sm" onchange="renderDaily()">
                            <option value="goals">‡∏õ‡∏£‡∏∞‡∏ï‡∏π (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                            <option value="name">‡∏ä‡∏∑‡πà‡∏≠</option>
                            <option value="number">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</option>
                        </select>
                    </div>

                    <div class="flex gap-2">
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏Å‡∏≠‡∏£‡πå</label><input type="color" id="daily-score-text-color" value="#000000" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏™‡∏Å‡∏≠‡∏£‡πå 1</label><input type="color" id="daily-score-grad-1" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏™‡∏Å‡∏≠‡∏£‡πå 2</label><input type="color" id="daily-score-grad-2" value="#e3a008" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label><input type="color" id="daily-team-name-color" value="#ffffff" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div> 
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ñ‡∏ö 1</label><input type="color" id="daily-row-bg-1" value="#1f2937" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ñ‡∏ö 2</label><input type="color" id="daily-row-bg-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>
                    <div class="flex gap-2">
                        <div><label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå 1</label><input type="color" id="daily-banner-grad-1" value="#1c365b" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå 2</label><input type="color" id="daily-banner-grad-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label><input type="color" id="daily-banner-text" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        <div><label class="text-xs text-gray-400 block mb-1">‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label><input type="color" id="daily-banner-border" value="#facc15" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                    </div>

                    <div class="w-full border-t border-gray-700 my-2 pt-2">
                        <label class="text-xs text-yellow-400 font-bold block mb-2">üé® ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞ (‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß):</label>
                        <div class="flex flex-wrap gap-2">
                            <div><label class="text-xs text-gray-400 block mb-1">‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î 1</label><input type="color" id="d-card-grad-1" value="#1c365b" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                            <div><label class="text-xs text-gray-400 block mb-1">‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î 2</label><input type="color" id="d-card-grad-2" value="#0c1626" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                            <div><label class="text-xs text-gray-400 block mb-1">‡∏™‡∏µ‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><input type="color" id="d-card-text" value="#ffffff" class="w-8 h-8 rounded cursor-pointer" oninput="renderDaily()"></div>
                        </div>
                    </div>
                </div>

                <div id="all-stats-controls" class="hidden">
                    <label class="text-xs text-gray-400 block mb-1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á</label>
                    <select id="stat-filter-type" class="bg-black border border-gray-600 p-2 rounded text-white text-sm" onchange="renderAllStats()">
                        <option value="goal">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="yellow">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="red">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                        <option value="save">üß§ ‡πÄ‡∏ã‡∏ü (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</option>
                    </select>
                </div>
            </div>

            <div id="daily-preview" class="bg-white max-w-[900px] mx-auto shadow-2xl overflow-hidden pb-10 rounded-xl">
                
                <div id="daily-header" class="py-4 px-4 flex flex-wrap items-center justify-between relative border-b-4 border-yellow-500">
                    <div class="flex items-center gap-3 z-10">
                        <img id="daily-logo-img" src="" class="w-12 h-12 object-contain drop-shadow-md bg-white rounded-full p-1 border border-yellow-400">
                        <div contenteditable="true" id="daily-title-edit" class="text-xl md:text-3xl font-extrabold uppercase italic leading-none outline-text text-yellow-400" style="text-shadow: 2px 2px 0 #000;">
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô 25/11/2568 JAKHONG LEAGUE 3
                        </div>
                    </div>
                </div>

                <div id="daily-content">
                    <div class="p-4 md:p-8 bg-gray-900 min-h-[200px] space-y-3" id="daily-matches-container"></div>

                    <div class="grid grid-cols-1 mt-4">
                        
                        <div class="bg-gray-800 p-4 border-b border-gray-700 flex flex-col">
                            <h3 class="text-center font-bold text-yellow-400 uppercase text-lg mb-4 border-b border-gray-700 pb-2">
                                <span id="daily-scorer-header">‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Top 5)</span>
                            </h3>
                            <div id="daily-top-scorers" class="top-scorer-grid">
                                </div>
                        </div>

                        <div class="bg-gradient-to-br from-gray-900 to-black p-4">
                            <h3 class="text-center font-bold text-green-400 uppercase text-lg mb-4 border-b border-gray-700 pb-2">
                                ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                            </h3>
                            <div id="daily-today-scorers" class="top-scorer-grid">
                                </div>
                        </div>
                    </div>
                </div>

                <div id="all-stats-content" class="hidden">
                    <div class="p-4 md:p-8 bg-gray-900 min-h-[200px]">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="uppercase text-xs tracking-wider border-b border-white/10 text-gray-400">
                                    <th class="p-2">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                    <th class="p-2">‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</th>
                                    <th class="p-2 text-center">‡∏ó‡∏µ‡∏°</th>
                                    <th class="p-2 text-center" id="all-stats-header">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                </tr>
                            </thead>
                            <tbody id="all-stats-body" class="text-sm font-medium">
                                </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>

        <div id="page-stats" class="section hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-2xl h-fit">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ / ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á</h2>
                    <div class="mb-6 p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-gray-400 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏™‡∏Å‡∏≠‡∏£‡πå</h3>
                        <div class="mb-3">
                            <label class="text-xs text-gray-400">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á (‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πà‡∏á):</label>
                            <select id="m-schedule-id" class="w-full bg-gray-800 p-2 rounded text-xs" onchange="prefillMatchFromSchedule()">
                                <option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---</option>
                            </select>
                        </div>

                        <form onsubmit="handleMatchSubmit(event)" class="flex gap-2 items-center">
                            <input type="hidden" id="match-edit-id">
                            <input type="date" id="match-date" class="bg-gray-800 p-2 rounded text-white w-1/3 text-xs" required>
                            <select id="m-team-a" class="flex-1 bg-gray-800 p-2 rounded text-xs" required></select>
                            <input type="number" id="m-score-a" class="w-12 bg-black p-2 rounded text-center font-bold border" style="border-color: var(--primary-color);" min="0" value="0">
                            <span class="text-xs">VS</span>
                            <input type="number" id="m-score-b" class="w-12 bg-black p-2 rounded text-center font-bold border" style="border-color: var(--primary-color);" min="0" value="0">
                            <select id="m-team-b" class="flex-1 bg-gray-800 p-2 rounded text-xs" required></select>
                            <button type="submit" id="btn-match-save" class="bg-blue-600 px-3 py-2 rounded hover:bg-blue-500 transition"><i class="fas fa-save"></i></button>
                        </form>
                    </div>

                    <div class="p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-gray-400 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</h3>
                        <form onsubmit="handleStatSubmit(event)" class="space-y-4">
                            <input type="hidden" id="edit-stat-id">
                            <div class="flex gap-2">
                                <input type="date" id="s-date" class="bg-gray-800 p-2 rounded text-white w-1/3 text-xs" required>
                                <select id="s-type" class="bg-gray-800 p-2 rounded text-white flex-1 text-xs" onchange="updateStatPlayers()">
                                    <option value="goal">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
                                    <option value="yellow">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
                                    <option value="red">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</option>
                                    <option value="save">üß§ ‡πÄ‡∏ã‡∏ü</option>
                                </select>
                            </div>
                            <select id="s-team" class="w-full bg-gray-800 p-2 rounded text-white text-sm" onchange="updateStatPlayers();" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</option></select>
                            <select id="s-player" class="w-full bg-gray-800 p-2 rounded text-white text-sm" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞ (‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥)</option></select>
                            
                            <div class="flex items-center gap-3 bg-gray-900 p-2 rounded">
                                <button type="button" onclick="adjStat(-1)" class="w-8 h-8 bg-gray-700 rounded hover:bg-red-500 transition">-</button>
                                <input type="number" id="s-count" value="1" class="bg-transparent text-center w-10 font-bold" min="1">
                                <button type="button" onclick="adjStat(1)" class="w-8 h-8 bg-gray-700 rounded hover:bg-green-500 transition">+</button>
                                <input type="text" id="s-note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." class="flex-1 bg-transparent border-b border-gray-600 text-xs px-2">
                            </div>

                            <div class="flex gap-2">
                                <button type="submit" id="btn-stat-save" class="flex-1 text-black py-2 rounded font-bold hover:bg-yellow-400 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                <button type="button" onclick="resetStatForm()" id="btn-stat-cancel" class="hidden px-3 bg-gray-600 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="glass p-6 rounded-2xl h-[600px] overflow-hidden flex flex-col">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö)</h2>
                    
                    <div class="flex mb-4 border-b border-gray-700">
                        <button onclick="showHistory('match', this)" id="hist-tab-match" class="hist-tab px-4 py-2 text-sm font-bold border-b-2" style="color: var(--primary-color); border-color: var(--primary-color);">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
                        <button onclick="showHistory('stat', this)" id="hist-tab-stat" class="hist-tab px-4 py-2 text-sm font-bold text-gray-400 hover:text-white">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
                    </div>

                    <div class="overflow-y-auto pr-2 space-y-2 flex-1 custom-scrollbar">
                        <div id="history-match-list" class="space-y-2"></div>
                        <div id="history-stat-list" class="space-y-2 hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-teams" class="section hidden fade-in">
            <div class="glass p-6 rounded-2xl mb-8">
                <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h2>
                <form onsubmit="handleTeamSubmit(event)" class="flex flex-wrap gap-4 items-end">
                    <input type="hidden" id="team-edit-id">
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label>
                        <input type="text" id="team-name" class="w-full bg-gray-800 p-2 rounded border border-gray-600" required>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">‡∏™‡∏µ‡∏ó‡∏µ‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ)</label>
                        <input type="color" id="team-color" class="w-10 h-10 rounded cursor-pointer block mt-1">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î)</label>
                        <input type="tel" id="team-tel" class="w-full bg-gray-800 p-2 rounded border border-gray-600" placeholder="0xx-xxx-xxxx">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-xs text-gray-400">‡πÇ‡∏•‡πÇ‡∏Å‡πâ (‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡∏°‡πÉ‡∏´‡∏ç‡πà)</label>
                        <input type="file" id="team-logo" accept="image/*" class="w-full text-xs mt-1">
                    </div>
                    <button type="submit" id="btn-team-save" class="text-black px-6 py-2 rounded font-bold h-10 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" onclick="resetTeamForm()" id="btn-team-cancel" class="bg-gray-600 px-6 py-2 rounded font-bold h-10 hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </form>
            </div>
            <div id="team-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <div id="page-players" class="section hidden fade-in">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold italic uppercase" style="color: var(--primary-color);">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</h2>
                    <button onclick="openPlayerModal()" class="bg-green-600 px-4 py-2 rounded font-bold hover:bg-green-500 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</button>
                </div>
                <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar" id="player-team-tabs"></div>
                
                <div id="player-team-banner" class="hidden p-6 rounded-xl mb-6 shadow-xl flex items-center gap-6 border-l-8" style="background: linear-gradient(135deg, var(--secondary-color) 0%, #0c1626 100%); border-color: var(--primary-color);">
                    <img id="ptb-logo" class="w-24 h-24 rounded-full object-cover border-4 border-yellow-400 shadow-md">
                    <div>
                        <h2 id="ptb-name" class="text-4xl font-extrabold uppercase italic text-white">TEAM NAME</h2>
                        <div class="text-xl font-semibold" style="color: var(--primary-color);">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: <span id="ptb-member-count">0</span> ‡∏Ñ‡∏ô</div>
                    </div>
                    <input type="color" id="ptb-color-picker" class="hidden" oninput="updateTeamColorLive(this)">
                </div>
            </div>
            <div id="player-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </div>

    </main>

    <div id="sched-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á</h3>
            <form onsubmit="handleSchedSubmit(event)" class="space-y-4">
                <input type="date" id="sc-date" class="w-full bg-gray-800 p-2 rounded" required>
                <input type="time" id="sc-time" class="w-full bg-gray-800 p-2 rounded" required>
                <input type="number" id="sc-week" placeholder="Week ‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô 1, 2)" class="w-full bg-gray-800 p-2 rounded" min="1" required>
                <div class="flex gap-2">
                    <select id="sc-team-a" class="flex-1 bg-gray-800 p-2 rounded" required></select>
                    <span class="text-gray-400">VS</span>
                    <select id="sc-team-b" class="flex-1 bg-gray-800 p-2 rounded" required></select>
                </div>
                <select id="sc-group" class="w-full bg-gray-800 p-2 rounded">
                    <option value="">‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)</option>
                    <option value="A">‡∏Å‡∏•‡∏∏‡πà‡∏° A</option>
                    <option value="B">‡∏Å‡∏•‡∏∏‡πà‡∏° B</option>
                    <option value="C">‡∏Å‡∏•‡∏∏‡πà‡∏° C</option>
                    <option value="D">‡∏Å‡∏•‡∏∏‡πà‡∏° D</option>
                </select>
                <button class="w-full text-black py-2 rounded font-bold hover:opacity-90 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" onclick="document.getElementById('sched-modal').classList.add('hidden')" class="w-full bg-gray-600 py-2 rounded mt-2">‡∏õ‡∏¥‡∏î</button>
            </form>
        </div>
    </div>

    <div id="player-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-md">
            <h3 id="player-modal-title" class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</h3>
            <form onsubmit="handlePlayerSubmit(event)" class="space-y-3">
                <input type="hidden" id="p-id">
                <input type="text" id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full bg-gray-800 p-2 rounded" required>
                <div class="flex gap-2">
                    <input type="text" id="p-no" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå" class="w-20 bg-gray-800 p-2 rounded">
                    <select id="p-team" class="flex-1 bg-gray-800 p-2 rounded" required></select>
                </div>
                <label class="flex gap-2 text-sm items-center"><input type="checkbox" id="p-manager" class="w-4 h-4 text-yellow-500 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"> ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</label>
                <input type="file" id="p-img" accept="image/*" class="w-full text-xs text-gray-400">
                <p class="text-[10px] text-gray-500 mt-1">
                    *‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô 3:4 (300x400px) ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå
                </p>
                <button type="submit" id="btn-player-save" class="w-full bg-green-600 py-2 rounded font-bold hover:bg-green-500 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" onclick="closePlayerModal()" class="w-full bg-gray-600 py-2 rounded mt-2">‡∏õ‡∏¥‡∏î</button>
            </form>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black/90 hidden z-[60] flex items-center justify-center">
        <div class="glass p-6 rounded-xl w-full max-w-sm text-center">
            <h2 class="text-xl font-bold mb-4" style="color: var(--primary-color);">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏µ‡∏Å</h2>
            
            <div class="p-4 rounded-lg mb-4 text-left border border-gray-700 bg-gray-800">
                <h3 class="font-bold mb-3 text-white">1. ‡∏ò‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏µ‡∏Å</h3>
                <div class="mb-3">
                    <label class="text-sm text-gray-400 block mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏µ‡∏Å (‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Navbar)</label>
                    <input type="text" id="theme-name-input" class="w-full bg-gray-700 p-2 rounded text-white" placeholder="‡πÄ‡∏ä‡πà‡∏ô JAKHONG SENIOR CUP">
                </div>
                <div class="flex gap-4">
                    <div>
                        <label class="text-sm text-gray-400 block mb-1">‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å (Accent)</label>
                        <input type="color" id="theme-color-input" class="w-full h-10 rounded cursor-pointer" onchange="updateThemeAndSave()">
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 block mb-1">‡∏™‡∏µ‡∏£‡∏≠‡∏á (Header/Banner)</label>
                        <input type="color" id="secondary-color-input" class="w-full h-10 rounded cursor-pointer" onchange="updateThemeAndSave()">
                    </div>
                </div>
            </div>

            <div class="p-4 rounded-lg mb-4 text-left border border-gray-700 bg-gray-800">
                <h3 class="font-bold mb-3 text-white">2. ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏•‡∏µ‡∏Å</h3>
                <input type="file" id="global-logo-upload" accept="image/*" class="w-full text-sm text-gray-400 mb-4">
                <button onclick="saveGlobalLogo()" class="w-full text-black px-4 py-2 rounded font-bold hover:opacity-90 transition" style="background-color: var(--primary-color);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ</button>
            </div>
            
            <div class="p-4 rounded-lg mb-4 text-left border border-red-700 bg-red-800/20">
                <h3 class="font-bold mb-3 text-red-400"><i class="fas fa-database"></i> 3. ‡∏™‡∏≥‡∏£‡∏≠‡∏á/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <button onclick="exportData()" class="w-full bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500 transition mb-2">Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</button>
                
                <input type="file" id="data-import-file" accept=".json" class="w-full text-sm text-gray-400 my-2" onchange="importData(this)">
                <p class="text-[10px] text-gray-500">*‡∏Å‡∏≤‡∏£ Import ‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏¥‡∏°</p>
            </div>

            <button onclick="toggleSettings()" class="mt-2 text-gray-400 text-sm underline block w-full">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
    
    <div id="storage-warning-modal" class="fixed inset-0 bg-black/90 hidden z-[70] flex items-center justify-center">
        <div class="glass p-8 rounded-xl w-full max-w-lg text-center border-4 border-red-500 bg-red-800/20">
            <i class="fas fa-exclamation-triangle text-5xl text-red-400 mb-4 animate-pulse"></i>
            <h2 class="text-2xl font-bold mb-3 text-red-300">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°!</h2>
            <p class="text-white mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå **‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß** (Local Storage Quota Exceeded)</p>
            <p class="text-sm text-yellow-300 font-bold mb-6">‚ö†Ô∏è **‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤) ‡∏´‡∏£‡∏∑‡∏≠ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå Local Storage ‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ**</p>
            <button onclick="document.getElementById('storage-warning-modal').classList.add('hidden')" class="bg-red-600 text-white px-6 py-2 rounded font-bold hover:bg-red-500 transition">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        // --- STATE & THEME (UPDATED) ---
        let teams = JSON.parse(localStorage.getItem('jl_teams')) || [];
        let players = JSON.parse(localStorage.getItem('jl_players')) || [];
        let matches = JSON.parse(localStorage.getItem('jl_matches')) || [];
        let stats = JSON.parse(localStorage.getItem('jl_stats')) || [];
        let schedules = JSON.parse(localStorage.getItem('jl_schedules')) || [];
        
        let globalLogo = localStorage.getItem('jl_logo') || ""; 
        let themeName = localStorage.getItem('jl_theme_name') || 'JAKHONG SYSTEM';
        let themeColor = localStorage.getItem('jl_theme_color') || '#facc15';
        let secondaryColor = localStorage.getItem('jl_secondary_color') || '#1c365b'; 

        let currentGroupFilter = 'All'; 
        let currentTeamView = 'all';
        
        // ** CRITICAL FIX: Default Data Structure **
        const DEFAULT_TEAMS = [
            { id: 't1', name: 'Phoenix FC', color: '#ff4d4d', tel: '081-111-1111', logo: '' },
            { id: 't2', name: 'Dragon FC', color: '#00ccff', tel: '082-222-2222', logo: '' },
            { id: 't3', name: 'Titan FC', color: '#66ff66', tel: '083-333-3333', logo: '' },
        ];
        
        function loadDefaultData() {
            // Check if teams array is empty AND local storage key does not exist (true first load)
            if (teams.length === 0 && localStorage.getItem('jl_teams') === null) {
                teams = [...DEFAULT_TEAMS];
                players = [
                    // Sample players for default teams
                    { id: Date.now() + 1, name: '‡∏¢‡∏≠‡∏î‡∏Å‡∏±‡∏õ‡∏ï‡∏±‡∏ô', no: '10', teamId: 't1', manager: true, img: '' },
                    { id: Date.now() + 2, name: '‡πÄ‡∏™‡∏∑‡∏≠‡∏õ‡∏∑‡∏ô‡πÉ‡∏´‡∏ç‡πà', no: '9', teamId: 't2', manager: true, img: '' },
                    { id: Date.now() + 3, name: '‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏´‡∏¥‡∏ô', no: '5', teamId: 't3', manager: true, img: '' },
                ];
                save();
                alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà! ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° 3 ‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß (Phoenix, Dragon, Titan) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ');
            }
        }


        // *** CRITICAL: Save function with Theme Update ***
        const save = () => {
            try {
                localStorage.setItem('jl_teams', JSON.stringify(teams));
                localStorage.setItem('jl_players', JSON.stringify(players));
                localStorage.setItem('jl_matches', JSON.stringify(matches));
                localStorage.setItem('jl_stats', JSON.stringify(stats));
                localStorage.setItem('jl_schedules', JSON.stringify(schedules));
                localStorage.setItem('jl_logo', globalLogo);
                localStorage.setItem('jl_theme_name', themeName); 
                localStorage.setItem('jl_theme_color', themeColor); 
                localStorage.setItem('jl_secondary_color', secondaryColor); 

                renderTheme(); // Update theme immediately
                renderAll(); // RENDER ALL UI AFTER EVERY SAVE
            } catch (e) {
                if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
                    showStorageWarning();
                    console.error("Local Storage Quota Exceeded. Data not saved.", e);
                } else {
                    console.error("Error saving data:", e);
                }
            }
        }
        
        function showStorageWarning() {
            document.getElementById('storage-warning-modal').classList.remove('hidden');
        }

        // --- NEW: Theme Renderer ---
        function renderTheme() {
            // FIX: Ensure theme variables are updated correctly 
            themeColor = localStorage.getItem('jl_theme_color') || '#facc15';
            secondaryColor = localStorage.getItem('jl_secondary_color') || '#1c365b';
            themeName = localStorage.getItem('jl_theme_name') || 'JAKHONG SYSTEM';

            document.documentElement.style.setProperty('--primary-color', themeColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.getElementById('nav-title').innerText = themeName;
            
            // Update inputs in settings modal when opened
            const themeInput = document.getElementById('theme-color-input');
            if (themeInput) {
                themeInput.value = themeColor;
                document.getElementById('secondary-color-input').value = secondaryColor;
                document.getElementById('theme-name-input').value = themeName;
            }
        }

        function updateThemeAndSave() {
            themeColor = document.getElementById('theme-color-input').value;
            secondaryColor = document.getElementById('secondary-color-input').value;
            themeName = document.getElementById('theme-name-input').value;
            save(); // Save and trigger renderTheme
        }

        // *** Image Compression (Enhanced for saving storage) ***
        const compressImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const targetWidth = 300; 
                        const targetHeight = 400; 

                        const scale = Math.max(targetWidth / img.width, targetHeight / img.height);
                        const x = (targetWidth / 2) - (img.width / 2) * scale;
                        const y = (targetHeight / 2) - (img.height / 2) * scale;

                        canvas.width = targetWidth;
                        canvas.height = targetHeight;
                        
                        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                        
                        // FIX: Use JPEG and optimize quality to 0.8
                        resolve(canvas.toDataURL('image/jpeg', 0.8)); 
                    }
                    img.onerror = () => resolve('');
                }
                reader.onerror = () => resolve('');
            });
        }

        const formatDate = (d) => {
            if(!d) return '';
            return new Date(d).toLocaleDateString('th-TH', {day:'2-digit', month:'2-digit', year:'numeric'});
        }
        
        // FIX: Ensure onload calls are correct
        window.onload = () => {
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(i => i.value = today);
            
            loadDefaultData(); // ** CRITICAL: Load defaults before rendering **

            renderTheme(); 
            if(globalLogo) document.getElementById('daily-logo-img').src = globalLogo;
            
            renderAll();
            // FIX: Set initial nav state to home
            const initialButton = document.querySelector('.nav-btn');
            if (initialButton) {
                nav('home', initialButton);
            } else {
                renderDashboard();
            }
            
            // NEW: Add event listener for schedule card (simulated)
            document.getElementById('sched-list').addEventListener('click', (e) => {
                const card = e.target.closest('.schedule-match-card');
                if (card) {
                    // Hide all others and toggle this one
                    document.querySelectorAll('.schedule-match-card').forEach(c => {
                        if (c !== card) {
                            c.classList.remove('show-actions');
                        }
                    });
                    card.classList.toggle('show-actions');
                }
            });
            
            // Set initial view for daily page
            const viewMode = document.getElementById('daily-view-mode').value;
            if (viewMode === 'daily') {
                document.getElementById('daily-content').classList.remove('hidden');
                document.getElementById('all-stats-content').classList.add('hidden');
                document.getElementById('daily-controls').classList.remove('hidden');
                document.getElementById('all-stats-controls').classList.add('hidden');
                renderDaily();
            } else {
                document.getElementById('daily-content').classList.add('hidden');
                document.getElementById('all-stats-content').classList.remove('hidden');
                document.getElementById('daily-controls').classList.add('hidden');
                document.getElementById('all-stats-controls').classList.remove('hidden');
                renderAllStats();
            }
        }

        function nav(id, button) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById('page-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(button) button.classList.add('active');

            if(id === 'home') renderDashboard();
            if(id === 'daily') {
                const viewMode = document.getElementById('daily-view-mode').value;
                if (viewMode === 'daily') {
                    renderDaily();
                } else {
                    renderAllStats();
                }
            }
            if(id === 'leaderboard') renderLeaderboard();
            if(id === 'stats') {
                // FIX: Ensure the correct tab is shown
                const matchTab = document.getElementById('hist-tab-match');
                if (matchTab) {
                    showHistory('match', matchTab); 
                }
                updateScheduleMatchDropdown(); 
            }
            if(id === 'teams') renderTeams();
            if(id === 'players') {
                renderTeamsTabs(currentTeamView); // Render tabs
                renderPlayers(currentTeamView); // Render players
            }
            if(id === 'schedule') renderSchedule();
        }

        function renderAll() {
            // FIX: Ensure all major rendering functions are called to refresh the UI
            updateDropdowns();
            renderLeaderboard();
            renderSchedule();
            renderTeams(); 
            renderTeamsTabs(currentTeamView); 
            renderPlayers(currentTeamView); 
            renderMatchHistory(); 
            renderStatHistory();
            renderDashboard(); 
            updateScheduleMatchDropdown(); 
            // Re-render the active view for daily page
            const viewMode = document.getElementById('daily-view-mode').value;
            if (viewMode === 'daily') {
                renderDaily();
            } else {
                renderAllStats();
            }
        }

        function updateDropdowns() {
            const opts = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</option>` + teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            ['sc-team-a','sc-team-b','m-team-a','m-team-b','s-team','p-team'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.innerHTML = opts;
            });
        }
        
        // --- 0. DASHBOARD (Need player stats helper) ---
        
        // 1. UPDATED: getPlayerCardStats - Removed assist calculation logic
        function getPlayerCardStats(playerId) {
            const playerStats = stats.filter(s => s.playerId == playerId);
            return {
                goals: playerStats.filter(s => s.type === 'goal').reduce((sum, s) => sum + s.count, 0),
                assists: 0, // Assist system removed
                yellows: playerStats.filter(s => s.type === 'yellow').reduce((sum, s) => sum + s.count, 0),
                reds: playerStats.filter(s => s.type === 'red').reduce((sum, s) => sum + s.count, 0),
                saves: playerStats.filter(s => s.type === 'save').reduce((sum, s) => sum + s.count, 0),
            };
        }
        
        function calculateDashboardStats() {
            const totalGoals = matches.reduce((sum, m) => sum + parseInt(m.scoreA) + parseInt(m.scoreB), 0);
            const playerGoals = players.map(p => {
                const s = getPlayerCardStats(p.id);
                return { name: p.name, goals: s.goals };
            }).sort((a, b) => b.goals - a.goals);

            const topScorer = playerGoals.length > 0 ? playerGoals[0] : { name: 'N/A', goals: 0 };
            const totalStats = stats.length + matches.length;

            document.getElementById('stat-total-teams').innerText = teams.length;
            document.getElementById('stat-total-players').innerText = players.length;
            document.getElementById('stat-total-goals').innerText = totalGoals;
            document.getElementById('stat-total-stats').innerText = totalStats;
            
            document.getElementById('top-scorer-name').innerText = topScorer.name.toUpperCase();
            document.getElementById('top-scorer-goals').innerText = topScorer.goals;

            // Team Leader
            const standings = calculateLeaderboardData().sort((a,b) => b.pts - a.pts);
            const leaderTeam = standings.length > 0 ? teams.find(t => t.id == standings[0].id) : null;
            document.getElementById('leader-team-name').innerText = leaderTeam ? leaderTeam.name.toUpperCase() : 'N/A';
            document.getElementById('leader-team-pts').innerText = standings.length > 0 ? standings[0].pts : 0;
            if(leaderTeam) document.getElementById('leader-team-card').style.borderColor = leaderTeam.color;

            // Managers List
            const managerList = document.getElementById('manager-list');
            const managers = players.filter(p => p.manager).map(p => {
                const t = teams.find(t => t.id == p.teamId);
                return { name: p.name, teamName: t?.name, teamTel: t?.tel, teamColor: t?.color };
            });

            managerList.innerHTML = managers.map(m => `
                <div class="p-3 rounded-lg flex items-center gap-3 bg-gray-900 border-l-4" style="border-color: ${m.teamColor || themeColor};">
                    <i class="fas fa-user-tie text-xl" style="color: ${m.teamColor || themeColor};"></i>
                    <div>
                        <div class="font-bold">${m.name}</div>
                        <div class="text-sm text-gray-400">${m.teamName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'} | Tel: ${m.teamTel || 'N/A'}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderDashboard() {
            calculateDashboardStats();
        }

        // --- 1. LEADERBOARD ---
        function calculateLeaderboardData() {
            const data = teams.map(t => ({
                id: t.id,
                name: t.name,
                color: t.color,
                p: 0, w: 0, d: 0, l: 0, gf: 0, ga: 0, gd: 0, pts: 0
            }));

            matches.forEach(m => {
                const idxA = data.findIndex(d => d.id == m.teamA);
                const idxB = data.findIndex(d => d.id == m.teamB);
                if (idxA === -1 || idxB === -1) return; // Skip if team not found

                const scoreA = parseInt(m.scoreA);
                const scoreB = parseInt(m.scoreB);

                // Update Team A
                data[idxA].p++;
                data[idxA].gf += scoreA;
                data[idxA].ga += scoreB;
                data[idxA].gd = data[idxA].gf - data[idxA].ga;

                // Update Team B
                data[idxB].p++;
                data[idxB].gf += scoreB;
                data[idxB].ga += scoreA;
                data[idxB].gd = data[idxB].gf - data[idxB].ga;

                if (scoreA > scoreB) {
                    data[idxA].w++; data[idxA].pts += 3;
                    data[idxB].l++;
                } else if (scoreA < scoreB) {
                    data[idxB].w++; data[idxB].pts += 3;
                    data[idxA].l++;
                } else {
                    data[idxA].d++; data[idxA].pts += 1;
                    data[idxB].d++; data[idxB].pts += 1;
                }
            });

            // Sort: Points (desc), Goal Difference (desc), Goals For (desc), Name (asc)
            return data.sort((a, b) => {
                if (b.pts !== a.pts) return b.pts - a.pts;
                if (b.gd !== a.gd) return b.gd - a.gd;
                if (b.gf !== a.gf) return b.gf - a.gf;
                return a.name.localeCompare(b.name);
            });
        }

        function renderLeaderboard() {
            const standings = calculateLeaderboardData();
            const body = document.getElementById('lb-body');

            const cBgBody = document.getElementById('lb-bg-body').value;
            const cBodyText = document.getElementById('lb-body-text-color').value;
            const cPtsGrad1 = document.getElementById('lb-pts-grad-1').value;
            const cPtsGrad2 = document.getElementById('lb-pts-grad-2').value;
            const cHeaderGrad1 = document.getElementById('lb-header-grad-1').value;
            const cHeaderGrad2 = document.getElementById('lb-header-grad-2').value;
            const cHeaderText = document.getElementById('lb-header-text-color').value;

            // Apply Header Theme
            document.getElementById('lb-banner').style.background = `linear-gradient(135deg, ${cHeaderGrad1}, ${cHeaderGrad2})`;
            document.getElementById('lb-thead-row').style.background = `linear-gradient(to right, ${cHeaderGrad1}, ${cHeaderGrad2})`;
            document.querySelectorAll('#lb-thead-row th').forEach(th => th.style.color = cHeaderText);
            document.getElementById('lb-thead-row').lastElementChild.children[0].style.background = `linear-gradient(135deg, ${cPtsGrad1}, ${cPtsGrad2})`;


            // 2. UPDATED: Removed color classes for W/D/L
            body.innerHTML = standings.map((t, i) => `
                <tr class="transition duration-150 ease-in-out hover:bg-gray-700/50" style="background-color: ${cBgBody}; color: ${cBodyText};">
                    <td class="p-4 font-black text-center" style="color: ${t.color};">${i + 1}</td>
                    <td class="p-4 font-bold uppercase">${t.name}</td>
                    <td class="p-4 text-center">${t.p}</td>
                    <td class="p-4 text-center">${t.w}</td> 
                    <td class="p-4 text-center">${t.d}</td>
                    <td class="p-4 text-center">${t.l}</td>
                    <td class="p-4 text-center">${t.gf}/${t.ga}</td>
                    <td class="p-4 text-center">${t.gd > 0 ? '+' : ''}${t.gd}</td>
                    <td class="p-0 text-center">
                        <div class="h-full py-4 px-2 font-black text-xl" style="background: linear-gradient(135deg, ${cPtsGrad1}, ${cPtsGrad2}); color: black;">${t.pts}</div>
                    </td>
                </tr>
            `).join('');
        }

        // --- 2. SCHEDULE ---
        function openAddSchedModal() {
            // FIX: Ensure team dropdown is updated
            updateDropdowns(); 
            document.getElementById('sched-modal').classList.remove('hidden');
        }

        function handleSchedSubmit(e) {
            e.preventDefault();
            const obj = {
                id: Date.now(),
                date: document.getElementById('sc-date').value,
                time: document.getElementById('sc-time').value,
                week: document.getElementById('sc-week').value,
                teamA: document.getElementById('sc-team-a').value,
                teamB: document.getElementById('sc-team-b').value,
                group: document.getElementById('sc-group').value,
                result: null // Status: Pending
            };
            schedules.push(obj);
            save();
            document.getElementById('sched-modal').classList.add('hidden');
            e.target.reset();
        }

        function setGroupFilter(group, button) {
            currentGroupFilter = group;
            document.querySelectorAll('.group-tab').forEach(btn => {
                btn.classList.remove('active');
                btn.style.backgroundColor = '#4b5563'; 
                btn.style.color = 'white';
            });
            button.classList.add('active');
            button.style.backgroundColor = themeColor; 
            button.style.color = 'black';
            renderSchedule();
        }

        function renderSchedule() {
            const cont = document.getElementById('sched-list');
            const cBgColorOverlay = document.getElementById('sc-bg-color').value; // Overlay color
            const cBgColorMain = document.getElementById('sc-bg-color-main').value; // Main background color
            const cTextColor = document.getElementById('sc-text-color').value; // ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const cPillColor = document.getElementById('sc-pill-color').value;
            const cHeaderText = document.getElementById('sc-header-text').value;

            // Apply new main background color
            document.getElementById('schedule-main-container').style.backgroundColor = cBgColorMain;

            // Apply overlay color (original blue gradient effect)
            document.getElementById('sc-bg-overlay').style.background = `linear-gradient(to br, ${cBgColorOverlay}, #0c1626)`;
            
            document.getElementById('sc-pill').style.backgroundColor = cPillColor;
            document.getElementById('sc-pill').innerText = cHeaderText;

            const filteredSchedules = currentGroupFilter === 'All' 
                ? schedules 
                : schedules.filter(s => s.group === currentGroupFilter);

            // Group by Week or Date
            const grouped = filteredSchedules.reduce((acc, curr) => {
                const key = `Week ${curr.week} (${formatDate(curr.date)})`;
                if (!acc[key]) acc[key] = [];
                acc[key].push(curr);
                return acc;
            }, {});

            let html = Object.keys(grouped).sort().map(key => {
                const matchesHtml = grouped[key].map(s => {
                    const tA = teams.find(t => t.id == s.teamA);
                    const tB = teams.find(t => t.id == s.teamB);
                    const matchExists = matches.some(m => m.teamA === s.teamA && m.teamB === s.teamB && m.date === s.date) || 
                                        matches.some(m => m.teamA === s.teamB && m.teamB === s.teamA && m.date === s.date);
                    const status = matchExists ? `<span class="text-sm font-bold text-green-400">‡πÅ‡∏Ç‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>` : `<span class="text-sm font-bold text-gray-500">‡∏£‡∏≠‡πÅ‡∏Ç‡πà‡∏á</span>`; 
                    
                    // Logic for Group display (Empty string if group is null/empty)
                    const groupDisplay = s.group ? `‡∏Å‡∏•‡∏∏‡πà‡∏° ${s.group}` : ''; 

                    // NEW: Schedule Card HTML Structure
                    return `
                        <div class="schedule-match-card" data-id="${s.id}">
                            
                            <div class="schedule-team-container team-a" style="color: ${cTextColor};">
                                <div class="hidden sm:block text-right">
                                    <div class="font-bold text-lg uppercase">${tA?.name || 'N/A'}</div>
                                    <div class="text-xs text-gray-400">${groupDisplay}</div>
                                </div>
                                <img src="${tA?.logo || ''}" class="schedule-team-logo" style="border-color: ${tA?.color || themeColor};" alt="${tA?.name || 'Team A'} Logo">
                                <div class="block sm:hidden text-center mt-2">
                                    <div class="font-bold text-sm uppercase">${tA?.name || 'N/A'}</div>
                                </div>
                            </div>

                            <div class="schedule-center-info" style="color: ${cTextColor};">
                                <div class="font-extrabold text-3xl italic tracking-wider text-red-500 outline-text" style="color: ${cTextColor};">VS</div>
                                <div class="text-xl font-black mt-1">${s.time}</div>
                                <div class="text-sm font-medium text-gray-400">${formatDate(s.date)}</div>
                                <div class="mt-1">${status}</div>
                            </div>

                            <div class="schedule-team-container team-b" style="color: ${cTextColor};">
                                <img src="${tB?.logo || ''}" class="schedule-team-logo" style="border-color: ${tB?.color || themeColor};" alt="${tB?.name || 'Team B'} Logo">
                                <div class="text-left">
                                    <div class="font-bold text-lg uppercase">${tB?.name || 'N/A'}</div>
                                    <div class="text-xs text-gray-400 hidden sm:block">${groupDisplay}</div>
                                </div>
                                <div class="block sm:hidden text-center mt-2">
                                    <div class="font-bold text-sm uppercase">${tB?.name || 'N/A'}</div>
                                </div>
                            </div>
                            
                            <div class="schedule-actions">
                                <button onclick="delSched(${s.id})" class="text-red-400 hover:text-red-300 px-2 py-1"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="schedule-group-header" style="background-color: ${cPillColor};">${key}</div>
                    ${matchesHtml}
                `;
            }).join('');

            cont.innerHTML = html || '<p class="text-center text-gray-500 py-10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
        }
        
        // ** NEW: Dummy function for editSched to prevent error **
        function editSched(id) {
            alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏°‡∏ó‡∏ä‡πå‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ' + id);
            // Implement logic to open modal and prefill data later
        }

        function delSched(id) {
            if (confirm('‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏ô‡∏µ‡πâ?')) {
                schedules = schedules.filter(s => s.id != id);
                save();
            }
        }

        // --- 3. DAILY SUMMARY / ALL STATS (UPDATED) ---

        // NEW: Toggle between Daily Summary and All Stats view
        function toggleDailyView(mode) {
            const dailyContent = document.getElementById('daily-content');
            const allStatsContent = document.getElementById('all-stats-content');
            const dailyControls = document.getElementById('daily-controls');
            const allStatsControls = document.getElementById('all-stats-controls');

            if (mode === 'daily') {
                dailyContent.classList.remove('hidden');
                allStatsContent.classList.add('hidden');
                dailyControls.classList.remove('hidden');
                allStatsControls.classList.add('hidden');
                renderDaily();
            } else {
                dailyContent.classList.add('hidden');
                allStatsContent.classList.remove('hidden');
                dailyControls.classList.add('hidden');
                allStatsControls.classList.remove('hidden');
                renderAllStats();
            }
        }
        
        // Call the new function based on dropdown change
        document.getElementById('daily-view-mode').onchange = (e) => toggleDailyView(e.target.value);


        // 1. UPDATED: calculateTopScorer - Simplified to only focus on goals, and removed assist logic
        function calculateTopScorer(sortKey, limit = 5) {
            const playerStatsData = players.map(p => ({
                playerId: p.id,
                name: p.name,
                number: p.no,
                img: p.img,
                teamId: p.teamId,
                ...getPlayerCardStats(p.id)
            }));
            
            let sortedData = [];

            if (sortKey === 'goals') {
                sortedData = playerStatsData.sort((a, b) => b.goals - a.goals || a.name.localeCompare(b.name)).filter(p => p.goals > 0);
            } else if (sortKey === 'name') {
                sortedData = playerStatsData.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortKey === 'number') {
                sortedData = playerStatsData.sort((a, b) => parseInt(a.number) - parseInt(b.number) || a.name.localeCompare(b.name));
            } else {
                 // Default for unexpected sortKey
                 sortedData = playerStatsData.sort((a, b) => b.goals - a.goals || a.name.localeCompare(b.name)).filter(p => p.goals > 0);
            }

            return { sortedData: sortedData.slice(0, limit) };
        }

        function renderDaily() {
            const date = document.getElementById('daily-date').value;
            const sortKey = document.getElementById('daily-scorer-sort').value; 
            const cTeamName = document.getElementById('daily-team-name-color').value; 
            const cBg1 = document.getElementById('daily-row-bg-1').value;
            const cBg2 = document.getElementById('daily-row-bg-2').value;
            
            // 4. UPDATED: Score text color 
            const cScoreGrad1 = document.getElementById('daily-score-grad-1').value;
            const cScoreGrad2 = document.getElementById('daily-score-grad-2').value;
            const cScoreText = document.getElementById('daily-score-text-color')?.value || '#000000'; // NEW: Score number color
            
            const cGrad1 = document.getElementById('daily-banner-grad-1').value;
            const cGrad2 = document.getElementById('daily-banner-grad-2').value;
            const cText = document.getElementById('daily-banner-text').value;
            const cBorder = document.getElementById('daily-banner-border').value;

            // 1. Banner Styles 
            const headerEl = document.getElementById('daily-header');
            headerEl.style.background = `linear-gradient(to right, ${cGrad1}, ${cGrad2})`;
            headerEl.style.borderColor = cBorder;
            document.getElementById('daily-title-edit').style.color = cText;
            document.getElementById('daily-logo-img').style.borderColor = cBorder;
            document.getElementById('daily-title-edit').innerText = `‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ${formatDate(date)} ${themeName}`;


            // 2. Matches List 
            const list = matches.filter(m => m.date === date);
            const cont = document.getElementById('daily-matches-container');
            cont.innerHTML = list.map((m, i) => {
                const t1 = teams.find(x => x.id == m.teamA);
                const t2 = teams.find(x => x.id == m.teamB);
                const styleBg = i % 2 === 0 ? cBg1 : cBg2;
                
                // 4. UPDATED: Apply Score Text Color to score numbers - No text shadow
                const scoreStyle = `background: linear-gradient(135deg, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText}; font-weight: 900;`;
                const scoreABox = `
                    <div class="daily-score-box w-[20%]">
                        <span class="daily-score-number" style="${scoreStyle}">${m.scoreA}</span>
                        <span class="daily-vs">VS</span> 
                        <span class="daily-score-number" style="${scoreStyle}">${m.scoreB}</span>
                    </div>`;

                return `
                <div style="background-color: ${styleBg};" class="rounded-lg p-3 flex items-center shadow-lg h-20 relative overflow-hidden border border-yellow-400/50">
                    <div class="flex items-center w-[40%] pl-2 gap-3">
                        <img src="${t1?.logo||''}" class="w-14 h-14 logo-circle bg-white border border-yellow-400 p-0.5">
                        <span class="font-bold text-sm leading-tight" style="color: ${cTeamName}">${t1?.name}</span>
                    </div>
                    ${scoreABox}
                    <div class="flex items-center w-[40%] justify-end pr-2 gap-3">
                        <span class="font-bold text-sm leading-tight text-right" style="color: ${cTeamName}">${t2?.name}</span>
                        <img src="${t2?.logo||''}" class="w-14 h-14 logo-circle bg-white p-0.5 border-2 border-yellow-400">
                    </div>
                </div>`;
            }).join('');

            // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Top Scorers (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà: ‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö, ‡πÉ‡∏ä‡πâ Gradient ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà) ---
            
            // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏à‡∏≤‡∏Å Input ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ (‡πÉ‡∏ä‡πâ Grad ‡πÅ‡∏ó‡∏ô bg/border)
            const cCardGrad1 = document.getElementById('d-card-grad-1').value; 
            const cCardGrad2 = document.getElementById('d-card-grad-2').value; 
            const cCardText = document.getElementById('d-card-text').value; // ‡∏™‡∏µ‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
            const cBannerGrad1 = document.getElementById('daily-banner-grad-1').value;
            const cBannerGrad2 = document.getElementById('daily-banner-grad-2').value;
            const cBannerText = document.getElementById('daily-banner-text').value;

            // ‡∏õ‡∏£‡∏±‡∏ö Header ‡∏Ç‡∏≠‡∏á‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
            const scorerHeader = document.querySelector('#daily-content > div:nth-child(2) > div.bg-gray-800');
            if (scorerHeader) {
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß (‡πÅ‡∏ñ‡∏ö‡πÉ‡∏´‡∏ç‡πà)
                scorerHeader.style.background = `linear-gradient(to right, ${cBannerGrad1}, ${cBannerGrad2})`;
                // ‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á/‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏≠‡∏≠‡∏Å
                scorerHeader.style.border = 'none'; 
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á Header ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ
                const h3 = scorerHeader.querySelector('h3');
                if (h3) {
                     h3.style.color = cBannerText;
                     // ‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
                     h3.style.borderBottom = 'none'; 
                }
            }


            const topScorerData = calculateTopScorer(sortKey, 5); 
            
            const headerText = {
                'goals': '‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß)',
                'name': '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤',
                'number': '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠'
            };
            document.getElementById('daily-scorer-header').innerText = headerText[sortKey] || '‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î';

            const topScorersCont = document.getElementById('daily-top-scorers');
            
            topScorersCont.innerHTML = topScorerData.sortedData.map((data, i) => {
                const t = teams.find(x => x.id == data.teamId);
                
                // --- Logic ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (‡∏ó‡∏≠‡∏á/‡πÄ‡∏á‡∏¥‡∏ô/‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á) ---
                let rankBgColor;
                let rankTextColor = 'black'; 
                
                if (i === 0) rankBgColor = '#FFD700';      // ‡∏ó‡∏µ‡πà 1: ‡∏™‡∏µ‡∏ó‡∏≠‡∏á ü•á
                else if (i === 1) rankBgColor = '#C0C0C0'; // ‡∏ó‡∏µ‡πà 2: ‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô ü•à
                else if (i === 2) rankBgColor = '#CD7F32'; // ‡∏ó‡∏µ‡πà 3: ‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á ü•â
                else {
                    rankBgColor = themeColor; 
                    rankTextColor = 'black';
                }

                const rankText = i + 1; 
                
                // ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏Å‡∏≠‡∏£‡πå (Gradient - ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å Input)
                const scoreStyle = `background-image: linear-gradient(to right, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;
                
                // ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πå‡∏î (‡πÉ‡∏ä‡πâ Gradient ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠)
                const cardCustomStyle = `background-image: linear-gradient(135deg, ${cCardGrad1}, ${cCardGrad2}); border: none;`;

                return `
                <div class="scorer-card" style="${cardCustomStyle}">
                    <div class="scorer-rank-tag" style="background-color: ${rankBgColor}; color: ${rankTextColor};">
                        ${rankText}
                    </div>
                    
                    <img src="${data.img || ''}" class="scorer-card-img" alt="${data.name}"> 
                    
                    <div class="mt-2 w-full">
                        <div class="font-bold text-sm truncate" style="color: ${cCardText};">${data.name} (#${data.number||'-'})</div>
                        <div class="text-xs truncate mb-2 opacity-80" style="color: ${cCardText};">${t?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                        
                        <div class="font-black text-2xl leading-tight inline-block px-3 py-1 rounded shadow-md" style="${scoreStyle}">
                             ${data.goals}
                             <span class="text-xs font-normal">‡∏õ‡∏£‡∏∞‡∏ï‡∏π</span>
                        </div>
                    </div>
                </div>`;
            }).join('') || '<p class="text-center text-gray-500 py-4 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</p>';

            // 4. Scorers Today (Horizontal Grid)
            const todays = stats.filter(s => s.type === 'goal' && s.date === date);
            const todayCounts = {};
            todays.forEach(s => todayCounts[s.playerId] = (todayCounts[s.playerId]||0)+s.count);
            
            const todayScorersCont = document.getElementById('daily-today-scorers');
            
            // Get player details for today's scorers
            const todayScorerData = Object.entries(todayCounts).map(([pid, c]) => {
                const p = players.find(x => x.id == pid);
                const t = teams.find(x => x.id == p?.teamId);
                return {
                    name: p?.name,
                    number: p?.no,
                    img: p?.img,
                    teamName: t?.name,
                    teamColor: t?.color,
                    goalsToday: c
                };
            }).sort((a,b) => b.goalsToday - a.goalsToday); // Sort by goals today

            todayScorersCont.innerHTML = todayScorerData.map((data) => {
                // NEW: Score Gradient Style
                const scoreStyle = `background-image: linear-gradient(to right, ${cScoreGrad1}, ${cScoreGrad2}); color: ${cScoreText};`;
                
                return `
                <div class="scorer-card border-gray-700">
                    <img src="${data.img || ''}" class="scorer-card-img" style="border-color: ${data.teamColor || 'white'};" alt="${data.name}">
                    <div class="player-num-tag" style="background-color: ${data.teamColor || themeColor};">${data.number || '-'}</div>
                    <div class="mt-2 w-full">
                        <div class="text-white font-bold text-sm truncate">${data.name}</div>
                        <div class="text-gray-400 text-xs truncate mb-2">${data.teamName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                        <div class="font-black text-xl leading-tight inline-block px-3 py-1 rounded shadow-md" style="${scoreStyle}">
                            ${data.goalsToday}
                            <span class="text-xs font-normal">‡∏õ‡∏£‡∏∞‡∏ï‡∏π</span>
                        </div>
                    </div>
                </div>`;
            }).join('') || '<p class="text-center text-gray-500 py-4 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
        }

        // --- NEW: All Stats Filtering Function ---
        function renderAllStats() {
            const filterType = document.getElementById('stat-filter-type').value; 
            const body = document.getElementById('all-stats-body');
            const header = document.getElementById('all-stats-header');
            
            const statMap = {
                'goal': { label: '‡∏õ‡∏£‡∏∞‡∏ï‡∏π', icon: '‚öΩ', color: 'text-red-400', key: 'goals' },
                'yellow': { label: '‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', icon: 'üü®', color: 'text-yellow-400', key: 'yellows' },
                'red': { label: '‡πÉ‡∏ö‡πÅ‡∏î‡∏á', icon: 'üü•', color: 'text-red-600', key: 'reds' },
                'save': { label: '‡πÄ‡∏ã‡∏ü', icon: 'üß§', color: 'text-blue-400', key: 'saves' },
            };
            const currentStat = statMap[filterType];

            header.innerHTML = `${currentStat.icon} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô${currentStat.label} (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)`;

            const allPlayerStats = players.map(p => {
                const statsData = getPlayerCardStats(p.id);
                const team = teams.find(t => t.id == p.teamId);
                return {
                    id: p.id,
                    name: p.name,
                    teamName: team?.name || 'N/A',
                    teamColor: team?.color || '#ffffff',
                    count: statsData[currentStat.key],
                };
            });

            // Filter out players with 0 count (unless it's saves, where 0 is still relevant)
            const filteredAndSorted = allPlayerStats
                .filter(p => p.count > 0 || filterType === 'save')
                .sort((a, b) => {
                    // Sort by count (desc) then name (asc)
                    if (b.count !== a.count) return b.count - a.count;
                    return a.name.localeCompare(b.name);
                });

            body.innerHTML = filteredAndSorted.map((p, i) => `
                <tr class="all-stats-row border-b border-gray-800">
                    <td class="p-2 text-center text-gray-400">${i + 1}</td>
                    <td class="p-2 font-bold text-white">${p.name}</td>
                    <td class="p-2 text-center text-xs" style="color: ${p.teamColor};">${p.teamName}</td>
                    <td class="p-2 text-center font-black text-lg ${currentStat.color}">${p.count}</td>
                </tr>
            `).join('') || `<tr><td colspan="4" class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ${currentStat.label} ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td></tr>`;
        }

        // --- 4. STATS & HISTORY ---

        // 1. UPDATED: handleStatSubmit - Removed assist logic/validation
        function handleStatSubmit(e) {
            e.preventDefault();
            const type = document.getElementById('s-type').value;
            const id = document.getElementById('edit-stat-id').value;
            
            const scorerId = document.getElementById('s-player').value;

            const obj = {
                id: id || Date.now(),
                date: document.getElementById('s-date').value,
                type: type,
                teamId: document.getElementById('s-team').value,
                playerId: scorerId,
                // Removed: assistId
                count: parseInt(document.getElementById('s-count').value),
                note: document.getElementById('s-note').value
            };

            if(id) {
                const idx = stats.findIndex(s => s.id == id);
                stats[idx] = obj;
                resetStatForm();
            } else {
                stats.push(obj);
            }
            save(); 
        }
        
        // 1. UPDATED: updateStatPlayers - Removed call to toggleAssistDropdown
        function updateStatPlayers() {
            const tid = document.getElementById('s-team').value;
            const ps = players.filter(p => p.teamId == tid);
            document.getElementById('s-player').innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞ (‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥)</option>' + ps.map(p => `<option value="${p.id}">${p.no} ${p.name}</option>`).join('');
        }
        
        // --- 5. TEAMS & PLAYERS ---
        
        function handleTeamSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('team-edit-id').value;
            const logoFile = document.getElementById('team-logo').files[0];
            
            const obj = {
                id: id || 't-' + Date.now(),
                name: document.getElementById('team-name').value,
                color: document.getElementById('team-color').value,
                tel: document.getElementById('team-tel').value,
                logo: ''
            };

            const saveTeam = async (logoBase64) => {
                obj.logo = logoBase64 || (id ? teams.find(t => t.id == id)?.logo : ''); // Preserve old logo if no new file and editing
                if(id) {
                    const idx = teams.findIndex(t => t.id == id);
                    teams[idx] = obj;
                    resetTeamForm();
                } else {
                    teams.push(obj);
                }
                save(); 
            };

            if (logoFile) {
                compressImage(logoFile).then(saveTeam);
            } else {
                saveTeam(null);
            }
        }
        
        function renderTeams() {
            const grid = document.getElementById('team-grid');
            grid.innerHTML = teams.map(t => {
                const manager = players.find(p => p.teamId === t.id && p.manager);
                return `
                <div class="glass p-4 rounded-xl shadow-lg border-l-4" style="border-color: ${t.color};">
                    <div class="flex items-center gap-3 mb-3">
                        <img src="${t.logo || ''}" class="w-12 h-12 logo-circle bg-white p-1 border" style="border-color: ${t.color};">
                        <div>
                            <div class="text-lg font-bold uppercase" style="color: ${t.color};">${t.name}</div>
                            <div class="text-sm text-gray-400">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${players.filter(p => p.teamId == t.id).length} ‡∏Ñ‡∏ô</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-300">
                        ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: ${manager?.name || 'N/A'} <br>
                        ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${t.tel || 'N/A'}
                    </div>
                    <div class="flex gap-2 mt-3">
                        <button onclick="editTeam('${t.id}')" class="text-blue-400 hover:text-blue-300 text-sm"><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="delTeam('${t.id}')" class="text-red-400 hover:text-red-300 text-sm"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
                    </div>
                </div>`;
            }).join('') || '<p class="text-center text-gray-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</p>';
        }

        // 1. UPDATED: renderStatHistory - Removed assist display
        function renderStatHistory() {
            const list = document.getElementById('history-stat-list');
            const iconMap = { goal:'‚öΩ', yellow:'üü®', red:'üü•', save:'üß§' }; // Removed assist
            
            list.innerHTML = stats.sort((a,b) => b.id - a.id).map(s => {
                const p = players.find(x => x.id == s.playerId);
                
                const titleText = `${p?.name}`; // Only player name
                
                return `
                <div class="bg-gray-800 p-2 rounded flex justify-between items-center text-sm border border-yellow-400/20 group">
                    <div class="flex items-center gap-2">
                        <span class="text-gray-500 text-xs">${formatDate(s.date)}</span>
                        <span>${iconMap[s.type]}</span>
                        <div>
                            <div class="font-bold">${titleText}</div>
                            <div class="text-xs text-gray-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${s.count} | ${s.note}</div>
                        </div>
                    </div>
                    <div class="opacity-0 group-hover:opacity-100 transition flex gap-2">
                        <button onclick="editStat(${s.id})" class="text-blue-400 hover:text-blue-300"><i class="fas fa-edit"></i></button>
                        <button onclick="delStat(${s.id})" class="text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            }).join('');
        }
        
        // 1. UPDATED: editStat - Removed assist prefill logic
        function editStat(id) {
            const s = stats.find(x => x.id == id);
            if (s) {
                document.getElementById('edit-stat-id').value = s.id;
                document.getElementById('s-date').value = s.date;
                document.getElementById('s-type').value = s.type;
                document.getElementById('s-team').value = s.teamId;
                updateStatPlayers();
                document.getElementById('s-player').value = s.playerId;
                document.getElementById('s-count').value = s.count;
                document.getElementById('s-note').value = s.note;

                document.getElementById('btn-stat-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
                document.getElementById('btn-stat-cancel').classList.remove('hidden');
            }
        }

        function resetStatForm() {
            document.getElementById('edit-stat-id').value = "";
            document.getElementById('s-note').value = "";
            document.getElementById('s-count').value = 1;
            document.getElementById('btn-stat-save').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            document.getElementById('btn-stat-cancel').classList.add('hidden');
            document.getElementById('s-team').value = '';
            document.getElementById('s-player').innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞ (‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥)</option>';
            document.getElementById('s-type').value = 'goal'; 
            // Removed: toggleAssistDropdown();
        }
        
        // 5. UPDATED: renderPlayers - Player Card Redesign + REMOVED EDIT BUTTON
        function renderPlayers(teamId = 'all') {
            currentTeamView = teamId;
            const grid = document.getElementById('player-grid');
            const banner = document.getElementById('player-team-banner');
            
            let filteredPlayers = players;
            let teamData = null;

            if (teamId !== 'all') {
                filteredPlayers = players.filter(p => p.teamId == teamId);
                teamData = teams.find(t => t.id == teamId);
                
                banner.classList.remove('hidden');
                document.getElementById('ptb-name').innerText = teamData?.name || 'TEAM NAME';
                document.getElementById('ptb-member-count').innerText = filteredPlayers.length;
                document.getElementById('ptb-logo').src = teamData?.logo || '';
                banner.style.borderColor = teamData?.color || themeColor;
                document.getElementById('ptb-color-picker').value = teamData?.color || themeColor;
            } else {
                banner.classList.add('hidden');
            }

            // Update tab styles
            document.querySelectorAll('.team-tab').forEach(btn => {
                const id = btn.getAttribute('onclick').match(/'(.*?)'/)[1];
                if (id === teamId) {
                    btn.style.backgroundColor = themeColor;
                    btn.style.color = 'black';
                } else {
                    btn.style.backgroundColor = '#4b5563';
                    btn.style.color = 'white';
                }
            });

            grid.innerHTML = filteredPlayers.map(p => {
                const t = teams.find(x => x.id == p.teamId);
                const pStats = getPlayerCardStats(p.id);
                
                return `
                <div class="player-card rounded-xl overflow-hidden shadow-lg relative">
                    <button onclick="openPlayerModal(${p.id})" class="player-photo-container block w-full relative"> 
                        <img src="${p.img || ''}" alt="${p.name}" class="player-photo">
                        <div class="player-num-tag" style="background-color: ${t?.color || themeColor};">${p.no || '-'}</div>
                        </button>
                    <div class="p-3">
                        <div class="font-bold text-sm truncate" style="color: ${t?.color || 'white'}">${p.name}</div>
                        <div class="text-xs text-gray-400 truncate">${t?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                        
                        <div class="mt-2 flex justify-between text-xs font-semibold">
                            <span class="text-red-400"><i class="fas fa-futbol"></i> ${pStats.goals}</span>
                            <span class="text-yellow-400"><i class="fas fa-grip-lines"></i> ${pStats.yellows}</span>
                        </div>

                        <div class="absolute top-2 right-2 opacity-100 transition flex gap-1"> 
                            <button onclick="openPlayerModal(${p.id})" class="text-blue-400 bg-black/50 rounded-full w-6 h-6 text-sm hover:text-blue-300"><i class="fas fa-edit"></i></button>
                            <button onclick="delPlayer(${p.id})" class="text-red-400 bg-black/50 rounded-full w-6 h-6 text-sm hover:text-red-300"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>`;
            }).join('') || '<p class="text-center text-gray-400 py-10 col-span-full">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞</p>';
        }
        
        function handlePlayerSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('p-id').value;
            const imgFile = document.getElementById('p-img').files[0];

            const obj = {
                id: id ? parseInt(id) : Date.now(),
                name: document.getElementById('p-name').value,
                no: document.getElementById('p-no').value,
                teamId: document.getElementById('p-team').value,
                manager: document.getElementById('p-manager').checked,
                img: ''
            };

            const savePlayer = async (imgBase64) => {
                obj.img = imgBase64 || (id ? players.find(p => p.id == parseInt(id))?.img : '');
                
                if (id) {
                    const idx = players.findIndex(p => p.id == parseInt(id));
                    players[idx] = obj;
                } else {
                    players.push(obj);
                }
                save(); 
                closePlayerModal();
            };

            if (imgFile) {
                compressImage(imgFile).then(savePlayer);
            } else {
                savePlayer(null);
            }
        }

        function openPlayerModal(playerId = null) {
            updateDropdowns(); // Ensure team dropdown is fresh
            const modal = document.getElementById('player-modal');
            const form = modal.querySelector('form');
            form.reset();
            document.getElementById('p-id').value = '';
            document.getElementById('player-modal-title').innerText = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞';
            document.getElementById('btn-player-save').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

            if (playerId) {
                const p = players.find(x => x.id == playerId);
                if (p) {
                    document.getElementById('p-id').value = p.id;
                    document.getElementById('p-name').value = p.name;
                    document.getElementById('p-no').value = p.no;
                    document.getElementById('p-team').value = p.teamId;
                    document.getElementById('p-manager').checked = p.manager;
                    document.getElementById('player-modal-title').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞';
                    document.getElementById('btn-player-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
                }
            }
            modal.classList.remove('hidden');
        }

        function closePlayerModal() {
            document.getElementById('player-modal').classList.add('hidden');
        }

        function handleMatchSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('match-edit-id').value;
            const scheduleId = document.getElementById('match-edit-id').dataset.scheduleId;
            const obj = {
                id: id || Date.now(),
                date: document.getElementById('match-date').value,
                teamA: document.getElementById('m-team-a').value,
                teamB: document.getElementById('m-team-b').value,
                scoreA: document.getElementById('m-score-a').value,
                scoreB: document.getElementById('m-score-b').value,
                scheduleId: scheduleId || null
            };
            if(id) {
                const idx = matches.findIndex(m => m.id == id);
                matches[idx] = obj;
                resetMatchForm();
            } else {
                matches.push(obj);
            }
            save(); 
            document.getElementById('m-schedule-id').value = ""; 
        }

        function editPlayer(id) {
            const p = players.find(x => x.id == id);
            if (p) {
                openPlayerModal(p.id);
                document.getElementById('p-id').value = p.id;
                document.getElementById('p-name').value = p.name;
                document.getElementById('p-no').value = p.no;
                document.getElementById('p-team').value = p.teamId;
                document.getElementById('p-manager').checked = p.manager;
                document.getElementById('btn-player-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
            }
        }
        
        function updateScheduleMatchDropdown() {
            const dropdown = document.getElementById('m-schedule-id');
            const recordedMatchIds = matches.map(m => m.scheduleId);
            const pendingSchedules = schedules.filter(s => !recordedMatchIds.includes(s.id.toString()));
            
            dropdown.innerHTML = '<option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---</option>' + pendingSchedules.map(s => {
                const teamA = teams.find(t => t.id == s.teamA);
                const teamB = teams.find(t => t.id == s.teamB);
                return `<option value="${s.id}" data-team-a="${s.teamA}" data-team-b="${s.teamB}" data-date="${s.date}">[${formatDate(s.date)}] ${teamA?.name || '‡∏ó‡∏µ‡∏° A'} vs ${teamB?.name || '‡∏ó‡∏µ‡∏° B'}</option>`;
            }).join('');
        }
        
        function delTeam(id) {
            if(confirm('‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ? ‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á!')) {
                teams = teams.filter(t => t.id != id);
                players = players.filter(p => p.teamId != id);
                matches = matches.filter(m => m.teamA != id && m.teamB != id);
                stats = stats.filter(s => s.teamId != id);
                schedules = schedules.filter(s => s.teamA != id && s.teamB != id);
                save();
            }
        }
        
        function editTeam(id) {
            const t = teams.find(x => x.id == id);
            if (t) {
                document.getElementById('team-edit-id').value = t.id;
                document.getElementById('team-name').value = t.name;
                document.getElementById('team-color').value = t.color;
                document.getElementById('team-tel').value = t.tel;
                document.getElementById('btn-team-save').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
                document.getElementById('btn-team-cancel').classList.remove('hidden');
            }
        }

        function resetTeamForm() {
            document.getElementById('team-edit-id').value = "";
            document.getElementById('team-name').value = "";
            document.getElementById('team-color').value = "#000000";
            document.getElementById('team-tel').value = "";
            document.getElementById('team-logo').value = "";
            document.getElementById('btn-team-save').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            document.getElementById('btn-team-cancel').classList.add('hidden');
        }

        function delPlayer(id) {
            if(confirm('‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡∏ô‡∏µ‡πâ? ‡∏à‡∏∞‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á!')) {
                players = players.filter(p => p.id != id);
                stats = stats.filter(s => s.playerId != id); // Removed assistId filter
                save(); 
            }
        }

        function showHistory(type, button) {
            document.getElementById('history-match-list').classList.add('hidden');
            document.getElementById('history-stat-list').classList.add('hidden');
            document.querySelectorAll('.hist-tab').forEach(b => {
                b.style.color = '#9ca3af'; // gray-400
                b.style.borderColor = 'transparent';
            });

            if (type === 'match') {
                document.getElementById('history-match-list').classList.remove('hidden');
            } else {
                document.getElementById('history-stat-list').classList.remove('hidden');
            }

            button.style.color = themeColor;
            button.style.borderColor = themeColor;

            if(type === 'match') renderMatchHistory();
            if(type === 'stat') renderStatHistory();
        }

        function renderMatchHistory() {
            const list = document.getElementById('history-match-list');
            list.innerHTML = matches.sort((a,b) => b.id - a.id).map(m => {
                const t1 = teams.find(x => x.id == m.teamA);
                const t2 = teams.find(x => x.id == m.teamB);
                
                return `
                <div class="bg-gray-800 p-2 rounded flex justify-between items-center text-sm border border-yellow-400/20 group">
                    <div class="flex items-center gap-2">
                        <span class="text-gray-500 text-xs">${formatDate(m.date)}</span>
                        <div class="font-bold">${t1?.name} ${m.scoreA} - ${m.scoreB} ${t2?.name}</div>
                    </div>
                    <div class="opacity-0 group-hover:opacity-100 transition flex gap-2">
                        <button onclick="editMatch(${m.id})" class="text-blue-400 hover:text-blue-300"><i class="fas fa-edit"></i></button>
                        <button onclick="delMatch(${m.id})" class="text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            }).join('');
        }
        
        function delMatch(id) { 
            if(confirm('‡∏•‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ô‡∏µ‡πâ?')) { 
                matches = matches.filter(m => m.id != id); 
                save();
            }
        }
        
        function delStat(id) {
            if(confirm('‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ô‡∏µ‡πâ?')) {
                stats = stats.filter(s => s.id != id);
                save();
            }
        }
        
        function renderTeamsTabs(selectedId = 'all') {
            const tabsContainer = document.getElementById('player-team-tabs');
            
            // Render All tab first
            let html = `<button onclick="renderPlayers('all', this)" class="team-tab ${selectedId === 'all' ? 'active' : ''} text-black px-4 py-1 rounded-full text-sm font-bold transition hover:bg-yellow-600" style="background-color: ${selectedId === 'all' ? themeColor : '#4b5563'}; color: ${selectedId === 'all' ? 'black' : 'white'};">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`;

            html += teams.map(t => `
                <button onclick="renderPlayers('${t.id}', this)" class="team-tab ${selectedId == t.id ? 'active' : ''} text-black px-4 py-1 rounded-full text-sm font-bold transition hover:opacity-80" style="background-color: ${selectedId == t.id ? themeColor : '#4b5563'}; color: ${selectedId == t.id ? 'black' : 'white'};">
                    ${t.name}
                </button>
            `).join('');

            tabsContainer.innerHTML = html;
        }

        function adjStat(val) {
            const input = document.getElementById('s-count');
            let current = parseInt(input.value);
            current += val;
            if (current < 1) current = 1;
            input.value = current;
        }

        function editMatch(id) {
            const m = matches.find(x => x.id == id);
            if (m) {
                document.getElementById('match-edit-id').value = m.id;
                document.getElementById('match-edit-id').dataset.scheduleId = m.scheduleId || '';
                document.getElementById('match-date').value = m.date;
                document.getElementById('m-team-a').value = m.teamA;
                document.getElementById('m-team-b').value = m.teamB;
                document.getElementById('m-score-a').value = m.scoreA;
                document.getElementById('m-score-b').value = m.scoreB;
                document.getElementById('btn-match-save').innerHTML = '<i class="fas fa-save"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
            }
        }
        
        function resetMatchForm() {
            document.getElementById('match-edit-id').value = "";
            document.getElementById('match-edit-id').dataset.scheduleId = "";
            document.getElementById('m-team-a').value = "";
            document.getElementById('m-team-b').value = "";
            document.getElementById('m-score-a').value = 0;
            document.getElementById('m-score-b').value = 0;
            document.getElementById('btn-match-save').innerHTML = '<i class="fas fa-save"></i>';
            document.getElementById('match-date').value = new Date().toISOString().split('T')[0];
        }

        function prefillMatchFromSchedule() {
            const dropdown = document.getElementById('m-schedule-id');
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            
            if (selectedOption.value) {
                document.getElementById('match-edit-id').value = '';
                document.getElementById('match-edit-id').dataset.scheduleId = selectedOption.value; // Store schedule ID
                document.getElementById('match-date').value = selectedOption.dataset.date;
                document.getElementById('m-team-a').value = selectedOption.dataset.teamA;
                document.getElementById('m-team-b').value = selectedOption.dataset.teamB;
                document.getElementById('m-score-a').value = 0;
                document.getElementById('m-score-b').value = 0;
                document.getElementById('btn-match-save').innerHTML = '<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            } else {
                resetMatchForm();
            }
        }
        
        // --- Settings/Theme Functions ---
        function toggleSettings() {
            // Load current values into the form when opening
            document.getElementById('theme-name-input').value = themeName;
            document.getElementById('theme-color-input').value = themeColor;
            document.getElementById('secondary-color-input').value = secondaryColor;
            
            document.getElementById('settings-modal').classList.toggle('hidden');
        }

        async function saveGlobalLogo() {
            const fileInput = document.getElementById('global-logo-upload');
            if (fileInput.files.length > 0) {
                globalLogo = await compressImage(fileInput.files[0]);
                save(); 
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!");
                document.getElementById('daily-logo-img').src = globalLogo;
            } else {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ");
            }
        }

        function exportData() {
            const data = {
                teams, players, matches, stats, schedules, globalLogo, themeName, themeColor, secondaryColor,
                exportDate: new Date().toISOString()
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `jakhong_league_data_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            if (!input.files.length) return;
            if (!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?")) {
                input.value = null;
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    teams = importedData.teams || [];
                    players = importedData.players || [];
                    matches = importedData.matches || [];
                    stats = importedData.stats || [];
                    schedules = importedData.schedules || [];
                    globalLogo = importedData.globalLogo || "";
                    themeName = importedData.themeName || 'JAKHONG SYSTEM';
                    themeColor = importedData.themeColor || '#facc15';
                    secondaryColor = importedData.secondaryData || '#1c365b';

                    save(); 
                    alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
                    document.getElementById('settings-modal').classList.add('hidden');
                    input.value = null;

                } catch (error) {
                    alert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå: ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢");
                    console.error("Import Error:", error);
                    input.value = null;
                }
            };
            reader.readAsText(file);
        }

    </script>
</body>
</html>
