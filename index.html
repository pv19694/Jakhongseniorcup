
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดบอลสนาม Jakhong Senior Cup (ปรับปรุง)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            background: #111827; /* เทาเข้มแบบเทคโนโลยี */
            color: white;
        }

        /* ---------- Navigation ---------- */
        .nav {
            display: flex;
            gap: 20px;
            padding: 16px 24px;
            background: #1E1E1E;
        }

        .nav-item {
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #B91C1C, #7F1D1D); /* แดงไวน์ */
            color: #FACC15; /* ทอง */
            box-shadow: 0 4px 15px rgba(185, 28, 28, 0.4);
        }

        /* ---------- Card Hover ---------- */
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        /* ---------- Gradient BG (ปรับเป็นแดงทอง) ---------- */
        .gradient-bg {
            background: linear-gradient(135deg, #B91C1C 0%, #7F1D1D 100%);
        }

        /* ---------- Glass Effect ---------- */
        .glass-effect {
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(14px);
            border: 1px solid rgba(250, 204, 21, 0.2); /* ขอบทองจางๆ */
            padding: 30px;
            margin: 30px auto;
            width: 80%;
            border-radius: 20px;
        }

        /* ---------- Alerts ---------- */
        .success-message, .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .success-message {
            background: #16A34A;
            color: white;
        }

        .error-message {
            background: #DC2626;
            color: white;
        }

        .success-message.show, .error-message.show {
            transform: translateX(0);
        }

        /* ---------- Record Type Card ---------- */
        .record-type-card {
            transition: all 0.3s ease;
        }

        .record-type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(185, 28, 28, 0.25); /* เงาแดง */
        }

        input[name="record-type"]:checked + .record-type-card {
            border-color: #FACC15; /* ขอบทอง */
            background: rgba(250, 204, 21, 0.1); /* ทองใส */
        }
        
        /* ---------------------------------------------------------------------- */
        /* START: Modifications based on user request */
        /* ---------------------------------------------------------------------- */

        /* 2. ตารางคะแนน: ตัวอักษรเป็นสีเดียวกัน ยกเว้นแต้ม */
        #leaderboard-table tbody td {
            color: #374151 !important; /* Enforce single dark grey color for all table text (W, D, L, GF, GA, GD, +/-) */
            font-weight: 500;
        }
        /* ยกเว้นแต้ม (Points): ให้มีสีโดดเด่น */
        #leaderboard-table tbody td:nth-last-child(2) { 
            color: #B91C1C !important; /* Red/Maroon for Points */
            font-weight: 700 !important;
        }
        /* คงสี W/D/L ในคอลัมน์ Form */
        #leaderboard-table .form-result-W { background-color: #10B981 !important; } /* Green */
        #leaderboard-table .form-result-D { background-color: #FACC15 !important; } /* Yellow */
        #leaderboard-table .form-result-L { background-color: #EF4444 !important; } /* Red */
        
        /* 4. หัวข้อ สรุปผล/ดาวซันโว: จัดการสีตัวเลขสกอร์ */
        /* ใช้ Tailwind class text-yellow-300 และ text-2xl ใน JS เพื่อเปลี่ยนสี */
        
        /* 5. การ์ดรายชื่อนักเตะ (Player Card) */
        .player-card {
            position: relative; /* สำหรับให้ badge และ action button วางตัวถูกตำแหน่ง */
            cursor: pointer; /* แสดงว่าสามารถคลิกได้ */
            overflow: hidden; /* ซ่อนปุ่ม action ที่ถูกซ่อนไว้ด้านล่าง */
            border-radius: 12px;
            transition: all 0.2s;
        }

        .player-card .player-photo-container {
            position: relative;
        }
        
        /* 5.1 ซ่อนเลขโทรศัพท์และชื่อที่ขึ้นบนรูป */
        /* ใน JS จะลบการแสดงผลทับรูปออกไปโดยตรง */

        /* 5.2 เลขเสื้อกลมๆ */
        .jersey-number-badge {
            position: absolute;
            top: 5px;
            right: 5px; /* ตำแหน่งมุมบนขวา */
            width: 35px;
            height: 35px;
            background-color: #B91C1C; /* สีแดงเข้ม */
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 10;
        }

        /* 5.3 เพิ่มปุ่ม Edit/Delete */
        .card-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: space-around;
            z-index: 20;
            transform: translateY(100%); /* ซ่อนไว้ด้านล่าง */
            transition: transform 0.2s ease-out;
        }

        .player-card.active .card-actions {
            transform: translateY(0); /* แสดงเมื่อมีคลาส active */
        }

        .card-actions button {
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }

        .card-actions .edit-btn {
            background-color: #FACC15; /* ทอง */
            color: #333;
        }

        .card-actions .delete-btn {
            background-color: #DC2626; /* แดง */
            color: white;
        }

        /* ---------------------------------------------------------------------- */
        /* END: Modifications based on user request */
        /* ---------------------------------------------------------------------- */
    </style>
</head>

<body class="bg-gradient-to-br from-red-50 via-white to-yellow-50 min-h-full">
    <header class="bg-gradient-to-r from-red-600 via-red-500 to-yellow-400 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-futbol text-2xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">ระบบจัดบอลสนาม Jakhong</h1>
                        <p class="text-yellow-100 text-sm">Football Management System</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm opacity-90" id="current-date"></div>
                    <div class="text-xs opacity-75" id="current-time"></div>
                </div>
            </div>
        </div>
    </header>

   <nav class="glass-effect shadow-lg sticky top-0 z-40"> 
        <div class="container mx-auto px-4"> 
            <div class="flex overflow-x-auto"> 
                <button class="nav-item active flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all" onclick="showSection('dashboard')"> <i class="fas fa-home"></i> 
                    <span>หน้าหลัก</span> </button> 
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('match-record')"> 
                    <i class="fas fa-edit"></i> <span>บันทึกผล</span> 
                </button> <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('player-records')"> 
                    <i class="fas fa-medal"></i> <span>บันทึกสถิติผู้เล่น</span> 
                </button> <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('leaderboard')"> 
                    <i class="fas fa-trophy"></i> <span>ตารางคะแนน</span> </button> 
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('team-management')"> 
                    <i class="fas fa-users"></i> <span>จัดการทีม</span> </button> 
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('player-list')"> 
                    <i class="fas fa-list"></i> <span>รายชื่อนักกีฬา</span> </button> 
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('next-matches')"> 
                    <i class="fas fa-calendar-plus"></i> <span>แมทช์ต่อไป</span> </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('daily-summary')">
                    <i class="fas fa-calendar-day"></i> <span>สรุปตามวันที่</span> </button> </div> </div> 
    </nav>


    <main class="container mx-auto px-4 py-8">
        <div id="dashboard" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm mb-1">ทีมทั้งหมด</p>
                            <p class="text-3xl font-bold" id="total-teams">0</p>
                            <p class="text-xs text-blue-200 mt-1">ทีมที่ลงทะเบียน</p>
                        </div>
                        <i class="fas fa-users text-3xl opacity-80"></i>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-green-500 to-green-700 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm mb-1">สมาชิกทั้งหมด</p>
                            <p class="text-3xl font-bold" id="total-players">0</p>
                            <p class="text-xs text-green-200 mt-1">นักกีฬาที่ลงทะเบียน</p>
                        </div>
                        <i class="fas fa-user-friends text-3xl opacity-80"></i>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm mb-1">แมทช์ทั้งหมด</p>
                            <p class="text-3xl font-bold" id="total-matches">0</p>
                            <p class="text-xs text-purple-200 mt-1">การแข่งขันที่จบแล้ว</p>
                        </div>
                        <i class="fas fa-futbol text-3xl opacity-80"></i>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-yellow-500 to-orange-600 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm mb-1">ผู้นำลีก</p>
                            <p class="text-lg font-bold" id="league-leader-name">-</p>
                            <p class="text-sm text-yellow-100" id="league-leader-points">0 คะแนน</p>
                        </div>
                        <i class="fas fa-crown text-3xl opacity-80"></i>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm mb-1">แมทช์สัปดาห์นี้</p>
                            <p class="text-2xl font-bold text-indigo-600" id="matches-this-week">0</p>
                        </div>
                        <i class="fas fa-calendar-week text-2xl text-indigo-500"></i>
                    </div>
                </div>

                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm mb-1">ทีมยอดนิยมเดือนนี้</p>
                            <p class="text-lg font-bold text-pink-600" id="top-team-month">-</p>
                        </div>
                        <i class="fas fa-fire text-2xl text-pink-500"></i>
                    </div>
                </div>

                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div id="goals-stats" class="flex justify-between">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-gray-600">ประตูรวม</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">เฉลี่ย/แมทช์</div>
                        </div>
                    </div>
                </div>

                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm mb-1">สถิติผู้เล่น</p>
                            <p class="text-2xl font-bold text-teal-600" id="total-player-records">0</p>
                            <p class="text-xs text-gray-500 mt-1">บันทึกทั้งหมด</p>
                        </div>
                        <i class="fas fa-chart-bar text-2xl text-teal-500"></i>
                    </div>
                </div>
            </div>

            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-user-tie mr-3 text-purple-500"></i>
                    ผู้จัดการทีม
                </h3>
                <div id="team-managers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </div>

            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-clock mr-3 text-blue-500"></i>
                    แมทช์ล่าสุด
                </h3>
                <div id="recent-matches-list" class="space-y-4">
                    </div>
            </div>
        </div>

        <div id="match-record" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-edit mr-3 text-blue-500"></i>
                    บันทึกผลการแข่งขัน
                </h2>
                <form class="space-y-6" onsubmit="handleMatchSubmit(event)">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">วันที่แข่งขัน *</label>
                        <input type="date" id="match-date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีมเจ้าบ้าน *</label>
                            <select id="team-a" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีมเยือน *</label>
                            <select id="team-b" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-6 border-2 border-blue-200">
                        <h3 class="font-bold text-lg mb-4 text-center text-blue-800">ผลการแข่งขัน</h3>
                        <div class="flex items-center justify-center space-x-8">
                            <div class="text-center">
                                <div class="mb-2 font-medium text-blue-700">ทีมเจ้าบ้าน</div>
                                <input type="number" id="score-a" min="0" max="99" class="w-20 h-16 text-center text-2xl font-bold border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-md" required>
                            </div>
                            <div class="text-3xl font-bold text-blue-600">VS</div>
                            <div class="text-center">
                                <div class="mb-2 font-medium text-blue-700">ทีมเยือน</div>
                                <input type="number" id="score-b" min="0" max="99" class="w-20 h-16 text-center text-2xl font-bold border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-md" required>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-800 text-white py-3 px-6 rounded-lg hover:from-blue-700 hover:to-blue-900 transition-all font-medium">
                            <i class="fas fa-save mr-2"></i>
                            บันทึกผลการแข่งขัน
                        </button>
                        <button type="button" onclick="clearMatchForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>

            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6">ประวัติการแข่งขัน</h3>
                <div class="space-y-4" id="match-history-list">
                    </div>
            </div>
        </div>

        <div id="leaderboard" class="section hidden">
    <div class="glass-effect rounded-xl shadow-2xl p-6 bg-white/30 backdrop-blur-md border border-yellow-400">
        <div class="mb-8">
            <div class="bg-gradient-to-r from-red-600 via-red-500 to-yellow-400 text-white px-8 py-6 rounded-xl text-center shadow-lg">
                <h2 class="text-3xl font-bold flex items-center justify-center mb-2">
                    <i class="fas fa-trophy mr-3 text-yellow-300 drop-shadow-lg"></i>
                    ตารางคะแนน JAKHONG LEAGUE
                </h2>
                <p class="text-yellow-100 text-sm">อัปเดตล่าสุด: <span id="leaderboard-update">--/--/----</span></p>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full border-collapse shadow-lg rounded-xl overflow-hidden" id="leaderboard-table">
                <thead>
                    <tr class="bg-gradient-to-r from-red-700 via-red-600 to-yellow-500 text-white text-center font-bold shadow-md">
                        <th class="px-4 py-3 rounded-tl-lg">อันดับ</th>
                        <th class="px-4 py-3 text-left">ทีม</th>
                        <th class="px-4 py-3">แข่ง</th>
                        <th class="px-4 py-3">ชนะ</th>
                        <th class="px-4 py-3">เสมอ</th>
                        <th class="px-4 py-3">แพ้</th>
                        <th class="px-4 py-3">ได้</th>
                        <th class="px-4 py-3">เสีย</th>
                        <th class="px-4 py-3">+/-</th>
                        <th class="px-4 py-3">คะแนน</th>
                        <th class="px-4 py-3 rounded-tr-lg">ฟอร์ม</th>
                    </tr>
                </thead>
                <tbody class="bg-white/20 font-medium">
                    </tbody>
            </table>
        </div>
    </div>
</div>

        <div id="team-management" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-users mr-3 text-blue-500"></i>
                    เพิ่มทีมใหม่
                </h2>
                
                <form class="space-y-6" onsubmit="handleTeamSubmit(event)">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อทีม *</label>
                        <input type="text" id="team-name" placeholder="กรอกชื่อทีม เช่น ทีมสิงห์, ทีมเสือ" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">โลโก้ทีม</label>
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="relative">
                                <input type="file" id="team-logo" accept="image/*" class="sr-only" onchange="handleLogoUpload(event)">
                                <label for="team-logo" class="cursor-pointer flex items-center justify-center w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors">
                                    <div id="logo-preview" class="w-full h-full rounded-lg bg-gray-100 flex items-center justify-center">
                                        <i class="fas fa-camera text-gray-400 text-xl"></i>
                                    </div>
                                </label>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-600 mb-1">อัพโหลดโลโก้ทีม (ไม่บังคับ)</p>
                                <p class="text-xs text-gray-500">รองรับไฟล์ JPG, PNG ขนาดไม่เกิน 2MB</p>
                                <button type="button" id="remove-logo" onclick="removeLogo()" class="text-red-600 text-xs mt-1 hidden">ลบโลโก้</button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">สีประจำทีม *</label>
                        <div class="grid grid-cols-8 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="red" class="sr-only" required>
                                <div class="w-12 h-12 rounded-full bg-red-500 border-4 border-transparent hover:border-red-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="blue" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-blue-500 border-4 border-transparent hover:border-blue-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="green" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-green-500 border-4 border-transparent hover:border-green-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="yellow" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-yellow-400 border-4 border-transparent hover:border-yellow-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="purple" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-purple-500 border-4 border-transparent hover:border-purple-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="orange" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-orange-500 border-4 border-transparent hover:border-orange-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="pink" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-pink-500 border-4 border-transparent hover:border-pink-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="indigo" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-indigo-500 border-4 border-transparent hover:border-indigo-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="teal" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-teal-500 border-4 border-transparent hover:border-teal-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="cyan" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-cyan-500 border-4 border-transparent hover:border-cyan-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="lime" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-lime-500 border-4 border-transparent hover:border-lime-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="rose" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-rose-500 border-4 border-transparent hover:border-rose-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="amber" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-amber-500 border-4 border-transparent hover:border-amber-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="emerald" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-emerald-500 border-4 border-transparent hover:border-emerald-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="violet" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-violet-500 border-4 border-transparent hover:border-violet-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="fuchsia" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-fuchsia-500 border-4 border-transparent hover:border-fuchsia-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="white" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-white border-4 border-gray-300 hover:border-gray-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="black" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-black border-4 border-transparent hover:border-gray-600 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="gray" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-gray-500 border-4 border-transparent hover:border-gray-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="slate" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-slate-600 border-4 border-transparent hover:border-slate-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="zinc" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-zinc-600 border-4 border-transparent hover:border-zinc-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="neutral" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-neutral-600 border-4 border-transparent hover:border-neutral-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="stone" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-stone-600 border-4 border-transparent hover:border-stone-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-800 text-white py-3 px-6 rounded-lg hover:from-blue-700 hover:to-blue-900 transition-all font-medium">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มทีม
                        </button>
                        <button type="button" onclick="clearTeamForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>

            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-list mr-3 text-green-500"></i>
                    รายชื่อทีมที่ลงทะเบียน
                </h3>
                <div id="teams-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </div>
        </div>

        <div id="player-list" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-list mr-3 text-green-500"></i>
                    จัดการรายชื่อนักกีฬา
                </h2>
                <div class="flex flex-wrap items-center justify-between space-y-4 md:space-y-0 md:space-x-4 mb-6">
                    <div>
                        <label for="filter-player-team" class="text-sm font-medium text-gray-700 mr-2">ทีม:</label>
                        <select id="filter-player-team" onchange="updatePlayersList()" class="border rounded-lg p-2 text-sm">
                            <option value="">ทั้งหมด</option>
                            </select>
                    </div>
                    <div>
                        <label for="sort-player" class="text-sm font-medium text-gray-700 mr-2">เรียงตาม:</label>
                        <select id="sort-player" onchange="updatePlayersList()" class="border rounded-lg p-2 text-sm">
                            <option value="jersey">เบอร์เสื้อ</option>
                            <option value="name">ชื่อ (ก-ฮ)</option>
                            <option value="date">วันที่เพิ่ม</option>
                        </select>
                    </div>
                </div>
                
                <div id="players-card-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    </div>
            </div>
            
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-user-plus mr-3 text-red-500"></i>
                    เพิ่มนักกีฬาใหม่
                </h3>
                <form class="space-y-6" onsubmit="handlePlayerSubmit(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อ-นามสกุล *</label>
                            <input type="text" id="player-name" placeholder="ชื่อนักกีฬา" 
                                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีม *</label>
                            <select id="player-team-id" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                <option value="">เลือกทีม</option>
                                </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์เสื้อ</label>
                            <input type="number" id="player-jersey" min="1" max="99" placeholder="เบอร์เสื้อ" 
                                class="w-full border border-gray-300 rounded-lg px-3 py-2 text-center focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                            <input type="tel" id="player-phone" pattern="[0-9]{10}" placeholder="08XXXXXXXX" 
                                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">วันเกิด</label>
                            <input type="date" id="player-birthdate" 
                                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div class="flex items-end">
                            <label class="flex items-center space-x-2 text-gray-700">
                                <input type="checkbox" id="is-manager" class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm">เป็นผู้จัดการทีม</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">รูปภาพนักกีฬา</label>
                        <input type="file" id="player-photo" accept="image/*" class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                        <button type="button" id="remove-player-photo" onclick="removePlayerPhoto()" class="text-red-600 text-xs mt-1 hidden">ลบรูปภาพ</button>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-red-600 to-red-800 text-white py-3 px-6 rounded-lg hover:from-red-700 hover:to-red-900 transition-all font-medium">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มนักกีฬา
                        </button>
                        <button type="button" onclick="clearPlayerForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="next-matches" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-calendar-alt mr-3 text-red-500"></i>
                    โปรแกรมแข่งขัน (แมทช์ต่อไป)
                </h2>
                <div id="upcoming-matches-list" class="space-y-4">
                    </div>
            </div>
        </div>
        
        <div id="daily-summary" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-calendar-day mr-3 text-orange-500"></i>
                    สรุปผลและสถิติรายวัน
                </h2>

                <div class="mb-8 p-4 bg-white/10 rounded-xl shadow-inner">
                    <label for="daily-summary-date" class="block text-sm font-medium text-white mb-2">เลือกวันที่ที่ต้องการสรุป:</label>
                    <input type="date" id="daily-summary-date" onchange="loadDailySummary()" 
                           class="w-full md:w-1/2 border border-gray-300 rounded-lg px-3 py-2 text-xs md:text-sm text-yellow-100 focus:outline-none focus:ring-2 focus:ring-yellow-300" />
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-red-600 via-red-500 to-yellow-400 text-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100 text-sm mb-1">แมทช์ในวันนี้</p>
                                <p class="text-3xl font-bold" id="daily-matches">0</p>
                            </div>
                            <i class="fas fa-futbol text-3xl opacity-90 drop-shadow-lg"></i>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-yellow-500 via-yellow-400 to-red-500 text-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100 text-sm mb-1">ประตูรวม</p>
                                <p class="text-3xl font-bold" id="daily-goals">0</p>
                            </div>
                            <i class="fas fa-bullseye text-3xl opacity-90 drop-shadow-lg"></i>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-red-700 via-red-600 to-yellow-500 text-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100 text-sm mb-1">ทีมที่เล่น</p>
                                <p class="text-3xl font-bold" id="daily-teams">0</p>
                            </div>
                            <i class="fas fa-users text-3xl opacity-90 drop-shadow-lg"></i>
                        </div>
                    </div>
                </div>

                <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <h3 class="text-xl md:text-2xl font-extrabold text-yellow-300 mb-4 flex items-center gap-2">
                            <i class="fas fa-clipboard-list text-yellow-300"></i> สรุปผลการแข่งขัน
                        </h3>
                        <div id="daily-match-results" class="space-y-4">
                            </div>
                    </div>
                    <div>
                        <h3 class="text-xl md:text-2xl font-extrabold text-yellow-300 mb-4 flex items-center gap-2">
                            <i class="fas fa-star text-yellow-300"></i> ดาวซัลโววันนี้
                        </h3>
                        <div id="daily-top-scorers" class="space-y-3">
                            </div>
                    </div>
                </section>
                
                <hr class="my-8 border-gray-700">

                <div>
                    <h3 class="text-xl md:text-2xl font-extrabold text-yellow-300 mb-4 flex items-center gap-2">
                        <i class="fas fa-medal text-yellow-300"></i> สถิติผู้เล่นวันนี้
                    </h3>
                    <div id="daily-player-records" class="space-y-6">
                        </div>
                </div>

            </div>
        </div>

        <div id="player-records" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-medal mr-3 text-red-500"></i>
                    บันทึกสถิติผู้เล่น
                </h2>
                <form class="space-y-6" onsubmit="handleRecordSubmit(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">วันที่/เวลา เหตุการณ์ *</label>
                            <input type="datetime-local" id="record-datetime" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">นักกีฬา *</label>
                            <select id="record-player-id" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                <option value="">เลือกนักกีฬา</option>
                                </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">ประเภทสถิติ *</label>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="goal" class="sr-only" required>
                                <div class="record-type-card bg-red-500 text-white rounded-lg p-4 text-center border-2 border-transparent">
                                    <i class="fas fa-futbol text-2xl mb-1"></i>
                                    <p class="font-semibold text-sm">ประตู</p>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="save" class="sr-only">
                                <div class="record-type-card bg-blue-500 text-white rounded-lg p-4 text-center border-2 border-transparent">
                                    <i class="fas fa-hands text-2xl mb-1"></i>
                                    <p class="font-semibold text-sm">เซฟ</p>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="yellow" class="sr-only">
                                <div class="record-type-card bg-yellow-400 text-black rounded-lg p-4 text-center border-2 border-transparent">
                                    <i class="fas fa-clipboard-list text-2xl mb-1"></i>
                                    <p class="font-semibold text-sm">ใบเหลือง</p>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="red" class="sr-only">
                                <div class="record-type-card bg-black text-white rounded-lg p-4 text-center border-2 border-transparent">
                                    <i class="fas fa-clipboard-list text-2xl mb-1"></i>
                                    <p class="font-semibold text-sm">ใบแดง</p>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">จำนวน/ผล (เช่น 2 ประตู, 1 ใบเหลือง) *</label>
                        <input type="number" id="record-count" min="1" max="99" value="1" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 text-center focus:outline-none focus:ring-2 focus:ring-red-500" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">หมายเหตุ/เวลา (ไม่บังคับ)</label>
                        <input type="text" id="record-note" placeholder="เช่น ยิงไกลจากครึ่งสนาม, นาที 45+2" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-red-600 to-red-800 text-white py-3 px-6 rounded-lg hover:from-red-700 hover:to-red-900 transition-all font-medium">
                            <i class="fas fa-save mr-2"></i>
                            บันทึกสถิติ
                        </button>
                        <button type="button" onclick="clearRecordForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="glass-effect rounded-xl shadow-lg p-6 mt-8">
                <h3 class="text-xl font-bold mb-6">ประวัติการบันทึกสถิติผู้เล่น</h3>
                <div id="records-history-list" class="space-y-4">
                    </div>
            </div>
        </div>

    </main>
    
    <div id="success-message" class="success-message">บันทึกข้อมูลสำเร็จ!</div>
    <div id="error-message" class="error-message">เกิดข้อผิดพลาดในการบันทึกข้อมูล</div>
    
    <div id="edit-team-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4 text-gray-800">แก้ไขข้อมูลทีม</h3>
            <form id="edit-team-form" onsubmit="handleEditTeamSubmit(event)" class="space-y-4">
                </form>
            <div class="flex justify-end space-x-4 mt-6">
                <button type="button" onclick="closeEditTeamModal()" class="bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">ยกเลิก</button>
                <button type="submit" form="edit-team-form" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">บันทึก</button>
            </div>
        </div>
    </div>
    
    <div id="edit-player-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg">
            <h3 class="text-xl font-bold mb-4 text-gray-800">แก้ไขข้อมูลนักกีฬา</h3>
            <form id="edit-player-form" onsubmit="handleEditPlayerSubmit(event)" class="space-y-4">
                </form>
            <div class="flex justify-end space-x-4 mt-6">
                <button type="button" onclick="closeEditPlayerModal()" class="bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">ยกเลิก</button>
                <button type="submit" form="edit-player-form" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">บันทึก</button>
            </div>
        </div>
    </div>

    <script>
        // Global Data Structures
        let teams = JSON.parse(localStorage.getItem('teams')) || [
            { id: 1, name: 'ทีมสิงห์ทอง', primaryColor: 'red', logo: null, createdAt: new Date('2024-01-01') },
            { id: 2, name: 'ทีมมังกรแดง', primaryColor: 'blue', logo: null, createdAt: new Date('2024-01-02') },
            { id: 3, name: 'ทีมกระทิงดุ', primaryColor: 'yellow', logo: null, createdAt: new Date('2024-01-03') },
            { id: 4, name: 'ทีมนกอินทรี', primaryColor: 'green', logo: null, createdAt: new Date('2024-01-04') },
            { id: 5, name: 'ทีมช้างขาว', primaryColor: 'white', logo: null, createdAt: new Date('2024-01-05') },
            { id: 6, name: 'ทีมหมาป่า', primaryColor: 'gray', logo: null, createdAt: new Date('2024-01-06') },
            { id: 7, name: 'ทีมเสือดาว', primaryColor: 'purple', logo: null, createdAt: new Date('2024-01-07') },
            { id: 8, name: 'ทีมนกเงือก', primaryColor: 'teal', logo: null, createdAt: new Date('2024-01-08') }
        ];

        // Comprehensive player data with varied roles and details
        let players = JSON.parse(localStorage.getItem('players')) || [
            // ทีมสิงห์ทอง (Team 1)
            { id: 1, name: 'สมชาย ใจดี', jersey: 10, teamId: 1, phone: '081-234-5678', photo: null, birthdate: '1995-03-15', isManager: true, createdAt: new Date('2024-01-10') },
            { id: 2, name: 'สมศักดิ์ วิ่งเร็ว', jersey: 7, teamId: 1, phone: '082-345-6789', photo: null, birthdate: '1998-11-20', isManager: false, createdAt: new Date('2024-01-11') },
            // ทีมมังกรแดง (Team 2)
            { id: 3, name: 'มานะ แข็งแกร่ง', jersey: 1, teamId: 2, phone: '091-123-4567', photo: null, birthdate: '1990-01-01', isManager: true, createdAt: new Date('2024-01-12') },
            { id: 4, name: 'วีระ ยิงคม', jersey: 9, teamId: 2, phone: '092-234-5678', photo: null, birthdate: '1997-07-10', isManager: false, createdAt: new Date('2024-01-13') },
            // ทีมกระทิงดุ (Team 3)
            { id: 5, name: 'ศักดิ์ชัย โหม่งดี', jersey: 18, teamId: 3, phone: '085-567-8901', photo: null, birthdate: '1992-05-05', isManager: false, createdAt: new Date('2024-01-14') },
            { id: 6, name: 'ดำรงค์ ปราการ', jersey: 5, teamId: 3, phone: '086-678-9012', photo: null, birthdate: '1994-08-28', isManager: true, createdAt: new Date('2024-01-15') },
            // ทีมช้างขาว (Team 5) - ข้าม 4 ไปก่อนตามตัวอย่างเดิม
            { id: 15, name: 'ชัยวัฒน์ ครองประตู', jersey: 1, teamId: 5, phone: '089-012-3456', photo: null, birthdate: '1991-09-09', isManager: false, createdAt: new Date('2024-01-24') },
            // ทีมนกอินทรี (Team 4)
            { id: 13, name: 'ยุทธนา วิ่งไม่เหนื่อย', jersey: 6, teamId: 4, phone: '087-890-1234', photo: null, birthdate: '1993-12-03', isManager: false, createdAt: new Date('2024-01-22') },
            { id: 14, name: 'กิตติ์ ยิงไกล', jersey: 11, teamId: 4, phone: '088-901-2345', photo: null, birthdate: '1996-04-25', isManager: true, createdAt: new Date('2024-01-23') },
        ];
        
        let matchHistory = JSON.parse(localStorage.getItem('matchHistory')) || [
            { id: 1, date: '2024-11-20', teamA: 1, scoreA: 3, teamB: 2, scoreB: 1, createdAt: new Date('2024-11-20') },
            { id: 2, date: '2024-11-20', teamA: 3, scoreA: 2, teamB: 4, scoreB: 2, createdAt: new Date('2024-11-20') },
            { id: 3, date: '2024-11-21', teamA: 1, scoreA: 1, teamB: 3, scoreB: 0, createdAt: new Date('2024-11-21') },
            { id: 4, date: '2024-11-22', teamA: 2, scoreA: 0, teamB: 4, scoreB: 3, createdAt: new Date('2024-11-22') },
        ];

        let upcomingMatches = JSON.parse(localStorage.getItem('upcomingMatches')) || [
            { id: 5, date: '2024-11-25', teamA: 5, teamB: 6, createdAt: new Date('2024-11-23') },
            { id: 6, date: '2024-11-26', teamA: 7, teamB: 8, createdAt: new Date('2024-11-23') },
        ];
        
        let playerRecords = JSON.parse(localStorage.getItem('playerRecords')) || [
            { id: 1, playerId: 1, type: 'goal', count: 2, datetime: '2024-11-20T19:30', note: 'ยิงเข้า 2 ลูกในแมทช์ #1' },
            { id: 2, playerId: 4, type: 'goal', count: 1, datetime: '2024-11-20T19:35', note: 'ตีไข่แตกแมทช์ #1' },
            { id: 3, playerId: 15, type: 'save', count: 5, datetime: '2024-11-21T20:00', note: 'เซฟโหดมากในแมทช์ #3' },
            { id: 4, playerId: 1, type: 'goal', count: 1, datetime: '2024-11-21T20:45', note: 'ประตูชัยแมทช์ #3' },
            { id: 5, playerId: 13, type: 'goal', count: 2, datetime: '2024-11-22T21:00', note: 'เหมา 2 ลูกแมทช์ #4' },
            { id: 6, playerId: 14, type: 'goal', count: 1, datetime: '2024-11-22T21:15', note: 'ลูกสุดท้ายแมทช์ #4' },
        ];

        let currentTeamLogo = null; // Global variable to store compressed logo base64
        let editingTeam = null; // Global variable for team being edited
        let editingPlayer = null; // Global variable for player being edited

        // --- Core Utility Functions ---

        function saveData(key) {
            if (window[key]) {
                localStorage.setItem(key, JSON.stringify(window[key]));
            }
        }

        function generateUniqueId(dataArray) {
            const maxId = dataArray.reduce((max, item) => Math.max(max, item.id || 0), 0);
            return maxId + 1;
        }

        function getTeamById(id) {
            return teams.find(team => team.id === id);
        }

        function getPlayerById(id) {
            return players.find(player => player.id === id);
        }

        function getColorClass(colorName) {
            const colorMap = {
                red: 'bg-red-500', blue: 'bg-blue-500', green: 'bg-green-500', yellow: 'bg-yellow-500',
                purple: 'bg-purple-500', orange: 'bg-orange-500', pink: 'bg-pink-500', indigo: 'bg-indigo-500',
                teal: 'bg-teal-500', cyan: 'bg-cyan-500', lime: 'bg-lime-500', rose: 'bg-rose-500',
                amber: 'bg-amber-500', emerald: 'bg-emerald-500', violet: 'bg-violet-500', fuchsia: 'bg-fuchsia-500',
                white: 'bg-white', black: 'bg-black', gray: 'bg-gray-500', slate: 'bg-slate-600',
                zinc: 'bg-zinc-600', neutral: 'bg-neutral-600', stone: 'bg-stone-600'
            };
            return colorMap[colorName] || 'bg-gray-500';
        }
        
        function getColorGradient(colorName) {
            let gradientClass = 'bg-gray-600';
            switch (colorName) {
                case 'red': gradientClass = 'bg-gradient-to-r from-red-600 via-red-700 to-red-800'; break;
                case 'blue': gradientClass = 'bg-gradient-to-r from-blue-600 via-blue-700 to-blue-800'; break;
                case 'green': gradientClass = 'bg-gradient-to-r from-green-600 via-green-700 to-green-800'; break;
                case 'yellow': gradientClass = 'bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600'; break;
                case 'purple': gradientClass = 'bg-gradient-to-r from-purple-600 via-purple-700 to-purple-800'; break;
                case 'orange': gradientClass = 'bg-gradient-to-r from-orange-600 via-orange-700 to-orange-800'; break;
                case 'pink': gradientClass = 'bg-gradient-to-r from-pink-600 via-pink-700 to-pink-800'; break;
                case 'indigo': gradientClass = 'bg-gradient-to-r from-indigo-600 via-indigo-700 to-indigo-800'; break;
                case 'teal': gradientClass = 'bg-gradient-to-r from-teal-600 via-teal-700 to-teal-800'; break;
                case 'cyan': gradientClass = 'bg-gradient-to-r from-cyan-600 via-cyan-700 to-cyan-800'; break;
                case 'lime': gradientClass = 'bg-gradient-to-r from-lime-400 via-lime-500 to-lime-600'; break;
                case 'rose': gradientClass = 'bg-gradient-to-r from-rose-600 via-rose-700 to-rose-800'; break;
                case 'amber': gradientClass = 'bg-gradient-to-r from-amber-400 via-amber-500 to-amber-600'; break;
                case 'emerald': gradientClass = 'bg-gradient-to-r from-emerald-600 via-emerald-700 to-emerald-800'; break;
                case 'violet': gradientClass = 'bg-gradient-to-r from-violet-600 via-violet-700 to-violet-800'; break;
                case 'fuchsia': gradientClass = 'bg-gradient-to-r from-fuchsia-600 via-fuchsia-700 to-fuchsia-800'; break;
                case 'white': gradientClass = 'bg-gradient-to-r from-gray-100 via-white to-gray-100 text-black'; break;
                case 'black': gradientClass = 'bg-gradient-to-r from-gray-800 via-black to-gray-800'; break;
                case 'gray': gradientClass = 'bg-gradient-to-r from-gray-500 via-gray-600 to-gray-700'; break;
                case 'slate': gradientClass = 'bg-gradient-to-r from-slate-600 via-slate-700 to-slate-800'; break;
                case 'zinc': gradientClass = 'bg-gradient-to-r from-zinc-600 via-zinc-700 to-zinc-800'; break;
                case 'neutral': gradientClass = 'bg-gradient-to-r from-neutral-600 via-neutral-700 to-neutral-800'; break;
                case 'stone': gradientClass = 'bg-gradient-to-r from-stone-600 via-stone-700 to-stone-800'; break;
            }
            return gradientClass;
        }

        // --- UI Control Functions ---

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                item.classList.add('hover:bg-gray-100');
            });

            const activeBtn = document.querySelector(`.nav-item[onclick*="${sectionId}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.classList.remove('hover:bg-gray-100');
            }
            
            // Re-render UI based on section
            if (sectionId === 'dashboard') {
                updateDashboardStats();
                updateTeamManagersList();
                updateRecentMatchesList();
            } else if (sectionId === 'leaderboard') {
                updateLeaderboard();
            } else if (sectionId === 'team-management') {
                updateTeamsList();
                updateTeamColorPreview();
            } else if (sectionId === 'player-list') {
                updatePlayerFilters();
                updatePlayersList();
            } else if (sectionId === 'next-matches') {
                updateUpcomingMatchesList();
            } else if (sectionId === 'daily-summary') {
                document.getElementById('daily-summary-date').valueAsDate = new Date();
                loadDailySummary();
            }
        }

        function showSuccessMessage(message = 'บันทึกข้อมูลสำเร็จ!') {
            const el = document.getElementById('success-message');
            el.textContent = message;
            el.classList.add('show');
            setTimeout(() => {
                el.classList.remove('show');
            }, 3000);
        }

        function showErrorMessage(message = 'เกิดข้อผิดพลาดในการบันทึกข้อมูล') {
            const el = document.getElementById('error-message');
            el.textContent = message;
            el.classList.add('show');
            setTimeout(() => {
                el.classList.remove('show');
            }, 3000);
        }

        // --- Team Management Functions ---

        function updateTeamColorPreview() {
            document.querySelectorAll('.team-color-check').forEach(check => {
                check.style.opacity = '0';
            });
            const selectedColor = document.querySelector('input[name="team-color"]:checked');
            if (selectedColor) {
                const selectedCheck = selectedColor.parentNode.querySelector('.team-color-check');
                if (selectedCheck) selectedCheck.style.opacity = '1';
            }
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (2MB limit)
            if (file.size > 2 * 1024 * 1024) {
                showErrorMessage('ไฟล์โลโก้ต้องมีขนาดไม่เกิน 2MB');
                event.target.value = '';
                return;
            }

            // Check file type
            if (!file.type.startsWith('image/')) {
                showErrorMessage('กรุณาเลือกไฟล์รูปภาพเท่านั้น');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // กำหนดขนาด Canvas ให้เท่ากับรูปภาพเดิม
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // วาดรูปภาพลงใน Canvas
                    ctx.drawImage(img, 0, 0);

                    // *** บีบอัด: ลดคุณภาพเหลือ 70% และแปลงเป็น JPEG ***
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);

                    // บันทึก Base64 ที่ถูกบีบอัดแล้วลงใน Global Variable
                    currentTeamLogo = compressedBase64; 

                    // แสดงผลตัวอย่าง
                    const preview = document.getElementById('logo-preview');
                    preview.innerHTML = `<img src="${currentTeamLogo}" alt="Logo Preview" class="w-full h-full object-cover rounded-lg">`;
                    document.getElementById('remove-logo').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removeLogo() {
            currentTeamLogo = null;
            document.getElementById('team-logo').value = '';
            document.getElementById('logo-preview').innerHTML = `<i class="fas fa-camera text-gray-400 text-xl"></i>`;
            document.getElementById('remove-logo').classList.add('hidden');
        }

        function clearTeamForm() {
            document.getElementById('team-name').value = '';
            document.querySelectorAll('input[name="team-color"]').forEach(radio => radio.checked = false);
            updateTeamColorPreview();
            removeLogo();
        }

        function handleTeamSubmit(event) {
            event.preventDefault();
            const teamName = document.getElementById('team-name').value.trim();
            const selectedColor = document.querySelector('input[name="team-color"]:checked')?.value;

            if (!teamName || !selectedColor) {
                showErrorMessage('กรุณากรอกชื่อทีมและเลือกสีประจำทีม');
                return;
            }

            const newTeam = {
                id: generateUniqueId(teams),
                name: teamName,
                primaryColor: selectedColor,
                logo: currentTeamLogo,
                createdAt: new Date()
            };

            teams.push(newTeam);
            saveData('teams');
            clearTeamForm();
            updateTeamsList();
            updateTeamDropdown();
            showSuccessMessage(`เพิ่มทีม "${teamName}" สำเร็จ!`);
        }

        function updateTeamsList() {
            const container = document.getElementById('teams-list');
            if (!container) return;
            
            if (teams.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-8 text-gray-500">ยังไม่มีทีมที่ลงทะเบียน</div>`;
                return;
            }

            container.innerHTML = teams.sort((a, b) => a.name.localeCompare(b.name)).map(team => {
                const colorClass = getColorClass(team.primaryColor);
                const teamLogo = team.logo ? `<img src="${team.logo}" alt="${team.name} Logo" class="w-12 h-12 object-cover rounded-full border-2 border-white shadow-md">` :
                                            `<div class="w-12 h-12 ${colorClass} text-white rounded-full flex items-center justify-center text-lg font-bold shadow-md">${team.name[0]}</div>`;
                
                const managerCount = players.filter(p => p.teamId === team.id && p.isManager).length;
                const playerCount = players.filter(p => p.teamId === team.id).length;

                return `
                    <div class="bg-white/20 backdrop-blur-md rounded-xl shadow-lg p-4 flex items-center justify-between card-hover transition-all border border-gray-300">
                        <div class="flex items-center space-x-3">
                            ${teamLogo}
                            <div>
                                <h4 class="text-lg font-bold text-white">${team.name}</h4>
                                <p class="text-xs text-gray-300">${playerCount} นักกีฬา | ${managerCount} ผู้จัดการ</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="openEditTeamModal(${team.id})" class="text-blue-400 hover:text-blue-200 transition-colors" title="แก้ไข">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTeam(${team.id})" class="text-red-400 hover:text-red-200 transition-colors" title="ลบ">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteTeam(id) {
            if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบทีมนี้? (ข้อมูลนักกีฬาและสถิติของทีมนี้จะยังคงอยู่)')) {
                teams = teams.filter(team => team.id !== id);
                saveData('teams');
                updateTeamsList();
                updateTeamDropdown();
                updatePlayerFilters();
                updateDashboardStats();
                showSuccessMessage('ลบทีมสำเร็จ!');
                updateLeaderboard(); 
                updateUpcomingMatchesList();
            }
        }

        // --- Player Management Functions ---

        function handlePlayerPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (2MB limit)
            if (file.size > 2 * 1024 * 1024) {
                showErrorMessage('ไฟล์รูปภาพต้องมีขนาดไม่เกิน 2MB');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Scale image down if too large, maintain aspect ratio
                    const maxWidth = 500;
                    const scaleFactor = img.width > maxWidth ? maxWidth / img.width : 1;
                    
                    canvas.width = img.width * scaleFactor;
                    canvas.height = img.height * scaleFactor;
                    
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // Compress to JPEG 70% quality
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);

                    // Store base64 string directly on the file input element for submission
                    if (editingPlayer) {
                         // If editing, use a temporary property on the editing object
                        editingPlayer.tempPhoto = compressedBase64;
                    } else {
                        document.getElementById('player-photo').dataset.base64 = compressedBase64;
                    }
                   
                    document.getElementById('remove-player-photo').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // **Modification 5: Player Card Refactor - Initial setup for click handler**
        function setupPlayerCardClicks() {
            document.querySelectorAll('.player-card').forEach(card => {
                card.onclick = function(event) {
                    const cardElement = this;
                    
                    // 1. Close all other active cards
                    document.querySelectorAll('.player-card.active').forEach(activeCard => {
                        if (activeCard !== cardElement) {
                            activeCard.classList.remove('active');
                        }
                    });

                    // 2. Toggle active state of the clicked card
                    cardElement.classList.toggle('active');
                };
            });
        }

        function renderPlayerCard(player) {
            const team = getTeamById(player.teamId);
            const teamColorClass = team ? getColorClass(team.primaryColor) : 'bg-gray-500';
            const teamGradientClass = team ? getColorGradient(team.primaryColor) : 'bg-gray-700';
            
            const playerPhoto = player.photo ? `<img src="${player.photo}" alt="${player.name}" class="w-full h-full object-cover">` :
                                                `<div class="w-full h-full ${teamColorClass} flex items-center justify-center text-4xl text-white font-bold">${player.name[0]}</div>`;
            
            // Calculate player stats
            const stats = calculatePlayerStats(player.id);
            const scoreColor = stats.score >= 10 ? 'text-red-600' : stats.score >= 5 ? 'text-indigo-600' : 'text-gray-600';
            let performanceLevel = 'มือใหม่';
            let performanceColor = 'text-gray-600';
            let performanceIcon = 'fas fa-chart-line';
            
            if (stats.score >= 10) {
                performanceLevel = 'ยอดเยี่ยม';
                performanceColor = 'text-red-600';
                performanceIcon = 'fas fa-trophy';
            } else if (stats.score >= 5) {
                performanceLevel = 'มือดี';
                performanceColor = 'text-indigo-600';
                performanceIcon = 'fas fa-thumbs-up';
            }
            
            // **Modification 5: Player Card Refactor**
            return `
                <div class="player-card bg-white/10 backdrop-blur-sm rounded-xl shadow-lg border border-gray-700 transition-all hover:shadow-2xl hover:scale-105" data-player-id="${player.id}">
                    <div class="player-photo-container h-32 ${teamGradientClass} rounded-t-xl overflow-hidden">
                        ${playerPhoto}
                        
                        <div class="jersey-number-badge">${player.jersey || '-'}</div>

                        </div>
                    
                    <div class="p-4 text-center">
                        <h4 class="text-lg font-bold text-white mb-1">${player.name}</h4>
                        <p class="text-sm text-gray-300 mb-3">${team ? team.name : 'ไม่มีทีม'}</p>
                        
                        <div class="bg-gray-800 rounded-xl px-3 py-1.5 shadow-md inline-block">
                            <div class="text-2xl font-bold ${scoreColor}">${stats.score}</div>
                            <div class="text-xs text-gray-400 font-medium">คะแนนผลงาน</div>
                        </div>

                        <div class="mt-3 flex items-center justify-center space-x-2 ${performanceColor}">
                            <i class="${performanceIcon} text-sm"></i>
                            <span class="text-xs font-bold">${performanceLevel}</span>
                        </div>
                    </div>

                    <div class="card-actions">
                        <button class="edit-btn" onclick="event.stopPropagation(); openEditPlayerModal(${player.id})">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                        <button class="delete-btn" onclick="event.stopPropagation(); deletePlayer(${player.id})">
                            <i class="fas fa-trash-alt"></i> ลบ
                        </button>
                    </div>
                </div>
            `;
        }
        
        function updatePlayersList() {
            const container = document.getElementById('players-card-grid');
            if (!container) return;

            const filterTeamId = parseInt(document.getElementById('filter-player-team').value);
            const sortBy = document.getElementById('sort-player').value;

            let filteredPlayers = players;
            if (filterTeamId) {
                filteredPlayers = players.filter(player => player.teamId === filterTeamId);
            }

            // Sorting logic
            filteredPlayers.sort((a, b) => {
                if (sortBy === 'name') {
                    return a.name.localeCompare(b.name, 'th');
                } else if (sortBy === 'jersey') {
                    return (a.jersey || 9999) - (b.jersey || 9999); // Sort missing jerseys to the end
                } else if (sortBy === 'date') {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                }
                return 0;
            });
            
            if (filteredPlayers.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-8 text-gray-500">
                                            <i class="fas fa-user-slash text-4xl mb-4 text-gray-700"></i>
                                            <p class="text-lg font-medium">ไม่พบนักกีฬาในทีมที่เลือก</p>
                                        </div>`;
                return;
            }

            container.innerHTML = filteredPlayers.map(player => renderPlayerCard(player)).join('');
            
            // **Modification 5: Player Card Refactor - Setup click listener after rendering**
            setupPlayerCardClicks();
        }

        function deletePlayer(id) {
            if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบนักกีฬาคนนี้? (สถิติที่บันทึกไว้จะถูกลบไปด้วย)')) {
                players = players.filter(player => player.id !== id);
                playerRecords = playerRecords.filter(record => record.playerId !== id);
                
                saveData('players');
                saveData('playerRecords');
                
                updatePlayersList();
                updateTeamManagersList();
                showSuccessMessage('ลบนักกีฬาสำเร็จ!');
            }
        }
        
        function handlePlayerSubmit(event) {
            event.preventDefault();

            const name = document.getElementById('player-name').value.trim();
            const teamId = parseInt(document.getElementById('player-team-id').value);
            const jersey = document.getElementById('player-jersey').value ? parseInt(document.getElementById('player-jersey').value) : null;
            const phone = document.getElementById('player-phone').value.trim();
            const birthdate = document.getElementById('player-birthdate').value;
            const isManager = document.getElementById('is-manager').checked;
            const photoBase64 = document.getElementById('player-photo').dataset.base64 || null; // Get base64 from data attribute

            if (!name || !teamId) {
                showErrorMessage('กรุณากรอกชื่อนักกีฬาและเลือกทีม');
                return;
            }

            const newPlayer = {
                id: generateUniqueId(players),
                name,
                jersey,
                teamId,
                phone: phone || null,
                photo: photoBase64,
                birthdate: birthdate || null,
                isManager,
                createdAt: new Date()
            };

            players.push(newPlayer);
            saveData('players');
            clearPlayerForm();
            updatePlayersList();
            updateTeamManagersList();
            updateTeamDropdown();
            showSuccessMessage(`เพิ่มนักกีฬา "${name}" สำเร็จ!`);
        }

        function clearPlayerForm() {
            document.getElementById('player-name').value = '';
            document.getElementById('player-team-id').value = '';
            document.getElementById('player-jersey').value = '';
            document.getElementById('player-phone').value = '';
            document.getElementById('player-birthdate').value = '';
            document.getElementById('is-manager').checked = false;
            document.getElementById('player-photo').value = '';
            document.getElementById('player-photo').dataset.base64 = '';
            document.getElementById('remove-player-photo').classList.add('hidden');
        }
        
        function removePlayerPhoto() {
            document.getElementById('player-photo').value = '';
            document.getElementById('player-photo').dataset.base64 = '';
            if (editingPlayer) editingPlayer.tempPhoto = null;
            document.getElementById('remove-player-photo').classList.add('hidden');
        }

        // --- Match Management Functions ---
        
        function handleMatchSubmit(event) {
            event.preventDefault();
            
            const date = document.getElementById('match-date').value;
            const teamAId = parseInt(document.getElementById('team-a').value);
            const teamBId = parseInt(document.getElementById('team-b').value);
            const scoreA = parseInt(document.getElementById('score-a').value);
            const scoreB = parseInt(document.getElementById('score-b').value);

            if (teamAId === teamBId) {
                showErrorMessage('ทีมเจ้าบ้านและทีมเยือนต้องไม่เป็นทีมเดียวกัน');
                return;
            }

            const match = {
                id: generateUniqueId([...matchHistory, ...upcomingMatches]),
                date,
                teamA: teamAId,
                scoreA,
                teamB: teamBId,
                scoreB,
                createdAt: new Date()
            };

            // Check if this match was in upcoming list
            const upcomingIndex = upcomingMatches.findIndex(um => um.date === date && 
                                                                 ((um.teamA === teamAId && um.teamB === teamBId) || 
                                                                  (um.teamA === teamBId && um.teamB === teamAId)));
            
            if (upcomingIndex !== -1) {
                upcomingMatches.splice(upcomingIndex, 1);
            }

            matchHistory.unshift(match);
            saveData('matchHistory');
            saveData('upcomingMatches');
            clearMatchForm();
            updateMatchHistoryList();
            updateDashboardStats();
            updateLeaderboard();
            showSuccessMessage('บันทึกผลการแข่งขันสำเร็จ!');
        }

        function clearMatchForm() {
            document.getElementById('match-date').value = '';
            document.getElementById('team-a').value = '';
            document.getElementById('team-b').value = '';
            document.getElementById('score-a').value = '';
            document.getElementById('score-b').value = '';
        }

        function updateMatchHistoryList() {
            const container = document.getElementById('match-history-list');
            if (!container) return;
            
            if (matchHistory.length === 0) {
                container.innerHTML = `<div class="text-center py-8 text-gray-500">ยังไม่มีประวัติการแข่งขัน</div>`;
                return;
            }

            container.innerHTML = matchHistory.map(match => {
                const teamA = getTeamById(match.teamA);
                const teamB = getTeamById(match.teamB);
                const dateText = new Date(match.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' });
                
                let resultClassA = 'bg-gray-200';
                let resultClassB = 'bg-gray-200';
                
                if (match.scoreA > match.scoreB) {
                    resultClassA = 'bg-green-100 text-green-700 font-bold';
                    resultClassB = 'bg-red-100 text-red-700';
                } else if (match.scoreB > match.scoreA) {
                    resultClassA = 'bg-red-100 text-red-700';
                    resultClassB = 'bg-green-100 text-green-700 font-bold';
                }

                return `
                    <div class="bg-white/20 backdrop-blur-md rounded-lg shadow-md p-4 border border-gray-300">
                        <div class="flex items-center justify-between text-sm text-gray-300 mb-2">
                            <i class="fas fa-calendar-alt mr-2"></i> ${dateText}
                            <button onclick="deleteMatchHistoryItem(${match.id})" class="text-red-400 hover:text-red-200 transition-colors" title="ลบแมทช์">
                                <i class="fas fa-times-circle"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between space-x-2">
                            <div class="w-5/12 text-right">
                                <h4 class="font-bold text-white">${teamA?.name || 'ทีมถูกลบ'}</h4>
                            </div>
                            <div class="flex-shrink-0 flex items-center space-x-1 text-base font-bold">
                                <span class="px-2 py-1 rounded ${resultClassA}">${match.scoreA}</span>
                                <span class="text-white">-</span>
                                <span class="px-2 py-1 rounded ${resultClassB}">${match.scoreB}</span>
                            </div>
                            <div class="w-5/12 text-left">
                                <h4 class="font-bold text-white">${teamB?.name || 'ทีมถูกลบ'}</h4>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteMatchHistoryItem(id) {
            if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบผลการแข่งขันนี้? (ข้อมูลจะถูกลบออกและคะแนนจะถูกปรับปรุง)')) {
                matchHistory = matchHistory.filter(match => match.id !== id);
                upcomingMatches = upcomingMatches.filter(match => match.id !== id);
                
                saveData('matchHistory');
                saveData('upcomingMatches');
                
                updateMatchHistoryList();
                updateDashboardStats();
                updateLeaderboard();
                showSuccessMessage('ลบผลการแข่งขันสำเร็จ!');
            }
        }
        
        // --- Upcoming Matches Functions ---
        
        function renderUpcomingMatchCard(match) {
            const teamA = getTeamById(match.teamA);
            const teamB = getTeamById(match.teamB);
            
            if (!teamA || !teamB) return ''; // Skip if team data is missing
            
            const dateText = new Date(match.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' });
            
            const teamLogoA = teamA.logo ? `<img src="${teamA.logo}" alt="${teamA.name} Logo" class="w-8 h-8 object-cover rounded-full">` : 
                                            `<div class="w-8 h-8 ${getColorClass(teamA.primaryColor)} text-white rounded-full flex items-center justify-center text-sm font-bold">${teamA.name[0]}</div>`;
            const teamLogoB = teamB.logo ? `<img src="${teamB.logo}" alt="${teamB.name} Logo" class="w-8 h-8 object-cover rounded-full">` : 
                                            `<div class="w-8 h-8 ${getColorClass(teamB.primaryColor)} text-white rounded-full flex items-center justify-center text-sm font-bold">${teamB.name[0]}</div>`;

            // **Modification 3: Hide 'รอแข่ง'**
            const isUpcoming = !match.scoreA; // Check if it hasn't been played yet
            const statusText = isUpcoming ? '' : 'จบการแข่งขัน'; 
            
            return `
                <div class="bg-white/20 backdrop-blur-md rounded-xl shadow-lg p-4 border border-gray-300">
                    <div class="flex items-center justify-between text-sm text-gray-300 mb-3">
                        <span class="font-bold flex items-center">
                            <i class="fas fa-calendar-alt mr-2 text-red-400"></i> ${dateText}
                        </span>
                        <p class="text-sm font-semibold text-gray-500">${statusText}</p>
                    </div>
                    <div class="flex items-center justify-between space-x-2">
                        <div class="w-5/12 text-right flex flex-col items-end">
                            <div class="flex items-center space-x-2">
                                <h4 class="font-bold text-white">${teamA.name}</h4>
                                ${teamLogoA}
                            </div>
                        </div>
                        <div class="flex-shrink-0 text-white font-bold text-lg">VS</div>
                        <div class="w-5/12 text-left flex flex-col items-start">
                            <div class="flex items-center space-x-2">
                                ${teamLogoB}
                                <h4 class="font-bold text-white">${teamB.name}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateUpcomingMatchesList() {
            const container = document.getElementById('upcoming-matches-list');
            if (!container) return;
            
            const allMatches = [...matchHistory, ...upcomingMatches];
            const sortedMatches = allMatches.sort((a, b) => new Date(a.date) - new Date(b.date));
            const matchesToDisplay = sortedMatches.filter(match => !match.scoreA || match.scoreA === undefined);

            if (matchesToDisplay.length === 0) {
                container.innerHTML = `<div class="text-center py-8 text-gray-500">ไม่มีโปรแกรมการแข่งขันที่กำลังจะมาถึง</div>`;
                return;
            }

            container.innerHTML = matchesToDisplay.map(renderUpcomingMatchCard).join('');
        }

        // --- Leaderboard & Stats Functions ---
        
        function calculateLeagueStats() {
            const stats = {};

            teams.forEach(team => {
                stats[team.id] = {
                    teamId: team.id,
                    played: 0, win: 0, draw: 0, loss: 0,
                    goalsFor: 0, goalsAgainst: 0,
                    points: 0,
                    form: []
                };
            });

            matchHistory.forEach(match => {
                const teamA = stats[match.teamA];
                const teamB = stats[match.teamB];

                if (!teamA || !teamB) return; // Skip if team was deleted

                // Update Played
                teamA.played++;
                teamB.played++;

                // Update Goals
                teamA.goalsFor += match.scoreA;
                teamA.goalsAgainst += match.scoreB;
                teamB.goalsFor += match.scoreB;
                teamB.goalsAgainst += match.scoreA;

                // Update Results
                if (match.scoreA > match.scoreB) {
                    // Team A Wins
                    teamA.win++;
                    teamA.points += 3;
                    teamA.form.unshift('W');
                    
                    teamB.loss++;
                    teamB.form.unshift('L');
                } else if (match.scoreB > match.scoreA) {
                    // Team B Wins
                    teamB.win++;
                    teamB.points += 3;
                    teamB.form.unshift('W');

                    teamA.loss++;
                    teamA.form.unshift('L');
                } else {
                    // Draw
                    teamA.draw++;
                    teamA.points += 1;
                    teamA.form.unshift('D');

                    teamB.draw++;
                    teamB.points += 1;
                    teamB.form.unshift('D');
                }
            });

            const sortedStats = Object.values(stats)
                .sort((a, b) => {
                    // 1. Points
                    if (b.points !== a.points) return b.points - a.points;
                    // 2. Goal Difference
                    const gdA = a.goalsFor - a.goalsAgainst;
                    const gdB = b.goalsFor - b.goalsAgainst;
                    if (gdB !== gdA) return gdB - gdA;
                    // 3. Goals For
                    if (b.goalsFor !== a.goalsFor) return b.goalsFor - a.goalsFor;
                    // 4. Team Name (A-Z)
                    const teamA = getTeamById(a.teamId)?.name || '';
                    const teamB = getTeamById(b.teamId)?.name || '';
                    return teamA.localeCompare(teamB, 'th');
                })
                .filter(stat => getTeamById(stat.teamId)); // Filter out stats for deleted teams

            return sortedStats;
        }

        function updateLeaderboard() {
            const container = document.getElementById('leaderboard-table').querySelector('tbody');
            if (!container) return;
            
            const stats = calculateLeagueStats();

            if (stats.length === 0 || stats.every(s => s.played === 0)) {
                container.innerHTML = `<tr><td colspan="11" class="text-center py-8 text-gray-500">
                                            <i class="fas fa-chart-line text-4xl mb-4 text-gray-700"></i>
                                            <p class="text-lg font-medium">ยังไม่มีข้อมูลคะแนน</p>
                                        </td></tr>`;
                document.getElementById('leaderboard-update').textContent = '--/--/----';
                return;
            }

            document.getElementById('leaderboard-update').textContent = new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });

            container.innerHTML = stats.map((stat, index) => {
                const team = getTeamById(stat.teamId);
                const gd = stat.goalsFor - stat.goalsAgainst;
                
                let positionClass = '';
                if (index === 0) {
                    positionClass = 'bg-gradient-to-r from-yellow-200 to-white border-l-4 border-yellow-500 shadow-md';
                } else if (index === 1 || index === 2) {
                    positionClass = 'bg-gradient-to-r from-orange-100 to-orange-200 border-l-4 border-orange-500 shadow-md';
                }

                // Generate form display (last 5 games)
                const formDisplay = stat.form.slice(0, 5).map(result => {
                    let formClass = 'form-result-D bg-yellow-500';
                    if (result === 'W') {
                        formClass = 'form-result-W bg-green-500';
                    } else if (result === 'L') {
                        formClass = 'form-result-L bg-red-500';
                    }
                    // The class names are used in the CSS added in the style block
                    return `<span class="inline-block w-6 h-6 ${formClass} rounded-full text-xs font-bold flex items-center justify-center mr-1 text-white">${result}</span>`;
                }).join('');

                const teamLogo = team.logo ? `<img src="${team.logo}" alt="${team.name} Logo" class="w-6 h-6 object-cover rounded-full mr-2">` : 
                                            `<div class="w-6 h-6 ${getColorClass(team.primaryColor)} text-white rounded-full flex items-center justify-center text-xs font-bold mr-2">${team.name[0]}</div>`;
                
                // Row HTML (CSS will handle the text color based on Modification 2)
                return `
                    <tr class="text-center ${positionClass} hover:bg-gray-100/30 transition-colors border-b border-gray-700">
                        <td class="px-4 py-3 font-extrabold text-lg text-red-700">${index + 1}</td>
                        <td class="px-4 py-3 text-left font-bold flex items-center text-white">
                            ${teamLogo} 
                            ${team.name}
                        </td>
                        <td class="px-4 py-3">${stat.played}</td>
                        <td class="px-4 py-3">${stat.win}</td>
                        <td class="px-4 py-3">${stat.draw}</td>
                        <td class="px-4 py-3">${stat.loss}</td>
                        <td class="px-4 py-3">${stat.goalsFor}</td>
                        <td class="px-4 py-3">${stat.goalsAgainst}</td>
                        <td class="px-4 py-3">${gd > 0 ? `+${gd}` : gd}</td>
                        <td class="px-4 py-3 font-extrabold text-xl text-red-700">${stat.points}</td>
                        <td class="px-4 py-3 text-center">
                            <div class="flex justify-center">${formDisplay}</div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateDashboardStats() {
            // Stats 
            document.getElementById('total-teams').textContent = teams.length;
            document.getElementById('total-players').textContent = players.length;
            document.getElementById('total-matches').textContent = matchHistory.length;
            document.getElementById('total-player-records').textContent = playerRecords.length;

            // League Leader
            const stats = calculateLeagueStats();
            if (stats.length > 0) {
                const leader = getTeamById(stats[0].teamId);
                document.getElementById('league-leader-name').textContent = leader?.name || '-';
                document.getElementById('league-leader-points').textContent = `${stats[0].points} คะแนน`;
            } else {
                document.getElementById('league-leader-name').textContent = '-';
                document.getElementById('league-leader-points').textContent = '0 คะแนน';
            }
        }
        
        // --- Daily Summary Functions ---

        function loadDailySummary() {
            const dateInput = document.getElementById('daily-summary-date');
            const selectedDate = dateInput.value;
            if (!selectedDate) return;

            const dailyMatches = matchHistory.filter(match => match.date === selectedDate);
            const dailyRecords = playerRecords.filter(record => record.datetime.startsWith(selectedDate));
            
            updateDailySummary(dailyMatches);
            updateDailyTopScorers(dailyRecords);
            updateDailyPlayerRecords(dailyRecords);
        }

        function updateDailySummary(dailyMatches) {
            const container = document.getElementById('daily-match-results');
            const dailyGoalsEl = document.getElementById('daily-goals');
            const dailyMatchesEl = document.getElementById('daily-matches');
            const dailyTeamsEl = document.getElementById('daily-teams');
            
            dailyMatchesEl.textContent = dailyMatches.length;

            if (dailyMatches.length === 0) {
                container.innerHTML = `<div class="text-center py-8 text-gray-500">ไม่พบผลการแข่งขันในวันนี้</div>`;
                dailyGoalsEl.textContent = '0';
                dailyTeamsEl.textContent = '0';
                return;
            }

            let totalGoals = 0;
            const teamsPlayed = new Set();

            container.innerHTML = dailyMatches.map(match => {
                const teamA = getTeamById(match.teamA);
                const teamB = getTeamById(match.teamB);
                
                if (!teamA || !teamB) return '';

                totalGoals += match.scoreA + match.scoreB;
                teamsPlayed.add(teamA.id);
                teamsPlayed.add(teamB.id);

                const teamLogoA = teamA.logo ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-6 h-6 object-cover rounded-full mr-2">` : 
                                                `<span class="w-6 h-6 ${getColorClass(teamA.primaryColor)} text-white rounded-full flex items-center justify-center mr-2 text-xs font-bold">${teamA.name[0]}</span>`;
                const teamLogoB = teamB.logo ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-6 h-6 object-cover rounded-full ml-2">` : 
                                                `<span class="w-6 h-6 ${getColorClass(teamB.primaryColor)} text-white rounded-full flex items-center justify-center ml-2 text-xs font-bold">${teamB.name[0]}</span>`;

                const resultClassA = match.scoreA > match.scoreB ? 'text-green-400' : match.scoreA < match.scoreB ? 'text-red-400' : 'text-gray-400';
                const resultClassB = match.scoreB > match.scoreA ? 'text-green-400' : match.scoreB < match.scoreA ? 'text-red-400' : 'text-gray-400';
                
                // **Modification 4: Fix Score Overlap & Color (ensured by class setup)**
                return `
                    <div class="bg-white/20 backdrop-blur-md rounded-xl shadow-md flex items-center justify-between px-4 py-3 border border-gray-700">
                        <span class="font-semibold text-white flex items-center w-5/12 justify-end">
                            ${teamLogoA}
                            ${teamA.name}
                        </span>
                        
                        <div class="flex-shrink-0 flex items-center space-x-2 text-center">
                            <span class="font-bold text-2xl ${resultClassA}">${match.scoreA}</span>
                            <span class="font-bold text-yellow-300 text-lg"> - </span>
                            <span class="font-bold text-2xl ${resultClassB}">${match.scoreB}</span>
                        </div>
                        
                        <span class="font-semibold text-white flex items-center w-5/12 justify-start">
                            ${teamB.name}
                            ${teamLogoB}
                        </span>
                    </div>
                `;
            }).join('');
            
            dailyGoalsEl.textContent = totalGoals;
            dailyTeamsEl.textContent = teamsPlayed.size;
        }

        function updateDailyTopScorers(dailyRecords) {
            const container = document.getElementById('daily-top-scorers');
            const goalRecords = dailyRecords.filter(record => record.type === 'goal');
            
            if (goalRecords.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-3 text-sm">วันนี้ยังไม่มีประตู</div>';
                return;
            }

            const goalStats = {};
            goalRecords.forEach(record => {
                const playerId = record.playerId;
                if (!goalStats[playerId]) {
                    goalStats[playerId] = { playerId, goals: 0 };
                }
                goalStats[playerId].goals += record.count;
            });

            const sortedScorers = Object.values(goalStats)
                .sort((a, b) => b.goals - a.goals);

            container.innerHTML = sortedScorers.map((scorer, index) => {
                const player = getPlayerById(scorer.playerId);
                const team = getTeamById(player?.teamId);
                
                if (!player) return '';

                let rankIcon = '';
                let rankClass = 'bg-gray-700';

                if (index === 0) {
                    rankIcon = '<i class="fas fa-crown text-yellow-400"></i>';
                    rankClass = 'bg-red-800';
                } else if (index === 1) {
                    rankIcon = '<i class="fas fa-star text-gray-300"></i>';
                    rankClass = 'bg-red-700';
                } else if (index === 2) {
                    rankIcon = '<i class="fas fa-star-half-alt text-yellow-500"></i>';
                    rankClass = 'bg-red-600';
                } else {
                    rankIcon = `<span class="text-gray-300 font-bold text-sm">${index + 1}</span>`;
                }

                return `
                    <div class="flex items-center justify-between p-3 rounded-xl ${rankClass} shadow-md border border-gray-700">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white ${index < 3 ? 'text-lg' : ''}">
                                ${rankIcon}
                            </div>
                            <div>
                                <h4 class="font-semibold text-white">${player.name}</h4>
                                <p class="text-xs text-gray-300">${team?.name || 'ไม่มีทีม'}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-extrabold text-yellow-300">${scorer.goals}</div>
                            <div class="text-xs text-gray-300">ประตู</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateDailyPlayerRecords(dailyRecords) {
            const container = document.getElementById('daily-player-records');
            if (dailyRecords.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ไม่มีสถิติผู้เล่นในวันนี้</div>';
                return;
            }

            // Group records by type
            const recordsByType = { goal: [], save: [], yellow: [], red: [] };
            dailyRecords.forEach(record => {
                if (recordsByType[record.type]) {
                    recordsByType[record.type].push(record);
                }
            });

            // Sort each type by count (descending)
            Object.keys(recordsByType).forEach(type => {
                recordsByType[type].sort((a, b) => b.count - a.count);
            });

            const typeConfig = {
                goal: { name: 'ประตู', icon: 'fas fa-futbol', color: 'text-red-500', bg: 'bg-red-700', text: 'text-white' },
                save: { name: 'เซฟ', icon: 'fas fa-hands', color: 'text-blue-500', bg: 'bg-blue-700', text: 'text-white' },
                yellow: { name: 'ใบเหลือง', icon: 'fas fa-clipboard-list', color: 'text-yellow-500', bg: 'bg-yellow-400', text: 'text-black' },
                red: { name: 'ใบแดง', icon: 'fas fa-clipboard-list', color: 'text-gray-900', bg: 'bg-black', text: 'text-white' }
            };

            let html = '';

            Object.keys(recordsByType).forEach(type => {
                const records = recordsByType[type];
                if (records.length === 0) return;

                const config = typeConfig[type];
                
                html += `
                    <div class="bg-gray-800 rounded-xl shadow-lg p-4">
                        <h4 class="text-lg font-bold mb-3 flex items-center ${config.color}">
                            <i class="${config.icon} mr-2"></i> สถิติ: ${config.name}
                        </h4>
                        <div class="space-y-3">
                            ${records.map(record => {
                                const player = getPlayerById(record.playerId);
                                const team = getTeamById(player?.teamId);
                                if (!player) return '';

                                return `
                                    <div class="bg-gray-700 p-3 rounded-lg flex justify-between items-center">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 ${getColorClass(team?.primaryColor || 'gray')} rounded-full flex items-center justify-center text-white text-sm font-bold">
                                                ${player.jersey || player.name[0]}
                                            </div>
                                            <div>
                                                <div class="font-semibold text-white">${player.name}</div>
                                                <div class="text-xs text-gray-400">${team?.name || 'ไม่มีทีม'}</div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold ${config.color}">${record.count}</div>
                                            ${record.note ? `<div class="text-xs text-gray-400">${record.note}</div>` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });

            if (html === '') {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ไม่มีสถิติผู้เล่นในวันนี้</div>';
            } else {
                container.innerHTML = html;
            }
        }
        
        // --- Player Records Functions ---

        function handleRecordSubmit(event) {
            event.preventDefault();

            const datetime = document.getElementById('record-datetime').value;
            const playerId = parseInt(document.getElementById('record-player-id').value);
            const type = document.querySelector('input[name="record-type"]:checked')?.value;
            const count = parseInt(document.getElementById('record-count').value);
            const note = document.getElementById('record-note').value.trim();

            if (!datetime || !playerId || !type || !count) {
                showErrorMessage('กรุณากรอกข้อมูลให้ครบถ้วน');
                return;
            }

            const newRecord = {
                id: generateUniqueId(playerRecords),
                playerId,
                type,
                count,
                datetime,
                note: note || null,
                createdAt: new Date()
            };

            playerRecords.unshift(newRecord);
            saveData('playerRecords');
            clearRecordForm();
            updateRecordsHistoryList();
            updateDashboardStats();
            showSuccessMessage('บันทึกสถิติสำเร็จ!');
        }

        function clearRecordForm() {
            document.getElementById('record-datetime').value = '';
            document.getElementById('record-player-id').value = '';
            document.querySelector('input[name="record-type"]:checked')?.checked = false;
            document.getElementById('record-count').value = 1;
            document.getElementById('record-note').value = '';
        }
        
        function updateRecordsHistoryList() {
            const container = document.getElementById('records-history-list');
            if (!container) return;

            if (playerRecords.length === 0) {
                container.innerHTML = `<div class="text-center py-8 text-gray-500">ยังไม่มีประวัติการบันทึกสถิติ</div>`;
                return;
            }

            const typeConfig = {
                goal: { name: 'ประตู', icon: 'fas fa-futbol', color: 'text-red-500', bg: 'bg-red-100' },
                save: { name: 'เซฟ', icon: 'fas fa-hands', color: 'text-blue-500', bg: 'bg-blue-100' },
                yellow: { name: 'ใบเหลือง', icon: 'fas fa-clipboard-list', color: 'text-yellow-500', bg: 'bg-yellow-100' },
                red: { name: 'ใบแดง', icon: 'fas fa-clipboard-list', color: 'text-black', bg: 'bg-gray-200' }
            };

            container.innerHTML = playerRecords.map(record => {
                const player = getPlayerById(record.playerId);
                const team = getTeamById(player?.teamId);
                const config = typeConfig[record.type] || { name: 'สถิติ', icon: 'fas fa-chart-bar', color: 'text-gray-500', bg: 'bg-gray-100' };

                const datetimeText = new Date(record.datetime).toLocaleString('th-TH', { 
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                });

                return `
                    <div class="flex justify-between items-center p-4 ${config.bg} rounded-lg shadow-md border-l-4 border-${config.color.split('-')[1]}-500">
                        <div class="flex items-center space-x-3">
                            <i class="${config.icon} text-xl ${config.color}"></i>
                            <div>
                                <h4 class="font-bold text-gray-800">${config.name} (${record.count})</h4>
                                <p class="text-sm text-gray-600">${player?.name || 'นักกีฬาถูกลบ'} #${player?.jersey || '-'}</p>
                                <p class="text-xs text-gray-500">${team?.name || 'ไม่มีทีม'}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">${datetimeText}</p>
                            <button onclick="deletePlayerRecord(${record.id})" class="text-red-500 hover:text-red-700 text-xs mt-1">
                                <i class="fas fa-trash-alt mr-1"></i> ลบ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deletePlayerRecord(id) {
            if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบสถิตินี้?')) {
                playerRecords = playerRecords.filter(record => record.id !== id);
                saveData('playerRecords');
                updateRecordsHistoryList();
                updateDashboardStats();
                showSuccessMessage('ลบสถิติสำเร็จ!');
            }
        }
        
        // --- Edit/Modal Functions (Simplified implementations for completeness) ---

        function openEditTeamModal(id) {
            editingTeam = getTeamById(id);
            if (!editingTeam) return;

            document.getElementById('edit-team-modal').classList.remove('hidden');
            document.getElementById('edit-team-modal').classList.add('flex');
            
            // Populate form (simplified for this example)
            const form = document.getElementById('edit-team-form');
            form.innerHTML = `
                <input type="hidden" id="edit-team-id" value="${editingTeam.id}">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อทีม</label>
                    <input type="text" id="edit-team-name" value="${editingTeam.name}" class="w-full border rounded-lg px-3 py-2 text-gray-800" required>
                </div>
                <p class="text-sm font-medium text-gray-700">สีประจำทีม: ${editingTeam.primaryColor}</p>
            `;
            // Note: A full implementation would dynamically generate the color picker and logo uploader.
        }

        function closeEditTeamModal() {
            document.getElementById('edit-team-modal').classList.add('hidden');
            document.getElementById('edit-team-modal').classList.remove('flex');
            editingTeam = null;
        }

        function handleEditTeamSubmit(event) {
            event.preventDefault();
            const id = parseInt(document.getElementById('edit-team-id').value);
            const name = document.getElementById('edit-team-name').value.trim();

            const teamIndex = teams.findIndex(team => team.id === id);
            if (teamIndex !== -1) {
                teams[teamIndex].name = name;
                // Add logic for color/logo update if implemented
                saveData('teams');
                closeEditTeamModal();
                updateTeamsList();
                updateTeamDropdown();
                updateDashboardStats();
                updateLeaderboard(); 
                showSuccessMessage(`แก้ไขทีม "${name}" สำเร็จ!`);
            }
        }

        // **Modification 5: Player Card Refactor - Edit Player Modal**
        function openEditPlayerModal(id) {
            editingPlayer = getPlayerById(id);
            if (!editingPlayer) return;

            document.getElementById('edit-player-modal').classList.remove('hidden');
            document.getElementById('edit-player-modal').classList.add('flex');
            
            // Populate form for editing (simplified: full implementation needs all fields)
            const form = document.getElementById('edit-player-form');
            form.innerHTML = `
                <input type="hidden" id="edit-player-id" value="${editingPlayer.id}">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อนักกีฬา</label>
                    <input type="text" id="edit-player-name" value="${editingPlayer.name}" class="w-full border rounded-lg px-3 py-2 text-gray-800" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์เสื้อ</label>
                    <input type="number" id="edit-player-jersey" value="${editingPlayer.jersey || ''}" class="w-full border rounded-lg px-3 py-2 text-gray-800">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                    <input type="tel" id="edit-player-phone" value="${editingPlayer.phone || ''}" class="w-full border rounded-lg px-3 py-2 text-gray-800">
                </div>
                `;
        }

        function closeEditPlayerModal() {
            document.getElementById('edit-player-modal').classList.add('hidden');
            document.getElementById('edit-player-modal').classList.remove('flex');
            editingPlayer = null;
        }

        function handleEditPlayerSubmit(event) {
            event.preventDefault();
            const id = parseInt(document.getElementById('edit-player-id').value);
            const name = document.getElementById('edit-player-name').value.trim();
            const jersey = document.getElementById('edit-player-jersey').value ? parseInt(document.getElementById('edit-player-jersey').value) : null;
            const phone = document.getElementById('edit-player-phone').value.trim();
            // Note: In a full version, you'd get all fields.

            const playerIndex = players.findIndex(player => player.id === id);
            if (playerIndex !== -1) {
                players[playerIndex].name = name;
                players[playerIndex].jersey = jersey;
                players[playerIndex].phone = phone;
                // Add logic for photo/team/manager update if implemented
                
                saveData('players');
                closeEditPlayerModal();
                updatePlayersList();
                updateTeamManagersList();
                showSuccessMessage(`แก้ไขข้อมูลนักกีฬา "${name}" สำเร็จ!`);
            }
        }
        
        // --- Initialization and Utility Calls ---

        function updateTeamDropdown() {
            document.querySelectorAll('select[id$="-team-id"], #team-a, #team-b').forEach(selectEl => {
                const selectedValue = selectEl.value;
                
                // Clear existing options except the first one ('เลือกทีม')
                while (selectEl.children.length > 1) {
                    selectEl.removeChild(selectEl.lastChild);
                }

                teams.sort((a, b) => a.name.localeCompare(b.name, 'th')).forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = team.name;
                    selectEl.appendChild(option);
                });
                
                // Restore selected value if it still exists
                if (selectedValue) {
                    selectEl.value = selectedValue;
                }
            });
        }
        
        function updatePlayerDropdown() {
            const playerSelects = document.querySelectorAll('select[id^="record-player-id"]');
            playerSelects.forEach(selectEl => {
                const selectedValue = selectEl.value;
                while (selectEl.children.length > 1) {
                    selectEl.removeChild(selectEl.lastChild);
                }
                
                players.sort((a, b) => a.name.localeCompare(b.name, 'th')).forEach(player => {
                    const option = document.createElement('option');
                    const team = getTeamById(player.teamId);
                    option.value = player.id;
                    option.textContent = `${player.name} (#${player.jersey || '-'}) - ${team?.name || 'ไม่มีทีม'}`;
                    selectEl.appendChild(option);
                });
                
                if (selectedValue) {
                    selectEl.value = selectedValue;
                }
            });
        }
        
        function calculatePlayerStats(playerId) {
            const player = getPlayerById(playerId);
            if (!player) return { goals: 0, saves: 0, yellows: 0, reds: 0, score: 0, form: [] };

            const stats = { goals: 0, saves: 0, yellows: 0, reds: 0, score: 0 };
            
            playerRecords.filter(r => r.playerId === playerId).forEach(record => {
                stats[`${record.type}s`] += record.count;
            });

            // Simple Score calculation: Goal + Save - Red - Yellow/2
            stats.score = (stats.goals * 3) + (stats.saves * 1) - (stats.reds * 5) - (stats.yellows * 1);
            
            return stats;
        }

        function updatePlayerFilters() {
            const teamFilter = document.getElementById('filter-player-team');
            if (!teamFilter) return;

            // Clear existing options except the first one
            while (teamFilter.children.length > 1) {
                teamFilter.removeChild(teamFilter.lastChild);
            }

            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id;
                option.textContent = team.name;
                teamFilter.appendChild(option);
            });
        }

        function updateTeamManagersList() {
            const container = document.getElementById('team-managers-list');
            if (!container) return;
            const managers = players.filter(player => player.isManager && player.teamId);

            if (managers.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-user-tie text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ยังไม่มีผู้จัดการทีม</p>
                        <p class="text-sm">เพิ่มผู้เล่นและกำหนดเป็นผู้จัดการทีม</p>
                    </div>
                `;
                return;
            }

            // Group managers by team
            const managersByTeam = {};
            managers.forEach(manager => {
                const team = getTeamById(manager.teamId);
                if (team) {
                    if (!managersByTeam[team.id]) {
                        managersByTeam[team.id] = { team: team, managers: [] };
                    }
                    managersByTeam[team.id].managers.push(manager);
                }
            });

            container.innerHTML = Object.values(managersByTeam).map(teamData => {
                const team = teamData.team;
                const teamManagers = teamData.managers;
                
                const teamLogo = team.logo ? `<img src="${team.logo}" alt="${team.name}" class="w-10 h-10 rounded-full object-cover border-2 border-white">` :
                                            `<div class="w-10 h-10 ${getColorClass(team.primaryColor)} text-white rounded-full flex items-center justify-center text-sm font-bold border-2 border-white">${team.name[0]}</div>`;

                return `
                    <div class="border border-gray-700 rounded-xl p-4 card-hover transition-all bg-gray-900/50">
                        <div class="flex items-center space-x-3 mb-3">
                            ${teamLogo}
                            <div>
                                <h4 class="font-bold text-white">${team.name}</h4>
                                <p class="text-xs text-yellow-400">ผู้จัดการทีม</p>
                            </div>
                        </div>
                        <ul class="space-y-1">
                            ${teamManagers.map(manager => `<li class="text-sm text-gray-300 flex items-center"><i class="fas fa-user-check mr-2 text-green-400"></i>${manager.name}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }).join('');
        }

        function updateDateTime() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            
            document.getElementById('current-date').textContent = now.toLocaleDateString('th-TH', dateOptions);
            document.getElementById('current-time').textContent = now.toLocaleTimeString('th-TH', timeOptions);
        }

        // --- Initial Load ---

        document.addEventListener('DOMContentLoaded', () => {
            // Update Date/Time every second
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // Initial UI Renders
            updateTeamDropdown();
            updatePlayerDropdown();
            updateDashboardStats();
            updateTeamManagersList();
            updatePlayersList();
            updateMatchHistoryList();
            updateUpcomingMatchesList();
            updateLeaderboard(); 

            // Initialize default section
            showSection('dashboard');
            
            // Player photo upload handler setup
            const playerPhotoInput = document.getElementById('player-photo');
            if (playerPhotoInput) {
                playerPhotoInput.addEventListener('change', handlePlayerPhotoUpload);
            }
        });

    </script>
</body>
</html>
